---
title: "TMS NL-Ops演示系统任务022: 响应式设计和移动端适配"
epic: "tms-nlops-demo"
task: "022"
phase: "3"
status: "pending"
priority: "medium"
estimated_hours: 10
parallel: false
depends_on: ["008", "009", "010", "011", "021"]
tags: ["ui", "responsive", "mobile", "accessibility"]
created: "2025-09-20T04:20:45Z"
updated: "2025-09-20T04:20:45Z"
---

## 概述

实现TMS NL-Ops演示系统的响应式设计和移动端适配，确保在各种设备和屏幕尺寸下都能提供良好的用户体验，包括桌面端、平板端和移动端的优化。

## 目标

- 创建完全响应式的用户界面
- 优化移动端用户体验
- 实现触摸友好的交互设计
- 确保所有功能在移动端可用
- 提供无障碍访问支持
- 优化页面加载性能

## 技术栈

- **框架**: Next.js 15+ App Router
- **语言**: TypeScript
- **样式**: Tailwind CSS + shadcn/ui v2
- **响应式设计**: CSS Grid + Flexbox
- **触摸交互**: 原生触摸事件
- **性能优化**: 图片懒加载、代码分割

## 实施步骤

### 1. 创建响应式断点配置

创建`src/config/breakpoints.ts`:

```typescript
export const breakpoints = {
  xs: '0px',
  sm: '640px',
  md: '768px',
  lg: '1024px',
  xl: '1280px',
  '2xl': '1536px',
} as const

export type Breakpoint = keyof typeof breakpoints

export const mediaQueries = {
  xs: `(min-width: ${breakpoints.xs})`,
  sm: `(min-width: ${breakpoints.sm})`,
  md: `(min-width: ${breakpoints.md})`,
  lg: `(min-width: ${breakpoints.lg})`,
  xl: `(min-width: ${breakpoints.xl})`,
  '2xl': `(min-width: ${breakpoints['2xl']})`,
} as const

// 响应式值工具函数
export function responsiveValue<T>(values: Partial<Record<Breakpoint, T>>, defaultValue: T): T {
  if (typeof window === 'undefined') return defaultValue

  const width = window.innerWidth
  const sortedBreakpoints = Object.entries(breakpoints)
    .sort(([, a], [, b]) => parseInt(a) - parseInt(b))

  for (const [breakpoint, minWidth] of sortedBreakpoints) {
    if (width >= parseInt(minWidth) && values[breakpoint as Breakpoint] !== undefined) {
      return values[breakpoint as Breakpoint]!
    }
  }

  return defaultValue
}

// 使用示例：
// const fontSize = responsiveValue(
//   { sm: 14, md: 16, lg: 18 },
//   16
// )
```

### 2. 创建响应式布局组件

创建`src/components/layout/responsive-grid.tsx`:

```typescript
'use client'

import { cn } from '@/lib/utils'
import { ReactNode } from 'react'

interface ResponsiveGridProps {
  children: ReactNode
  className?: string
  cols?: {
    xs?: number
    sm?: number
    md?: number
    lg?: number
    xl?: number
    '2xl'?: number
  }
  gap?: {
    xs?: number
    sm?: number
    md?: number
    lg?: number
    xl?: number
    '2xl'?: number
  }
}

export function ResponsiveGrid({
  children,
  className,
  cols = { xs: 1, sm: 2, md: 3, lg: 4, xl: 5, '2xl': 6 },
  gap = { xs: 2, sm: 3, md: 4, lg: 6, xl: 8, '2xl': 8 },
}: ResponsiveGridProps) {
  // 生成网格类名
  const gridClasses = Object.entries(cols)
    .map(([breakpoint, value]) => {
      if (breakpoint === 'xs') return `grid-cols-${value}`
      return `${breakpoint}:grid-cols-${value}`
    })
    .join(' ')

  // 生成间距类名
  const gapClasses = Object.entries(gap)
    .map(([breakpoint, value]) => {
      if (breakpoint === 'xs') return `gap-${value}`
      return `${breakpoint}:gap-${value}`
    })
    .join(' ')

  return (
    <div className={cn('grid', gridClasses, gapClasses, className)}>
      {children}
    </div>
  )
}

interface ResponsiveContainerProps {
  children: ReactNode
  className?: string
  maxWidth?: 'sm' | 'md' | 'lg' | 'xl' | '2xl' | 'full'
  center?: boolean
}

export function ResponsiveContainer({
  children,
  className,
  maxWidth = '2xl',
  center = true,
}: ResponsiveContainerProps) {
  const containerClasses = cn(
    'w-full',
    {
      'max-w-sm': maxWidth === 'sm',
      'max-w-md': maxWidth === 'md',
      'max-w-lg': maxWidth === 'lg',
      'max-w-xl': maxWidth === 'xl',
      'max-w-2xl': maxWidth === '2xl',
      'max-w-full': maxWidth === 'full',
    },
    center && 'mx-auto',
    className
  )

  return <div className={containerClasses}>{children}</div>
}
```

### 3. 创建移动端导航组件

创建`src/components/layout/mobile-navigation.tsx`:

```typescript
'use client'

import { useState } from 'react'
import { cn } from '@/lib/utils'
import { Button } from '@/components/ui/button'
import { Sheet, SheetContent, SheetTrigger } from '@/components/ui/sheet'
import { Badge } from '@/components/ui/badge'
import {
  Home,
  Package,
  Truck,
  MapPin,
  FileText,
  BarChart3,
  Settings,
  Menu,
  Bell,
  Search,
  User,
} from 'lucide-react'
import { usePathname, useRouter } from 'next/navigation'
import { mainNavigation } from '@/config/navigation'

interface MobileNavigationProps {
  user?: {
    name: string
    email: string
    avatar?: string
  }
}

export function MobileNavigation({ user }: MobileNavigationProps) {
  const [open, setOpen] = useState(false)
  const pathname = usePathname()
  const router = useRouter()

  const navigationItems = [
    { href: '/dashboard', icon: Home, label: '首页' },
    { href: '/orders', icon: Package, label: '订单' },
    { href: '/dispatch', icon: Truck, label: '调度' },
    { href: '/tracking', icon: MapPin, label: '跟踪' },
    { href: '/receipts', icon: FileText, label: '回单' },
    { href: '/reports', icon: BarChart3, label: '报表' },
  ]

  const handleNavigation = (href: string) => {
    router.push(href)
    setOpen(false)
  }

  return (
    <div className="lg:hidden">
      {/* Bottom Navigation */}
      <div className="fixed bottom-0 left-0 right-0 z-50 bg-white border-t border-gray-200">
        <div className="grid grid-cols-6 gap-1 p-2">
          {navigationItems.slice(0, 6).map((item) => {
            const isActive = pathname === item.href || pathname.startsWith(item.href + '/')
            const Icon = item.icon

            return (
              <Button
                key={item.href}
                variant="ghost"
                size="sm"
                className={cn(
                  'flex flex-col items-center gap-1 h-auto py-2 px-1',
                  isActive && 'text-primary bg-primary/10'
                )}
                onClick={() => handleNavigation(item.href)}
              >
                <Icon className="h-5 w-5" />
                <span className="text-xs">{item.label}</span>
              </Button>
            )
          })}
        </div>
      </div>

      {/* Top Header */}
      <div className="fixed top-0 left-0 right-0 z-40 bg-white border-b border-gray-200">
        <div className="flex items-center justify-between p-4">
          {/* Menu Button */}
          <Sheet open={open} onOpenChange={setOpen}>
            <SheetTrigger asChild>
              <Button variant="ghost" size="icon">
                <Menu className="h-5 w-5" />
              </Button>
            </SheetTrigger>
            <SheetContent side="left" className="w-80 p-0">
              <MobileMenuContent onClose={() => setOpen(false)} user={user} />
            </SheetContent>
          </Sheet>

          {/* Logo */}
          <div className="flex items-center gap-2">
            <div className="flex aspect-square size-8 items-center justify-center rounded-lg bg-primary text-primary-foreground">
              <Truck className="size-4" />
            </div>
            <span className="font-semibold">TMS</span>
          </div>

          {/* Actions */}
          <div className="flex items-center gap-2">
            <Button variant="ghost" size="icon">
              <Search className="h-5 w-5" />
            </Button>
            <Button variant="ghost" size="icon" className="relative">
              <Bell className="h-5 w-5" />
              <Badge variant="destructive" className="absolute -top-1 -right-1 h-5 w-5 rounded-full p-0 text-xs">
                3
              </Badge>
            </Button>
            <Button variant="ghost" size="icon">
              <User className="h-5 w-5" />
            </Button>
          </div>
        </div>
      </div>

      {/* Content Padding */}
      <div className="pt-16 pb-20" />
    </div>
  )
}

function MobileMenuContent({
  onClose,
  user,
}: {
  onClose: () => void
  user?: {
    name: string
    email: string
    avatar?: string
  }
}) {
  const pathname = usePathname()
  const router = useRouter()

  const handleNavigation = (href: string) => {
    router.push(href)
    onClose()
  }

  return (
    <div className="flex flex-col h-full">
      {/* Header */}
      <div className="flex items-center gap-3 p-4 border-b">
        <div className="flex aspect-square size-10 items-center justify-center rounded-lg bg-primary text-primary-foreground">
          <Truck className="size-5" />
        </div>
        <div>
          <div className="font-semibold">TMS NL-Ops</div>
          <div className="text-sm text-muted-foreground">演示系统</div>
        </div>
      </div>

      {/* User Profile */}
      {user && (
        <div className="p-4 border-b">
          <div className="flex items-center gap-3">
            <div className="flex aspect-square size-10 items-center justify-center rounded-full bg-primary/10 text-primary">
              {user.name?.[0] || 'U'}
            </div>
            <div className="flex-1 min-w-0">
              <div className="font-medium truncate">{user.name}</div>
              <div className="text-sm text-muted-foreground truncate">{user.email}</div>
            </div>
          </div>
        </div>
      )}

      {/* Navigation Menu */}
      <div className="flex-1 overflow-y-auto p-4">
        <div className="space-y-2">
          {mainNavigation.map((item) => {
            const isActive = pathname === item.href || pathname.startsWith(item.href + '/')
            const Icon = item.icon

            return (
              <div key={item.href}>
                <Button
                  variant={isActive ? 'default' : 'ghost'}
                  className="w-full justify-start"
                  onClick={() => handleNavigation(item.href)}
                >
                  <Icon className="mr-2 h-4 w-4" />
                  {item.title}
                  {item.badge && (
                    <Badge variant="secondary" className="ml-auto">
                      {item.badge}
                    </Badge>
                  )}
                </Button>

                {/* Submenu */}
                {item.children && isActive && (
                  <div className="ml-4 mt-2 space-y-1">
                    {item.children.map((child) => {
                      const isChildActive = pathname === child.href
                      const ChildIcon = child.icon

                      return (
                        <Button
                          key={child.href}
                          variant={isChildActive ? 'default' : 'ghost'}
                          size="sm"
                          className="w-full justify-start"
                          onClick={() => handleNavigation(child.href)}
                        >
                          <ChildIcon className="mr-2 h-4 w-4" />
                          {child.title}
                        </Button>
                      )
                    })}
                  </div>
                )}
              </div>
            )
          })}
        </div>
      </div>

      {/* Settings */}
      <div className="p-4 border-t">
        <Button
          variant="ghost"
          className="w-full justify-start"
          onClick={() => handleNavigation('/settings')}
        >
          <Settings className="mr-2 h-4 w-4" />
          设置
        </Button>
      </div>
    </div>
  )
}
```

### 4. 创建响应式表格组件

创建`src/components/ui/responsive-table.tsx`:

```typescript
'use client'

import { useState } from 'react'
import { cn } from '@/lib/utils'
import { Button } from '@/components/ui/button'
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'
import { Badge } from '@/components/ui/badge'
import {
  Table,
  TableBody,
  TableCell,
  TableHead,
  TableHeader,
  TableRow,
} from '@/components/ui/table'
import { ChevronLeft, ChevronRight, MoreVertical, Eye, Edit, Trash } from 'lucide-react'
import {
  DropdownMenu,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuTrigger,
} from '@/components/ui/dropdown-menu'

interface ResponsiveTableProps<T> {
  data: T[]
  columns: TableColumn<T>[]
  title?: string
  description?: string
  onRowClick?: (row: T) => void
  onEdit?: (row: T) => void
  onDelete?: (row: T) => void
  onView?: (row: T) => void
  pagination?: {
    page: number
    pageSize: number
    total: number
    onPageChange: (page: number) => void
    onPageSizeChange: (pageSize: number) => void
  }
  loading?: boolean
  className?: string
}

interface TableColumn<T> {
  key: keyof T
  title: string
  render?: (value: any, row: T) => React.ReactNode
  mobile?: boolean // 是否在移动端显示
  sortable?: boolean
}

export function ResponsiveTable<T>({
  data,
  columns,
  title,
  description,
  onRowClick,
  onEdit,
  onDelete,
  onView,
  pagination,
  loading = false,
  className,
}: ResponsiveTableProps<T>) {
  const [isMobile, setIsMobile] = useState(false)

  // 检测移动端
  useState(() => {
    const checkMobile = () => {
      setIsMobile(window.innerWidth < 768)
    }
    checkMobile()
    window.addEventListener('resize', checkMobile)
    return () => window.removeEventListener('resize', checkMobile)
  })

  // 移动端只显示标记为 mobile 的列
  const mobileColumns = columns.filter(col => col.mobile !== false)
  const visibleColumns = isMobile ? mobileColumns : columns

  if (isMobile) {
    return (
      <MobileTable
        data={data}
        columns={mobileColumns}
        title={title}
        description={description}
        onRowClick={onRowClick}
        onEdit={onEdit}
        onDelete={onDelete}
        onView={onView}
        pagination={pagination}
        loading={loading}
        className={className}
      />
    )
  }

  return (
    <Card className={className}>
      {(title || description) && (
        <CardHeader>
          {title && <CardTitle>{title}</CardTitle>}
          {description && <CardDescription>{description}</CardDescription>}
        </CardHeader>
      )}
      <CardContent>
        <div className="rounded-md border">
          <Table>
            <TableHeader>
              <TableRow>
                {visibleColumns.map((column) => (
                  <TableHead key={column.key.toString()}>
                    {column.title}
                  </TableHead>
                ))}
                {(onEdit || onDelete || onView) && (
                  <TableHead className="w-[100px]">操作</TableHead>
                )}
              </TableRow>
            </TableHeader>
            <TableBody>
              {loading ? (
                Array.from({ length: 5 }).map((_, index) => (
                  <TableRow key={index}>
                    {visibleColumns.map((column, colIndex) => (
                      <TableCell key={colIndex}>
                        <div className="h-4 bg-gray-200 rounded animate-pulse" />
                      </TableCell>
                    ))}
                    {(onEdit || onDelete || onView) && (
                      <TableCell>
                        <div className="h-8 bg-gray-200 rounded animate-pulse" />
                      </TableCell>
                    )}
                  </TableRow>
                ))
              ) : data.length === 0 ? (
                <TableRow>
                  <TableCell
                    colSpan={visibleColumns.length + (onEdit || onDelete || onView ? 1 : 0)}
                    className="h-24 text-center"
                  >
                    暂无数据
                  </TableCell>
                </TableRow>
              ) : (
                data.map((row, index) => (
                  <TableRow
                    key={index}
                    className={onRowClick ? 'cursor-pointer hover:bg-muted/50' : ''}
                    onClick={() => onRowClick?.(row)}
                  >
                    {visibleColumns.map((column) => (
                      <TableCell key={column.key.toString()}>
                        {column.render
                          ? column.render(row[column.key], row)
                          : String(row[column.key] || '-')}
                      </TableCell>
                    ))}
                    {(onEdit || onDelete || onView) && (
                      <TableCell>
                        <DropdownMenu>
                          <DropdownMenuTrigger asChild>
                            <Button variant="ghost" size="sm">
                              <MoreVertical className="h-4 w-4" />
                            </Button>
                          </DropdownMenuTrigger>
                          <DropdownMenuContent align="end">
                            {onView && (
                              <DropdownMenuItem onClick={() => onView(row)}>
                                <Eye className="mr-2 h-4 w-4" />
                                查看
                              </DropdownMenuItem>
                            )}
                            {onEdit && (
                              <DropdownMenuItem onClick={() => onEdit(row)}>
                                <Edit className="mr-2 h-4 w-4" />
                                编辑
                              </DropdownMenuItem>
                            )}
                            {onDelete && (
                              <DropdownMenuItem
                                onClick={() => onDelete(row)}
                                className="text-destructive"
                              >
                                <Trash className="mr-2 h-4 w-4" />
                                删除
                              </DropdownMenuItem>
                            )}
                          </DropdownMenuContent>
                        </DropdownMenu>
                      </TableCell>
                    )}
                  </TableRow>
                ))
              )}
            </TableBody>
          </Table>
        </div>

        {/* 分页 */}
        {pagination && (
          <div className="flex items-center justify-between space-x-2 py-4">
            <div className="flex-1 text-sm text-muted-foreground">
              共 {pagination.total} 条记录
            </div>
            <div className="flex items-center space-x-2">
              <Button
                variant="outline"
                size="sm"
                onClick={() => pagination.onPageChange(pagination.page - 1)}
                disabled={pagination.page <= 1}
              >
                <ChevronLeft className="h-4 w-4" />
                上一页
              </Button>
              <div className="flex items-center space-x-1">
                <span className="text-sm">
                  第 {pagination.page} 页，共 {Math.ceil(pagination.total / pagination.pageSize)} 页
                </span>
              </div>
              <Button
                variant="outline"
                size="sm"
                onClick={() => pagination.onPageChange(pagination.page + 1)}
                disabled={pagination.page >= Math.ceil(pagination.total / pagination.pageSize)}
              >
                下一页
                <ChevronRight className="h-4 w-4" />
              </Button>
            </div>
          </div>
        )}
      </CardContent>
    </Card>
  )
}

// 移动端卡片式表格
function MobileTable<T>({
  data,
  columns,
  title,
  description,
  onRowClick,
  onEdit,
  onDelete,
  onView,
  pagination,
  loading,
  className,
}: ResponsiveTableProps<T>) {
  return (
    <div className={cn('space-y-4', className)}>
      {(title || description) && (
        <div>
          {title && <h2 className="text-lg font-semibold">{title}</h2>}
          {description && <p className="text-sm text-muted-foreground">{description}</p>}
        </div>
      )}

      {loading ? (
        Array.from({ length: 3 }).map((_, index) => (
          <Card key={index}>
            <CardContent className="p-4">
              <div className="space-y-3">
                {columns.map((_, colIndex) => (
                  <div key={colIndex} className="h-4 bg-gray-200 rounded animate-pulse" />
                ))}
              </div>
            </CardContent>
          </Card>
        ))
      ) : data.length === 0 ? (
        <Card>
          <CardContent className="flex items-center justify-center h-32">
            <p className="text-muted-foreground">暂无数据</p>
          </CardContent>
        </Card>
      ) : (
        data.map((row, index) => (
          <Card
            key={index}
            className={onRowClick ? 'cursor-pointer hover:shadow-md transition-shadow' : ''}
            onClick={() => onRowClick?.(row)}
          >
            <CardContent className="p-4">
              <div className="space-y-3">
                {columns.map((column) => (
                  <div key={column.key.toString()}>
                    <div className="text-sm font-medium text-muted-foreground">
                      {column.title}
                    </div>
                    <div className="text-sm">
                      {column.render
                        ? column.render(row[column.key], row)
                        : String(row[column.key] || '-')}
                    </div>
                  </div>
                ))}
              </div>

              {(onEdit || onDelete || onView) && (
                <div className="flex justify-end space-x-2 mt-4 pt-4 border-t">
                  {onView && (
                    <Button variant="outline" size="sm" onClick={(e) => {
                      e.stopPropagation()
                      onView(row)
                    }}>
                      <Eye className="h-4 w-4 mr-1" />
                      查看
                    </Button>
                  )}
                  {onEdit && (
                    <Button variant="outline" size="sm" onClick={(e) => {
                      e.stopPropagation()
                      onEdit(row)
                    }}>
                      <Edit className="h-4 w-4 mr-1" />
                      编辑
                    </Button>
                  )}
                  {onDelete && (
                    <Button
                      variant="destructive"
                      size="sm"
                      onClick={(e) => {
                        e.stopPropagation()
                        onDelete(row)
                      }}
                    >
                      <Trash className="h-4 w-4 mr-1" />
                      删除
                    </Button>
                  )}
                </div>
              )}
            </CardContent>
          </Card>
        ))
      )}

      {/* 移动端分页 */}
      {pagination && (
        <div className="flex items-center justify-between space-x-2">
          <div className="text-sm text-muted-foreground">
            共 {pagination.total} 条
          </div>
          <div className="flex items-center space-x-2">
            <Button
              variant="outline"
              size="sm"
              onClick={() => pagination.onPageChange(pagination.page - 1)}
              disabled={pagination.page <= 1}
            >
              上一页
            </Button>
            <span className="text-sm">
              {pagination.page}/{Math.ceil(pagination.total / pagination.pageSize)}
            </span>
            <Button
              variant="outline"
              size="sm"
              onClick={() => pagination.onPageChange(pagination.page + 1)}
              disabled={pagination.page >= Math.ceil(pagination.total / pagination.pageSize)}
            >
              下一页
            </Button>
          </div>
        </div>
      )}
    </div>
  )
}
```

### 5. 创建响应式表单组件

创建`src/components/ui/responsive-form.tsx`:

```typescript
'use client'

import { useState } from 'react'
import { cn } from '@/lib/utils'
import { Button } from '@/components/ui/button'
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'
import { Input } from '@/components/ui/input'
import { Label } from '@/components/ui/label'
import { Textarea } from '@/components/ui/textarea'
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select'
import { Checkbox } from '@/components/ui/checkbox'
import { RadioGroup, RadioGroupItem } from '@/components/ui/radio-group'
import { Switch } from '@/components/ui/switch'
import { Calendar } from '@/components/ui/calendar'
import { Popover, PopoverContent, PopoverTrigger } from '@/components/ui/popover'
import { CalendarIcon } from 'lucide-react'
import { format } from 'date-fns'
import { zhCN } from 'date-fns/locale'

interface ResponsiveFormFieldProps {
  label: string
  required?: boolean
  description?: string
  error?: string
  children: React.ReactNode
  className?: string
}

function ResponsiveFormField({
  label,
  required,
  description,
  error,
  children,
  className,
}: ResponsiveFormFieldProps) {
  return (
    <div className={cn('space-y-2', className)}>
      <div className="flex items-center justify-between">
        <Label className={cn(required && 'after:content-["*"] after:ml-1 after:text-red-500')}>
          {label}
        </Label>
        {description && (
          <span className="text-sm text-muted-foreground">{description}</span>
        )}
      </div>
      {children}
      {error && <p className="text-sm text-red-600">{error}</p>}
    </div>
  )
}

interface ResponsiveFormProps {
  title?: string
  description?: string
  onSubmit: (data: any) => Promise<void>
  onCancel?: () => void
  loading?: boolean
  className?: string
  children: React.ReactNode
}

export function ResponsiveForm({
  title,
  description,
  onSubmit,
  onCancel,
  loading = false,
  className,
  children,
}: ResponsiveFormProps) {
  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault()
    const formData = new FormData(e.target as HTMLFormElement)
    const data = Object.fromEntries(formData.entries())
    await onSubmit(data)
  }

  return (
    <Card className={className}>
      {(title || description) && (
        <CardHeader>
          {title && <CardTitle>{title}</CardTitle>}
          {description && <CardDescription>{description}</CardDescription>}
        </CardHeader>
      )}
      <CardContent>
        <form onSubmit={handleSubmit} className="space-y-6">
          {children}
          <div className="flex justify-end space-x-4">
            {onCancel && (
              <Button type="button" variant="outline" onClick={onCancel}>
                取消
              </Button>
            )}
            <Button type="submit" disabled={loading}>
              {loading ? '提交中...' : '确定'}
            </Button>
          </div>
        </form>
      </CardContent>
    </Card>
  )
}

// 响应式输入组件
interface ResponsiveInputProps extends Omit<React.InputHTMLAttributes<HTMLInputElement>, 'onChange'> {
  label: string
  value?: string
  onChange?: (value: string) => void
  required?: boolean
  description?: string
  error?: string
}

export function ResponsiveInput({
  label,
  value,
  onChange,
  required,
  description,
  error,
  ...props
}: ResponsiveInputProps) {
  return (
    <ResponsiveFormField
      label={label}
      required={required}
      description={description}
      error={error}
    >
      <Input
        value={value}
        onChange={(e) => onChange?.(e.target.value)}
        {...props}
      />
    </ResponsiveFormField>
  )
}

// 响应式文本域组件
interface ResponsiveTextareaProps extends Omit<React.TextareaHTMLAttributes<HTMLTextAreaElement>, 'onChange'> {
  label: string
  value?: string
  onChange?: (value: string) => void
  required?: boolean
  description?: string
  error?: string
}

export function ResponsiveTextarea({
  label,
  value,
  onChange,
  required,
  description,
  error,
  ...props
}: ResponsiveTextareaProps) {
  return (
    <ResponsiveFormField
      label={label}
      required={required}
      description={description}
      error={error}
    >
      <Textarea
        value={value}
        onChange={(e) => onChange?.(e.target.value)}
        {...props}
      />
    </ResponsiveFormField>
  )
}

// 响应式选择组件
interface ResponsiveSelectProps {
  label: string
  value?: string
  onChange?: (value: string) => void
  required?: boolean
  description?: string
  error?: string
  options: Array<{ value: string; label: string }>
  placeholder?: string
}

export function ResponsiveSelect({
  label,
  value,
  onChange,
  required,
  description,
  error,
  options,
  placeholder,
}: ResponsiveSelectProps) {
  return (
    <ResponsiveFormField
      label={label}
      required={required}
      description={description}
      error={error}
    >
      <Select value={value} onValueChange={onChange}>
        <SelectTrigger>
          <SelectValue placeholder={placeholder} />
        </SelectTrigger>
        <SelectContent>
          {options.map((option) => (
            <SelectItem key={option.value} value={option.value}>
              {option.label}
            </SelectItem>
          ))}
        </SelectContent>
      </Select>
    </ResponsiveFormField>
  )
}

// 响应式日期选择组件
interface ResponsiveDatePickerProps {
  label: string
  value?: Date
  onChange?: (date: Date | undefined) => void
  required?: boolean
  description?: string
  error?: string
  placeholder?: string
}

export function ResponsiveDatePicker({
  label,
  value,
  onChange,
  required,
  description,
  error,
  placeholder = '选择日期',
}: ResponsiveDatePickerProps) {
  return (
    <ResponsiveFormField
      label={label}
      required={required}
      description={description}
      error={error}
    >
      <Popover>
        <PopoverTrigger asChild>
          <Button
            variant="outline"
            className={cn(
              'w-full justify-start text-left font-normal',
              !value && 'text-muted-foreground'
            )}
          >
            <CalendarIcon className="mr-2 h-4 w-4" />
            {value ? format(value, 'yyyy年MM月dd日', { locale: zhCN }) : placeholder}
          </Button>
        </PopoverTrigger>
        <PopoverContent className="w-auto p-0">
          <Calendar
            mode="single"
            selected={value}
            onSelect={onChange}
            initialFocus
            locale={zhCN}
          />
        </PopoverContent>
      </Popover>
    </ResponsiveFormField>
  )
}

// 响应式复选框组件
interface ResponsiveCheckboxProps {
  label: string
  checked?: boolean
  onChange?: (checked: boolean) => void
  description?: string
  error?: string
}

export function ResponsiveCheckbox({
  label,
  checked,
  onChange,
  description,
  error,
}: ResponsiveCheckboxProps) {
  return (
    <div className="space-y-2">
      <div className="flex items-center space-x-2">
        <Checkbox
          id={label}
          checked={checked}
          onCheckedChange={onChange}
        />
        <Label htmlFor={label}>{label}</Label>
      </div>
      {description && (
        <p className="text-sm text-muted-foreground">{description}</p>
      )}
      {error && <p className="text-sm text-red-600">{error}</p>}
    </div>
  )
}

// 响应式开关组件
interface ResponsiveSwitchProps {
  label: string
  checked?: boolean
  onChange?: (checked: boolean) => void
  description?: string
  error?: string
}

export function ResponsiveSwitch({
  label,
  checked,
  onChange,
  description,
  error,
}: ResponsiveSwitchProps) {
  return (
    <div className="space-y-2">
      <div className="flex items-center justify-between">
        <Label>{label}</Label>
        <Switch checked={checked} onCheckedChange={onChange} />
      </div>
      {description && (
        <p className="text-sm text-muted-foreground">{description}</p>
      )}
      {error && <p className="text-sm text-red-600">{error}</p>}
    </div>
  )
}
```

### 6. 创建触摸手势支持

创建`src/hooks/use-touch-gestures.ts`:

```typescript
'use client'

import { useRef, useEffect, useState, useCallback } from 'react'

interface TouchGestureOptions {
  threshold?: number
  onSwipeLeft?: () => void
  onSwipeRight?: () => void
  onSwipeUp?: () => void
  onSwipeDown?: () => void
  onTap?: () => void
  onDoubleTap?: () => void
  onLongPress?: () => void
}

interface TouchPoint {
  x: number
  y: number
  timestamp: number
}

export function useTouchGestures(
  elementRef: React.RefObject<HTMLElement>,
  options: TouchGestureOptions = {}
) {
  const {
    threshold = 50,
    onSwipeLeft,
    onSwipeRight,
    onSwipeUp,
    onSwipeDown,
    onTap,
    onDoubleTap,
    onLongPress,
  } = options

  const [isPressed, setIsPressed] = useState(false)
  const touchStartRef = useRef<TouchPoint | null>(null)
  const touchEndRef = useRef<TouchPoint | null>(null)
  const lastTapRef = useRef<number>(0)
  const longPressTimerRef = useRef<NodeJS.Timeout | null>(null)

  const handleTouchStart = useCallback((e: TouchEvent) => {
    e.preventDefault()

    const touch = e.touches[0]
    const point: TouchPoint = {
      x: touch.clientX,
      y: touch.clientY,
      timestamp: Date.now(),
    }

    touchStartRef.current = point
    setIsPressed(true)

    // 长按检测
    longPressTimerRef.current = setTimeout(() => {
      if (onLongPress) {
        onLongPress()
      }
    }, 500)

    // 双击检测
    const now = Date.now()
    if (now - lastTapRef.current < 300) {
      if (onDoubleTap) {
        onDoubleTap()
      }
      lastTapRef.current = 0
    } else {
      lastTapRef.current = now
    }
  }, [onLongPress, onDoubleTap])

  const handleTouchMove = useCallback((e: TouchEvent) => {
    e.preventDefault()

    if (!touchStartRef.current) return

    const touch = e.touches[0]
    const currentPoint: TouchPoint = {
      x: touch.clientX,
      y: touch.clientY,
      timestamp: Date.now(),
    }

    // 计算移动距离
    const deltaX = currentPoint.x - touchStartRef.current.x
    const deltaY = currentPoint.y - touchStartRef.current.y

    // 如果移动距离超过阈值，取消长按
    if (Math.abs(deltaX) > 10 || Math.abs(deltaY) > 10) {
      if (longPressTimerRef.current) {
        clearTimeout(longPressTimerRef.current)
        longPressTimerRef.current = null
      }
    }
  }, [])

  const handleTouchEnd = useCallback((e: TouchEvent) => {
    e.preventDefault()

    if (!touchStartRef.current) return

    const touch = e.changedTouches[0]
    const endPoint: TouchPoint = {
      x: touch.clientX,
      y: touch.clientY,
      timestamp: Date.now(),
    }

    touchEndRef.current = endPoint
    setIsPressed(false)

    // 清除长按定时器
    if (longPressTimerRef.current) {
      clearTimeout(longPressTimerRef.current)
      longPressTimerRef.current = null
    }

    // 计算滑动
    const deltaX = endPoint.x - touchStartRef.current.x
    const deltaY = endPoint.y - touchStartRef.current.y
    const deltaTime = endPoint.timestamp - touchStartRef.current.timestamp

    // 计算速度
    const velocityX = Math.abs(deltaX) / deltaTime
    const velocityY = Math.abs(deltaY) / deltaTime

    // 检测滑动方向
    if (Math.abs(deltaX) > threshold && Math.abs(deltaX) > Math.abs(deltaY)) {
      if (deltaX > 0 && velocityX > 0.3) {
        onSwipeRight?.()
      } else if (deltaX < 0 && velocityX > 0.3) {
        onSwipeLeft?.()
      }
    } else if (Math.abs(deltaY) > threshold) {
      if (deltaY > 0 && velocityY > 0.3) {
        onSwipeDown?.()
      } else if (deltaY < 0 && velocityY > 0.3) {
        onSwipeUp?.()
      }
    }

    // 检测点击
    if (Math.abs(deltaX) < 10 && Math.abs(deltaY) < 10 && deltaTime < 300) {
      setTimeout(() => {
        if (Date.now() - lastTapRef.current > 300) {
          onTap?.()
        }
      }, 300)
    }

    touchStartRef.current = null
    touchEndRef.current = null
  }, [threshold, onSwipeLeft, onSwipeRight, onSwipeUp, onSwipeDown, onTap])

  useEffect(() => {
    const element = elementRef.current
    if (!element) return

    element.addEventListener('touchstart', handleTouchStart, { passive: false })
    element.addEventListener('touchmove', handleTouchMove, { passive: false })
    element.addEventListener('touchend', handleTouchEnd, { passive: false })

    return () => {
      element.removeEventListener('touchstart', handleTouchStart)
      element.removeEventListener('touchmove', handleTouchMove)
      element.removeEventListener('touchend', handleTouchEnd)

      if (longPressTimerRef.current) {
        clearTimeout(longPressTimerRef.current)
      }
    }
  }, [handleTouchStart, handleTouchMove, handleTouchEnd])

  return {
    isPressed,
  }
}

// 滑动容器组件
interface SwipeContainerProps {
  children: React.ReactNode
  onSwipeLeft?: () => void
  onSwipeRight?: () => void
  className?: string
}

export function SwipeContainer({
  children,
  onSwipeLeft,
  onSwipeRight,
  className,
}: SwipeContainerProps) {
  const ref = useRef<HTMLDivElement>(null)

  useTouchGestures(ref, {
    onSwipeLeft,
    onSwipeRight,
    threshold: 100,
  })

  return (
    <div ref={ref} className={cn('touch-none', className)}>
      {children}
    </div>
  )
}
```

### 7. 创建性能优化组件

创建`src/components/performance/lazy-image.tsx`:

```typescript
'use client'

import { useState, useRef, useEffect } from 'react'
import { cn } from '@/lib/utils'

interface LazyImageProps extends React.ImgHTMLAttributes<HTMLImageElement> {
  src: string
  placeholder?: string
  blurDataURL?: string
  threshold?: number
  rootMargin?: string
}

export function LazyImage({
  src,
  placeholder,
  blurDataURL,
  threshold = 0.1,
  rootMargin = '50px',
  alt,
  className,
  ...props
}: LazyImageProps) {
  const [isLoaded, setIsLoaded] = useState(false)
  const [isInView, setIsInView] = useState(false)
  const [hasError, setHasError] = useState(false)
  const imgRef = useRef<HTMLImageElement>(null)

  useEffect(() => {
    const observer = new IntersectionObserver(
      ([entry]) => {
        if (entry.isIntersecting) {
          setIsInView(true)
          observer.unobserve(entry.target)
        }
      },
      {
        threshold,
        rootMargin,
      }
    )

    if (imgRef.current) {
      observer.observe(imgRef.current)
    }

    return () => {
      if (imgRef.current) {
        observer.unobserve(imgRef.current)
      }
    }
  }, [threshold, rootMargin])

  const handleLoad = () => {
    setIsLoaded(true)
    setHasError(false)
  }

  const handleError = () => {
    setHasError(true)
    setIsLoaded(false)
  }

  return (
    <div className={cn('relative overflow-hidden', className)}>
      {/* Placeholder */}
      {placeholder && !isLoaded && (
        <div className="absolute inset-0 bg-gray-200 flex items-center justify-center">
          <span className="text-gray-500">{placeholder}</span>
        </div>
      )}

      {/* Blur-up effect */}
      {blurDataURL && !isLoaded && (
        <img
          src={blurDataURL}
          alt=""
          className="absolute inset-0 w-full h-full filter blur-sm scale-110"
          style={{ transition: 'opacity 0.3s ease' }}
        />
      )}

      {/* Actual image */}
      <img
        ref={imgRef}
        src={isInView ? src : undefined}
        alt={alt}
        onLoad={handleLoad}
        onError={handleError}
        className={cn(
          'w-full h-full object-cover transition-opacity duration-300',
          isLoaded ? 'opacity-100' : 'opacity-0',
          className
        )}
        {...props}
      />

      {/* Loading skeleton */}
      {!isLoaded && !hasError && !placeholder && (
        <div className="absolute inset-0 bg-gray-200 animate-pulse" />
      )}

      {/* Error fallback */}
      {hasError && (
        <div className="absolute inset-0 bg-gray-100 flex items-center justify-center">
          <div className="text-center">
            <div className="text-gray-400 mb-2">图片加载失败</div>
            <button
              onClick={() => {
                setHasError(false)
                setIsInView(true)
              }}
              className="text-sm text-blue-600 hover:underline"
            >
              重试
            </button>
          </div>
        </div>
      )}
    </div>
  )
}
```

### 8. 创建响应式页面模板

创建`src/templates/responsive-page.tsx`:

```typescript
'use client'

import { ReactNode } from 'react'
import { MainLayout } from '@/components/layout/main-layout'
import { MobileNavigation } from '@/components/layout/mobile-navigation'
import { useIsMobile } from '@/hooks/use-mobile'
import { cn } from '@/lib/utils'

interface ResponsivePageTemplateProps {
  children: ReactNode
  title: string
  description?: string
  user?: {
    name: string
    email: string
    avatar?: string
  }
  className?: string
  showMobileNav?: boolean
}

export function ResponsivePageTemplate({
  children,
  title,
  description,
  user,
  className,
  showMobileNav = true,
}: ResponsivePageTemplateProps) {
  const isMobile = useIsMobile()

  return (
    <>
      {/* 移动端导航 */}
      {isMobile && showMobileNav && <MobileNavigation user={user} />}

      {/* 主要内容 */}
      <div className={cn('min-h-screen bg-background', isMobile ? '' : 'pt-0')}>
        {!isMobile ? (
          <MainLayout user={user}>
            <div className={cn('space-y-6', className)}>
              {/* 页面标题 */}
              <div>
                <h1 className="text-3xl font-bold tracking-tight">{title}</h1>
                {description && (
                  <p className="text-muted-foreground">{description}</p>
                )}
              </div>
              {/* 页面内容 */}
              {children}
            </div>
          </MainLayout>
        ) : (
          <div className={cn('container mx-auto p-4 space-y-6', className)}>
            {/* 移动端页面标题 */}
            <div>
              <h1 className="text-2xl font-bold tracking-tight">{title}</h1>
              {description && (
                <p className="text-muted-foreground text-sm">{description}</p>
              )}
            </div>
            {/* 移动端页面内容 */}
            {children}
          </div>
        )}
      </div>
    </>
  )
}

// 使用示例：
/*
function OrdersPage() {
  return (
    <ResponsivePageTemplate
      title="订单管理"
      description="管理所有运输订单"
      user={{ name: '演示用户', email: 'demo@example.com' }}
    >
      <OrderList />
    </ResponsivePageTemplate>
  )
}
*/
```

### 9. 更新现有页面以支持响应式

以订单页面为例，更新`src/app/orders/page.tsx`:

```typescript
'use client'

import { useState, useEffect } from 'react'
import { ResponsivePageTemplate } from '@/templates/responsive-page'
import { ResponsiveTable } from '@/components/ui/responsive-table'
import { OrderList } from '@/components/order/order-list'
import { Button } from '@/components/ui/button'
import { Plus, Search, Filter } from 'lucide-react'
import { Order } from '@/types/order'
import { ResponsiveInput } from '@/components/ui/responsive-form'

// 模拟数据
const mockOrders: Order[] = [
  // ... 订单数据
]

export default function OrdersPage() {
  const [orders, setOrders] = useState<Order[]>(mockOrders)
  const [searchTerm, setSearchTerm] = useState('')
  const [loading, setLoading] = useState(false)

  // 筛选订单
  const filteredOrders = orders.filter(order =>
    order.orderNumber.toLowerCase().includes(searchTerm.toLowerCase()) ||
    order.consigneeName.toLowerCase().includes(searchTerm.toLowerCase())
  )

  // 表格列定义
  const columns = [
    {
      key: 'orderNumber' as keyof Order,
      title: '订单号',
      mobile: true,
    },
    {
      key: 'consigneeName' as keyof Order,
      title: '收货人',
      mobile: true,
    },
    {
      key: 'weight' as keyof Order,
      title: '重量',
      render: (value: number) => `${value}kg`,
      mobile: true,
    },
    {
      key: 'status' as keyof Order,
      title: '状态',
      render: (value: string) => (
        <span className={`px-2 py-1 rounded-full text-xs ${
          value === 'PENDING' ? 'bg-yellow-100 text-yellow-800' :
          value === 'IN_TRANSIT' ? 'bg-blue-100 text-blue-800' :
          value === 'COMPLETED' ? 'bg-green-100 text-green-800' :
          'bg-gray-100 text-gray-800'
        }`}>
          {value}
        </span>
      ),
      mobile: true,
    },
    {
      key: 'createdAt' as keyof Order,
      title: '创建时间',
      render: (value: string) => new Date(value).toLocaleDateString(),
    },
  ]

  return (
    <ResponsivePageTemplate
      title="订单管理"
      description="管理所有运输订单"
      user={{ name: '演示用户', email: 'demo@example.com' }}
    >
      {/* 搜索和操作栏 */}
      <div className="flex flex-col sm:flex-row gap-4 mb-6">
        <ResponsiveInput
          placeholder="搜索订单号或收货人..."
          value={searchTerm}
          onChange={setSearchTerm}
          className="flex-1"
        />
        <div className="flex gap-2">
          <Button variant="outline" size="sm">
            <Filter className="h-4 w-4 mr-1" />
            筛选
          </Button>
          <Button size="sm">
            <Plus className="h-4 w-4 mr-1" />
            新建订单
          </Button>
        </div>
      </div>

      {/* 订单列表 */}
      <ResponsiveTable
        data={filteredOrders}
        columns={columns}
        title="订单列表"
        description={`共找到 ${filteredOrders.length} 个订单`}
        onRowClick={(order) => {
          // 处理行点击
        }}
        onView={(order) => {
          // 处理查看
        }}
        onEdit={(order) => {
          // 处理编辑
        }}
        onDelete={(order) => {
          // 处理删除
        }}
        loading={loading}
        pagination={{
          page: 1,
          pageSize: 10,
          total: filteredOrders.length,
          onPageChange: (page) => {
            // 处理分页
          },
          onPageSizeChange: (pageSize) => {
            // 处理页码大小变化
          },
        }}
      />
    </ResponsivePageTemplate>
  )
}
```

### 10. 创建无障碍访问支持

创建`src/components/ui/focus-trap.tsx`:

```typescript
'use client'

import { useRef, useEffect, ReactNode } from 'react'

interface FocusTrapProps {
  children: ReactNode
  active?: boolean
  onEscape?: () => void
}

export function FocusTrap({ children, active = true, onEscape }: FocusTrapProps) {
  const containerRef = useRef<HTMLDivElement>(null)

  useEffect(() => {
    if (!active) return

    const container = containerRef.current
    if (!container) return

    const focusableElements = container.querySelectorAll(
      'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'
    ) as NodeListOf<HTMLElement>

    if (focusableElements.length === 0) return

    const firstElement = focusableElements[0]
    const lastElement = focusableElements[focusableElements.length - 1]

    const handleKeyDown = (e: KeyboardEvent) => {
      if (e.key === 'Escape') {
        onEscape?.()
        return
      }

      if (e.key !== 'Tab') return

      if (e.shiftKey) {
        if (document.activeElement === firstElement) {
          e.preventDefault()
          lastElement.focus()
        }
      } else {
        if (document.activeElement === lastElement) {
          e.preventDefault()
          firstElement.focus()
        }
      }
    }

    container.addEventListener('keydown', handleKeyDown)

    // 初始聚焦
    setTimeout(() => {
      firstElement.focus()
    }, 100)

    return () => {
      container.removeEventListener('keydown', handleKeyDown)
    }
  }, [active, onEscape])

  return (
    <div ref={containerRef} tabIndex={-1}>
      {children}
    </div>
  )
}
```

## 验证清单

- [ ] 所有页面在移动端显示正确
- [ ] 触摸手势功能正常
- [ ] 响应式表格和表单工作正常
- [ ] 移动端导航体验良好
- [ ] 图片懒加载功能正常
- [ ] 无障碍访问支持完善
- [ ] 性能优化生效
- [ ] 跨浏览器兼容性良好

## 测试命令

```bash
# 启动开发服务器
npm run dev

# 运行类型检查
npm run type-check

# 运行测试
npm test

# 检查构建
npm run build

# 运行Lighthouse审计
npm run lighthouse
```

## 注意事项

- 确保在真实设备上测试移动端体验
- 优化图片和资源加载性能
- 实现适当的触摸反馈
- 考虑离线功能和缓存策略
- 确保键盘导航支持
- 定期进行性能监控和优化