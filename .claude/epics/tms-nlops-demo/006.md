---
title: "TMS NL-Ops演示系统任务006: 开发环境配置 (ESLint, Prettier, Git hooks)"
epic: "tms-nlops-demo"
task: "006"
phase: "1"
status: "pending"
priority: "medium"
estimated_hours: 2
parallel: true
depends_on: ["001", "005"]
tags: ["development", "tools", "quality", "workflow"]
created: "2025-09-20T04:20:45Z"
updated: "2025-09-20T04:20:45Z"
---

## 概述

配置完整的开发环境工具链，包括ESLint代码检查、Prettier代码格式化、Git hooks自动化工作流，确保代码质量和团队协作效率。

## 目标

- 配置ESLint规则和插件
- 设置Prettier格式化规则
- 配置Git hooks自动化流程
- 建立代码提交规范
- 集成开发工具提升效率

## 工具栈

- **ESLint**: 代码质量检查
- **Prettier**: 代码格式化
- **Husky**: Git hooks管理
- **lint-staged**: 暂存文件检查
- **Commitizen**: 规范化提交
- **Commitlint**: 提交信息验证

## 实施步骤

### 1. 配置ESLint

创建`.eslintrc.json`:

```json
{
  "extends": [
    "next/core-web-vitals",
    "prettier"
  ],
  "plugins": [
    "@typescript-eslint",
    "react-hooks"
  ],
  "rules": {
    "@typescript-eslint/no-unused-vars": ["error", { "argsIgnorePattern": "^_" }],
    "@typescript-eslint/no-explicit-any": "warn",
    "@typescript-eslint/explicit-function-return-type": "off",
    "@typescript-eslint/explicit-module-boundary-types": "off",
    "@typescript-eslint/no-empty-interface": "off",
    "react-hooks/rules-of-hooks": "error",
    "react-hooks/exhaustive-deps": "warn",
    "no-console": ["warn", { "allow": ["warn", "error"] }],
    "prefer-const": "error",
    "no-var": "error",
    "no-multiple-empty-lines": ["error", { "max": 1 }],
    "eol-last": "error",
    "no-trailing-spaces": "error"
  },
  "parser": "@typescript-eslint/parser",
  "parserOptions": {
    "ecmaVersion": 2021,
    "sourceType": "module",
    "ecmaFeatures": {
      "jsx": true
    }
  },
  "env": {
    "browser": true,
    "node": true,
    "es2021": true
  },
  "overrides": [
    {
      "files": ["*.js", "*.jsx", "*.ts", "*.tsx"],
      "rules": {
        "@typescript-eslint/no-var-requires": "off"
      }
    }
  ]
}
```

### 2. 配置Prettier

创建`.prettierrc`:

```json
{
  "semi": true,
  "trailingComma": "es5",
  "singleQuote": true,
  "printWidth": 100,
  "tabWidth": 2,
  "useTabs": false,
  "bracketSpacing": true,
  "arrowParens": "avoid",
  "endOfLine": "lf",
  "bracketSameLine": false,
  "quoteProps": "as-needed"
}
```

创建`.prettierignore`:

```
# Dependencies
node_modules/
.next/
dist/
build/

# Prisma
prisma/migrations/
prisma/generated/

# Environment files
.env*
.env.local
.env.development.local
.env.test.local
.env.production.local

# Logs
*.log
npm-debug.log*
yarn-debug.log*
yarn-error.log*
pnpm-debug.log*

# Runtime data
pids
*.pid
*.seed
*.pid.lock

# Coverage directory used by tools like istanbul
coverage/
*.lcov

# nyc test coverage
.nyc_output

# Dependency directories
node_modules/
jspm_packages/

# Optional npm cache directory
.npm

# Optional eslint cache
.eslintcache

# Optional REPL history
.node_repl_history

# Output of 'npm pack'
*.tgz

# Yarn Integrity file
.yarn-integrity

# parcel-bundler cache (https://parceljs.org/)
.cache
.parcel-cache

# Next.js build output
.next
out

# Nuxt.js build / generate output
.nuxt
dist

# Gatsby files
.cache/
public

# Storybook build outputs
.out
.storybook-out

# Temporary folders
tmp/
temp/

# Editor directories and files
.vscode/
.idea/
*.swp
*.swo
*~

# OS generated files
.DS_Store
.DS_Store?
._*
.Spotlight-V100
.Trashes
ehthumbs.db
Thumbs.db

# Git
.git/
.gitignore

# Docker
Dockerfile
docker-compose*.yml

# Scripts
scripts/
```

### 3. 配置Git hooks

创建`husky.config.js`:

```javascript
module.exports = {
  hooks: {
    'pre-commit': 'lint-staged',
    'commit-msg': 'commitlint -E HUSKY_GIT_PARAMS',
    'pre-push': 'npm run type-check && npm run build'
  }
}
```

### 4. 配置Commitlint

创建`commitlint.config.js`:

```javascript
module.exports = {
  extends: ['@commitlint/config-conventional'],
  rules: {
    'type-enum': [
      2,
      'always',
      [
        'feat',     // 新功能
        'fix',      // 修复bug
        'docs',     // 文档更新
        'style',    // 代码格式（不影响功能）
        'refactor', // 重构（既不是新增功能，也不是修改bug的代码变动）
        'perf',     // 性能优化
        'test',     // 新增或修改测试
        'chore',    // 构建过程或辅助工具的变动
        'ci',       // CI配置
        'build',    // 构建相关
        'revert',   // 回滚
        'wip',      // 进行中的工作
      ],
    ],
    'type-case': [2, 'always', 'lower-case'],
    'type-empty': [2, 'never'],
    'scope-case': [2, 'always', 'lower-case'],
    'subject-case': [2, 'never', ['sentence-case', 'start-case', 'pascal-case', 'upper-case']],
    'subject-empty': [2, 'never'],
    'subject-full-stop': [2, 'never', '.'],
    'header-max-length': [2, 'always', 72],
    'body-leading-blank': [1, 'always'],
    'body-max-line-length': [2, 'always', 100],
    'footer-leading-blank': [1, 'always'],
    'footer-max-line-length': [2, 'always', 100],
  },
  prompt: {
    questions: {
      type: {
        description: '选择你要提交的更改类型:',
        enum: {
          feat: {
            description: '新功能',
            title: 'Features',
            emoji: '✨',
          },
          fix: {
            description: 'Bug修复',
            title: 'Bug Fixes',
            emoji: '🐛',
          },
          docs: {
            description: '文档更新',
            title: 'Documentation',
            emoji: '📚',
          },
          style: {
            description: '代码格式（不影响功能）',
            title: 'Styles',
            emoji: '💎',
          },
          refactor: {
            description: '重构（既不是新增功能，也不是修改bug的代码变动）',
            title: 'Code Refactoring',
            emoji: '📦',
          },
          perf: {
            description: '性能优化',
            title: 'Performance Improvements',
            emoji: '🚀',
          },
          test: {
            description: '新增或修改测试',
            title: 'Tests',
            emoji: '🚨',
          },
          build: {
            description: '构建相关',
            title: 'Builds',
            emoji: '🛠',
          },
          ci: {
            description: 'CI配置',
            title: 'Continuous Integrations',
            emoji: '⚙️',
          },
          chore: {
            description: '构建过程或辅助工具的变动',
            title: 'Chores',
            emoji: '♻️',
          },
          revert: {
            description: '回滚',
            title: 'Reverts',
            emoji: '🗑',
          },
        },
      },
      scope: {
        description: '此更改的范围是什么（例如组件或文件名）:',
      },
      subject: {
        description: '写一个简短的变更描述:',
      },
      body: {
        description: '提供更详细的变更描述:',
      },
      isBreaking: {
        description: '是否有破坏性变更?',
      },
      breakingBody: {
        description: '破坏性变更的详细描述:',
      },
      breaking: {
        description: '描述破坏性变更:',
      },
      isIssueAffected: {
        description: '此变更是否影响任何开放的issue?',
      },
      issuesBody: {
        description: '如果issues被关闭，提交需要一个body。请输入更长的变更描述:',
      },
      issues: {
        description: '添加issue引用 (例如 "fix #123", "re #123".):',
      },
    },
  },
}
```

### 5. 配置lint-staged

更新`package.json`中的lint-staged配置:

```json
{
  "lint-staged": {
    "*.{js,jsx,ts,tsx}": [
      "eslint --fix",
      "prettier --write"
    ],
    "*.{json,md,yml,yaml}": [
      "prettier --write"
    ],
    "*.{css,scss,sass}": [
      "prettier --write"
    ]
  }
}
```

### 6. 创建代码质量脚本

创建`scripts/code-quality.js`:

```javascript
const { execSync } = require('child_process')
const fs = require('fs')
const path = require('path')

function checkCodeQuality() {
  console.log('🔍 开始代码质量检查...')

  try {
    // 1. ESLint检查
    console.log('📋 运行ESLint检查...')
    execSync('npm run lint', { stdio: 'inherit' })

    // 2. Prettier格式检查
    console.log('✨ 检查代码格式...')
    execSync('npm run format:check', { stdio: 'inherit' })

    // 3. TypeScript类型检查
    console.log('🔧 运行TypeScript类型检查...')
    execSync('npm run type-check', { stdio: 'inherit' })

    // 4. 检查大文件
    console.log('📦 检查文件大小...')
    const largeFiles = findLargeFiles('.', 1024 * 1024) // 1MB
    if (largeFiles.length > 0) {
      console.warn('⚠️  发现大文件:')
      largeFiles.forEach(file => {
        console.warn(`   ${file.path} (${file.size} bytes)`)
      })
    }

    // 5. 检查未使用的依赖
    console.log('📦 检查未使用的依赖...')
    try {
      execSync('npx depcheck', { stdio: 'inherit' })
    } catch (error) {
      console.warn('⚠️  跳过依赖检查 (depcheck未安装)')
    }

    console.log('✅ 所有代码质量检查通过!')

  } catch (error) {
    console.error('❌ 代码质量检查失败:', error.message)
    process.exit(1)
  }
}

function findLargeFiles(dir, maxSize) {
  const largeFiles = []

  function scanDirectory(currentDir) {
    const files = fs.readdirSync(currentDir)

    for (const file of files) {
      const filePath = path.join(currentDir, file)
      const stat = fs.statSync(filePath)

      if (stat.isDirectory()) {
        // 跳过node_modules和.next目录
        if (!['node_modules', '.next', 'dist', 'build'].includes(file)) {
          scanDirectory(filePath)
        }
      } else if (stat.size > maxSize) {
        largeFiles.push({
          path: filePath,
          size: stat.size
        })
      }
    }
  }

  scanDirectory(dir)
  return largeFiles
}

if (require.main === module) {
  checkCodeQuality()
}

module.exports = { checkCodeQuality, findLargeFiles }
```

### 7. 创建开发环境配置

创建`.vscode/settings.json`:

```json
{
  "typescript.preferences.importModuleSpecifier": "relative",
  "editor.codeActionsOnSave": {
    "source.fixAll.eslint": true,
    "source.fixAll.format": true
  },
  "editor.formatOnSave": true,
  "editor.defaultFormatter": "esbenp.prettier-vscode",
  "editor.tabSize": 2,
  "editor.insertSpaces": true,
  "files.trimTrailingWhitespace": true,
  "files.insertFinalNewline": true,
  "search.exclude": {
    "**/node_modules": true,
    "**/.next": true,
    "**/dist": true,
    "**/build": true,
    "**/.git": true
  },
  "files.watcherExclude": {
    "**/node_modules/**": true,
    "**/.next/**": true,
    "**/dist/**": true,
    "**/build/**": true
  },
  "typescript.tsdk": "node_modules/typescript/lib",
  "typescript.enablePromptUseWorkspaceTsdk": true,
  "eslint.validate": [
    "javascript",
    "javascriptreact",
    "typescript",
    "typescriptreact"
  ],
  "[typescript]": {
    "editor.defaultFormatter": "esbenp.prettier-vscode"
  },
  "[typescriptreact]": {
    "editor.defaultFormatter": "esbenp.prettier-vscode"
  },
  "[javascript]": {
    "editor.defaultFormatter": "esbenp.prettier-vscode"
  },
  "[javascriptreact]": {
    "editor.defaultFormatter": "esbenp.prettier-vscode"
  },
  "[json]": {
    "editor.defaultFormatter": "esbenp.prettier-vscode"
  },
  "[markdown]": {
    "editor.defaultFormatter": "esbenp.prettier-vscode"
  }
}
```

创建`.vscode/extensions.json`:

```json
{
  "recommendations": [
    "dbaeumer.vscode-eslint",
    "esbenp.prettier-vscode",
    "bradlc.vscode-tailwindcss",
    "ms-vscode.vscode-typescript-next",
    "prisma.prisma",
    "ms-vscode.vscode-json",
    "streetsidesoftware.code-spell-checker",
    "eamodio.gitlens",
    "ms-vscode.vscode-eslint"
  ]
}
```

### 8. 创建开发工具脚本

创建`scripts/dev-tools.js`:

```javascript
const { execSync } = require('child_process')

function setupDevEnvironment() {
  console.log('🚀 设置开发环境...')

  try {
    // 1. 安装依赖
    console.log('📦 安装依赖包...')
    execSync('npm install', { stdio: 'inherit' })

    // 2. 生成Prisma客户端
    console.log('🗄️  生成Prisma客户端...')
    execSync('npm run db:generate', { stdio: 'inherit' })

    // 3. 初始化Git hooks
    console.log('🪝 初始化Git hooks...')
    execSync('npm run prepare', { stdio: 'inherit' })

    // 4. 运行代码质量检查
    console.log('🔍 运行代码质量检查...')
    execSync('node scripts/code-quality.js', { stdio: 'inherit' })

    console.log('✅ 开发环境设置完成!')

  } catch (error) {
    console.error('❌ 开发环境设置失败:', error.message)
    process.exit(1)
  }
}

function runDevServer() {
  console.log('🚀 启动开发服务器...')
  execSync('npm run dev', { stdio: 'inherit' })
}

if (require.main === module) {
  const command = process.argv[2]

  switch (command) {
    case 'setup':
      setupDevEnvironment()
      break
    case 'start':
      runDevServer()
      break
    default:
      console.log('可用命令:')
      console.log('  setup  - 设置开发环境')
      console.log('  start  - 启动开发服务器')
      process.exit(1)
  }
}

module.exports = { setupDevEnvironment, runDevServer }
```

### 9. 更新package.json脚本

在`package.json`中添加新的脚本:

```json
{
  "scripts": {
    "setup": "node scripts/dev-tools.js setup",
    "quality": "node scripts/code-quality.js",
    "prepare": "husky install",
    "commit": "git-cz"
  }
}
```

## 验证清单

- [ ] ESLint配置正确工作
- [ ] Prettier格式化规则生效
- [ ] Git hooks自动运行
- [ ] 代码提交规范验证
- [ ] 开发工具集成完成
- [ ] 代码质量检查脚本可用
- [ ] VSCode配置正确

## 测试命令

```bash
# 设置开发环境
npm run setup

# 测试ESLint
npm run lint

# 测试Prettier格式
npm run format:check

# 测试代码质量
npm run quality

# 测试Git hooks
git add .
git commit -m "test: 验证git hooks"

# 测试规范化提交
npm run commit
```

## 注意事项

- 确保所有开发人员使用相同的工具配置
- 定期更新依赖包版本
- 监控代码质量指标
- 培训团队成员使用开发工具
- 考虑集成CI/CD流程
- 备份重要配置文件</think>