---
title: "TMS NL-Opsæ¼”ç¤ºç³»ç»Ÿä»»åŠ¡006: å¼€å‘ç¯å¢ƒé…ç½® (ESLint, Prettier, Git hooks)"
epic: "tms-nlops-demo"
task: "006"
phase: "1"
status: "pending"
priority: "medium"
estimated_hours: 2
parallel: true
depends_on: ["001", "005"]
tags: ["development", "tools", "quality", "workflow"]
created: "2025-09-20T04:20:45Z"
updated: "2025-09-20T04:20:45Z"
---

## æ¦‚è¿°

é…ç½®å®Œæ•´çš„å¼€å‘ç¯å¢ƒå·¥å…·é“¾ï¼ŒåŒ…æ‹¬ESLintä»£ç æ£€æŸ¥ã€Prettierä»£ç æ ¼å¼åŒ–ã€Git hooksè‡ªåŠ¨åŒ–å·¥ä½œæµï¼Œç¡®ä¿ä»£ç è´¨é‡å’Œå›¢é˜Ÿåä½œæ•ˆç‡ã€‚

## ç›®æ ‡

- é…ç½®ESLintè§„åˆ™å’Œæ’ä»¶
- è®¾ç½®Prettieræ ¼å¼åŒ–è§„åˆ™
- é…ç½®Git hooksè‡ªåŠ¨åŒ–æµç¨‹
- å»ºç«‹ä»£ç æäº¤è§„èŒƒ
- é›†æˆå¼€å‘å·¥å…·æå‡æ•ˆç‡

## å·¥å…·æ ˆ

- **ESLint**: ä»£ç è´¨é‡æ£€æŸ¥
- **Prettier**: ä»£ç æ ¼å¼åŒ–
- **Husky**: Git hooksç®¡ç†
- **lint-staged**: æš‚å­˜æ–‡ä»¶æ£€æŸ¥
- **Commitizen**: è§„èŒƒåŒ–æäº¤
- **Commitlint**: æäº¤ä¿¡æ¯éªŒè¯

## å®æ–½æ­¥éª¤

### 1. é…ç½®ESLint

åˆ›å»º`.eslintrc.json`:

```json
{
  "extends": [
    "next/core-web-vitals",
    "prettier"
  ],
  "plugins": [
    "@typescript-eslint",
    "react-hooks"
  ],
  "rules": {
    "@typescript-eslint/no-unused-vars": ["error", { "argsIgnorePattern": "^_" }],
    "@typescript-eslint/no-explicit-any": "warn",
    "@typescript-eslint/explicit-function-return-type": "off",
    "@typescript-eslint/explicit-module-boundary-types": "off",
    "@typescript-eslint/no-empty-interface": "off",
    "react-hooks/rules-of-hooks": "error",
    "react-hooks/exhaustive-deps": "warn",
    "no-console": ["warn", { "allow": ["warn", "error"] }],
    "prefer-const": "error",
    "no-var": "error",
    "no-multiple-empty-lines": ["error", { "max": 1 }],
    "eol-last": "error",
    "no-trailing-spaces": "error"
  },
  "parser": "@typescript-eslint/parser",
  "parserOptions": {
    "ecmaVersion": 2021,
    "sourceType": "module",
    "ecmaFeatures": {
      "jsx": true
    }
  },
  "env": {
    "browser": true,
    "node": true,
    "es2021": true
  },
  "overrides": [
    {
      "files": ["*.js", "*.jsx", "*.ts", "*.tsx"],
      "rules": {
        "@typescript-eslint/no-var-requires": "off"
      }
    }
  ]
}
```

### 2. é…ç½®Prettier

åˆ›å»º`.prettierrc`:

```json
{
  "semi": true,
  "trailingComma": "es5",
  "singleQuote": true,
  "printWidth": 100,
  "tabWidth": 2,
  "useTabs": false,
  "bracketSpacing": true,
  "arrowParens": "avoid",
  "endOfLine": "lf",
  "bracketSameLine": false,
  "quoteProps": "as-needed"
}
```

åˆ›å»º`.prettierignore`:

```
# Dependencies
node_modules/
.next/
dist/
build/

# Prisma
prisma/migrations/
prisma/generated/

# Environment files
.env*
.env.local
.env.development.local
.env.test.local
.env.production.local

# Logs
*.log
npm-debug.log*
yarn-debug.log*
yarn-error.log*
pnpm-debug.log*

# Runtime data
pids
*.pid
*.seed
*.pid.lock

# Coverage directory used by tools like istanbul
coverage/
*.lcov

# nyc test coverage
.nyc_output

# Dependency directories
node_modules/
jspm_packages/

# Optional npm cache directory
.npm

# Optional eslint cache
.eslintcache

# Optional REPL history
.node_repl_history

# Output of 'npm pack'
*.tgz

# Yarn Integrity file
.yarn-integrity

# parcel-bundler cache (https://parceljs.org/)
.cache
.parcel-cache

# Next.js build output
.next
out

# Nuxt.js build / generate output
.nuxt
dist

# Gatsby files
.cache/
public

# Storybook build outputs
.out
.storybook-out

# Temporary folders
tmp/
temp/

# Editor directories and files
.vscode/
.idea/
*.swp
*.swo
*~

# OS generated files
.DS_Store
.DS_Store?
._*
.Spotlight-V100
.Trashes
ehthumbs.db
Thumbs.db

# Git
.git/
.gitignore

# Docker
Dockerfile
docker-compose*.yml

# Scripts
scripts/
```

### 3. é…ç½®Git hooks

åˆ›å»º`husky.config.js`:

```javascript
module.exports = {
  hooks: {
    'pre-commit': 'lint-staged',
    'commit-msg': 'commitlint -E HUSKY_GIT_PARAMS',
    'pre-push': 'npm run type-check && npm run build'
  }
}
```

### 4. é…ç½®Commitlint

åˆ›å»º`commitlint.config.js`:

```javascript
module.exports = {
  extends: ['@commitlint/config-conventional'],
  rules: {
    'type-enum': [
      2,
      'always',
      [
        'feat',     // æ–°åŠŸèƒ½
        'fix',      // ä¿®å¤bug
        'docs',     // æ–‡æ¡£æ›´æ–°
        'style',    // ä»£ç æ ¼å¼ï¼ˆä¸å½±å“åŠŸèƒ½ï¼‰
        'refactor', // é‡æ„ï¼ˆæ—¢ä¸æ˜¯æ–°å¢åŠŸèƒ½ï¼Œä¹Ÿä¸æ˜¯ä¿®æ”¹bugçš„ä»£ç å˜åŠ¨ï¼‰
        'perf',     // æ€§èƒ½ä¼˜åŒ–
        'test',     // æ–°å¢æˆ–ä¿®æ”¹æµ‹è¯•
        'chore',    // æ„å»ºè¿‡ç¨‹æˆ–è¾…åŠ©å·¥å…·çš„å˜åŠ¨
        'ci',       // CIé…ç½®
        'build',    // æ„å»ºç›¸å…³
        'revert',   // å›æ»š
        'wip',      // è¿›è¡Œä¸­çš„å·¥ä½œ
      ],
    ],
    'type-case': [2, 'always', 'lower-case'],
    'type-empty': [2, 'never'],
    'scope-case': [2, 'always', 'lower-case'],
    'subject-case': [2, 'never', ['sentence-case', 'start-case', 'pascal-case', 'upper-case']],
    'subject-empty': [2, 'never'],
    'subject-full-stop': [2, 'never', '.'],
    'header-max-length': [2, 'always', 72],
    'body-leading-blank': [1, 'always'],
    'body-max-line-length': [2, 'always', 100],
    'footer-leading-blank': [1, 'always'],
    'footer-max-line-length': [2, 'always', 100],
  },
  prompt: {
    questions: {
      type: {
        description: 'é€‰æ‹©ä½ è¦æäº¤çš„æ›´æ”¹ç±»å‹:',
        enum: {
          feat: {
            description: 'æ–°åŠŸèƒ½',
            title: 'Features',
            emoji: 'âœ¨',
          },
          fix: {
            description: 'Bugä¿®å¤',
            title: 'Bug Fixes',
            emoji: 'ğŸ›',
          },
          docs: {
            description: 'æ–‡æ¡£æ›´æ–°',
            title: 'Documentation',
            emoji: 'ğŸ“š',
          },
          style: {
            description: 'ä»£ç æ ¼å¼ï¼ˆä¸å½±å“åŠŸèƒ½ï¼‰',
            title: 'Styles',
            emoji: 'ğŸ’',
          },
          refactor: {
            description: 'é‡æ„ï¼ˆæ—¢ä¸æ˜¯æ–°å¢åŠŸèƒ½ï¼Œä¹Ÿä¸æ˜¯ä¿®æ”¹bugçš„ä»£ç å˜åŠ¨ï¼‰',
            title: 'Code Refactoring',
            emoji: 'ğŸ“¦',
          },
          perf: {
            description: 'æ€§èƒ½ä¼˜åŒ–',
            title: 'Performance Improvements',
            emoji: 'ğŸš€',
          },
          test: {
            description: 'æ–°å¢æˆ–ä¿®æ”¹æµ‹è¯•',
            title: 'Tests',
            emoji: 'ğŸš¨',
          },
          build: {
            description: 'æ„å»ºç›¸å…³',
            title: 'Builds',
            emoji: 'ğŸ› ',
          },
          ci: {
            description: 'CIé…ç½®',
            title: 'Continuous Integrations',
            emoji: 'âš™ï¸',
          },
          chore: {
            description: 'æ„å»ºè¿‡ç¨‹æˆ–è¾…åŠ©å·¥å…·çš„å˜åŠ¨',
            title: 'Chores',
            emoji: 'â™»ï¸',
          },
          revert: {
            description: 'å›æ»š',
            title: 'Reverts',
            emoji: 'ğŸ—‘',
          },
        },
      },
      scope: {
        description: 'æ­¤æ›´æ”¹çš„èŒƒå›´æ˜¯ä»€ä¹ˆï¼ˆä¾‹å¦‚ç»„ä»¶æˆ–æ–‡ä»¶åï¼‰:',
      },
      subject: {
        description: 'å†™ä¸€ä¸ªç®€çŸ­çš„å˜æ›´æè¿°:',
      },
      body: {
        description: 'æä¾›æ›´è¯¦ç»†çš„å˜æ›´æè¿°:',
      },
      isBreaking: {
        description: 'æ˜¯å¦æœ‰ç ´åæ€§å˜æ›´?',
      },
      breakingBody: {
        description: 'ç ´åæ€§å˜æ›´çš„è¯¦ç»†æè¿°:',
      },
      breaking: {
        description: 'æè¿°ç ´åæ€§å˜æ›´:',
      },
      isIssueAffected: {
        description: 'æ­¤å˜æ›´æ˜¯å¦å½±å“ä»»ä½•å¼€æ”¾çš„issue?',
      },
      issuesBody: {
        description: 'å¦‚æœissuesè¢«å…³é—­ï¼Œæäº¤éœ€è¦ä¸€ä¸ªbodyã€‚è¯·è¾“å…¥æ›´é•¿çš„å˜æ›´æè¿°:',
      },
      issues: {
        description: 'æ·»åŠ issueå¼•ç”¨ (ä¾‹å¦‚ "fix #123", "re #123".):',
      },
    },
  },
}
```

### 5. é…ç½®lint-staged

æ›´æ–°`package.json`ä¸­çš„lint-stagedé…ç½®:

```json
{
  "lint-staged": {
    "*.{js,jsx,ts,tsx}": [
      "eslint --fix",
      "prettier --write"
    ],
    "*.{json,md,yml,yaml}": [
      "prettier --write"
    ],
    "*.{css,scss,sass}": [
      "prettier --write"
    ]
  }
}
```

### 6. åˆ›å»ºä»£ç è´¨é‡è„šæœ¬

åˆ›å»º`scripts/code-quality.js`:

```javascript
const { execSync } = require('child_process')
const fs = require('fs')
const path = require('path')

function checkCodeQuality() {
  console.log('ğŸ” å¼€å§‹ä»£ç è´¨é‡æ£€æŸ¥...')

  try {
    // 1. ESLintæ£€æŸ¥
    console.log('ğŸ“‹ è¿è¡ŒESLintæ£€æŸ¥...')
    execSync('npm run lint', { stdio: 'inherit' })

    // 2. Prettieræ ¼å¼æ£€æŸ¥
    console.log('âœ¨ æ£€æŸ¥ä»£ç æ ¼å¼...')
    execSync('npm run format:check', { stdio: 'inherit' })

    // 3. TypeScriptç±»å‹æ£€æŸ¥
    console.log('ğŸ”§ è¿è¡ŒTypeScriptç±»å‹æ£€æŸ¥...')
    execSync('npm run type-check', { stdio: 'inherit' })

    // 4. æ£€æŸ¥å¤§æ–‡ä»¶
    console.log('ğŸ“¦ æ£€æŸ¥æ–‡ä»¶å¤§å°...')
    const largeFiles = findLargeFiles('.', 1024 * 1024) // 1MB
    if (largeFiles.length > 0) {
      console.warn('âš ï¸  å‘ç°å¤§æ–‡ä»¶:')
      largeFiles.forEach(file => {
        console.warn(`   ${file.path} (${file.size} bytes)`)
      })
    }

    // 5. æ£€æŸ¥æœªä½¿ç”¨çš„ä¾èµ–
    console.log('ğŸ“¦ æ£€æŸ¥æœªä½¿ç”¨çš„ä¾èµ–...')
    try {
      execSync('npx depcheck', { stdio: 'inherit' })
    } catch (error) {
      console.warn('âš ï¸  è·³è¿‡ä¾èµ–æ£€æŸ¥ (depcheckæœªå®‰è£…)')
    }

    console.log('âœ… æ‰€æœ‰ä»£ç è´¨é‡æ£€æŸ¥é€šè¿‡!')

  } catch (error) {
    console.error('âŒ ä»£ç è´¨é‡æ£€æŸ¥å¤±è´¥:', error.message)
    process.exit(1)
  }
}

function findLargeFiles(dir, maxSize) {
  const largeFiles = []

  function scanDirectory(currentDir) {
    const files = fs.readdirSync(currentDir)

    for (const file of files) {
      const filePath = path.join(currentDir, file)
      const stat = fs.statSync(filePath)

      if (stat.isDirectory()) {
        // è·³è¿‡node_moduleså’Œ.nextç›®å½•
        if (!['node_modules', '.next', 'dist', 'build'].includes(file)) {
          scanDirectory(filePath)
        }
      } else if (stat.size > maxSize) {
        largeFiles.push({
          path: filePath,
          size: stat.size
        })
      }
    }
  }

  scanDirectory(dir)
  return largeFiles
}

if (require.main === module) {
  checkCodeQuality()
}

module.exports = { checkCodeQuality, findLargeFiles }
```

### 7. åˆ›å»ºå¼€å‘ç¯å¢ƒé…ç½®

åˆ›å»º`.vscode/settings.json`:

```json
{
  "typescript.preferences.importModuleSpecifier": "relative",
  "editor.codeActionsOnSave": {
    "source.fixAll.eslint": true,
    "source.fixAll.format": true
  },
  "editor.formatOnSave": true,
  "editor.defaultFormatter": "esbenp.prettier-vscode",
  "editor.tabSize": 2,
  "editor.insertSpaces": true,
  "files.trimTrailingWhitespace": true,
  "files.insertFinalNewline": true,
  "search.exclude": {
    "**/node_modules": true,
    "**/.next": true,
    "**/dist": true,
    "**/build": true,
    "**/.git": true
  },
  "files.watcherExclude": {
    "**/node_modules/**": true,
    "**/.next/**": true,
    "**/dist/**": true,
    "**/build/**": true
  },
  "typescript.tsdk": "node_modules/typescript/lib",
  "typescript.enablePromptUseWorkspaceTsdk": true,
  "eslint.validate": [
    "javascript",
    "javascriptreact",
    "typescript",
    "typescriptreact"
  ],
  "[typescript]": {
    "editor.defaultFormatter": "esbenp.prettier-vscode"
  },
  "[typescriptreact]": {
    "editor.defaultFormatter": "esbenp.prettier-vscode"
  },
  "[javascript]": {
    "editor.defaultFormatter": "esbenp.prettier-vscode"
  },
  "[javascriptreact]": {
    "editor.defaultFormatter": "esbenp.prettier-vscode"
  },
  "[json]": {
    "editor.defaultFormatter": "esbenp.prettier-vscode"
  },
  "[markdown]": {
    "editor.defaultFormatter": "esbenp.prettier-vscode"
  }
}
```

åˆ›å»º`.vscode/extensions.json`:

```json
{
  "recommendations": [
    "dbaeumer.vscode-eslint",
    "esbenp.prettier-vscode",
    "bradlc.vscode-tailwindcss",
    "ms-vscode.vscode-typescript-next",
    "prisma.prisma",
    "ms-vscode.vscode-json",
    "streetsidesoftware.code-spell-checker",
    "eamodio.gitlens",
    "ms-vscode.vscode-eslint"
  ]
}
```

### 8. åˆ›å»ºå¼€å‘å·¥å…·è„šæœ¬

åˆ›å»º`scripts/dev-tools.js`:

```javascript
const { execSync } = require('child_process')

function setupDevEnvironment() {
  console.log('ğŸš€ è®¾ç½®å¼€å‘ç¯å¢ƒ...')

  try {
    // 1. å®‰è£…ä¾èµ–
    console.log('ğŸ“¦ å®‰è£…ä¾èµ–åŒ…...')
    execSync('npm install', { stdio: 'inherit' })

    // 2. ç”ŸæˆPrismaå®¢æˆ·ç«¯
    console.log('ğŸ—„ï¸  ç”ŸæˆPrismaå®¢æˆ·ç«¯...')
    execSync('npm run db:generate', { stdio: 'inherit' })

    // 3. åˆå§‹åŒ–Git hooks
    console.log('ğŸª åˆå§‹åŒ–Git hooks...')
    execSync('npm run prepare', { stdio: 'inherit' })

    // 4. è¿è¡Œä»£ç è´¨é‡æ£€æŸ¥
    console.log('ğŸ” è¿è¡Œä»£ç è´¨é‡æ£€æŸ¥...')
    execSync('node scripts/code-quality.js', { stdio: 'inherit' })

    console.log('âœ… å¼€å‘ç¯å¢ƒè®¾ç½®å®Œæˆ!')

  } catch (error) {
    console.error('âŒ å¼€å‘ç¯å¢ƒè®¾ç½®å¤±è´¥:', error.message)
    process.exit(1)
  }
}

function runDevServer() {
  console.log('ğŸš€ å¯åŠ¨å¼€å‘æœåŠ¡å™¨...')
  execSync('npm run dev', { stdio: 'inherit' })
}

if (require.main === module) {
  const command = process.argv[2]

  switch (command) {
    case 'setup':
      setupDevEnvironment()
      break
    case 'start':
      runDevServer()
      break
    default:
      console.log('å¯ç”¨å‘½ä»¤:')
      console.log('  setup  - è®¾ç½®å¼€å‘ç¯å¢ƒ')
      console.log('  start  - å¯åŠ¨å¼€å‘æœåŠ¡å™¨')
      process.exit(1)
  }
}

module.exports = { setupDevEnvironment, runDevServer }
```

### 9. æ›´æ–°package.jsonè„šæœ¬

åœ¨`package.json`ä¸­æ·»åŠ æ–°çš„è„šæœ¬:

```json
{
  "scripts": {
    "setup": "node scripts/dev-tools.js setup",
    "quality": "node scripts/code-quality.js",
    "prepare": "husky install",
    "commit": "git-cz"
  }
}
```

## éªŒè¯æ¸…å•

- [ ] ESLinté…ç½®æ­£ç¡®å·¥ä½œ
- [ ] Prettieræ ¼å¼åŒ–è§„åˆ™ç”Ÿæ•ˆ
- [ ] Git hooksè‡ªåŠ¨è¿è¡Œ
- [ ] ä»£ç æäº¤è§„èŒƒéªŒè¯
- [ ] å¼€å‘å·¥å…·é›†æˆå®Œæˆ
- [ ] ä»£ç è´¨é‡æ£€æŸ¥è„šæœ¬å¯ç”¨
- [ ] VSCodeé…ç½®æ­£ç¡®

## æµ‹è¯•å‘½ä»¤

```bash
# è®¾ç½®å¼€å‘ç¯å¢ƒ
npm run setup

# æµ‹è¯•ESLint
npm run lint

# æµ‹è¯•Prettieræ ¼å¼
npm run format:check

# æµ‹è¯•ä»£ç è´¨é‡
npm run quality

# æµ‹è¯•Git hooks
git add .
git commit -m "test: éªŒè¯git hooks"

# æµ‹è¯•è§„èŒƒåŒ–æäº¤
npm run commit
```

## æ³¨æ„äº‹é¡¹

- ç¡®ä¿æ‰€æœ‰å¼€å‘äººå‘˜ä½¿ç”¨ç›¸åŒçš„å·¥å…·é…ç½®
- å®šæœŸæ›´æ–°ä¾èµ–åŒ…ç‰ˆæœ¬
- ç›‘æ§ä»£ç è´¨é‡æŒ‡æ ‡
- åŸ¹è®­å›¢é˜Ÿæˆå‘˜ä½¿ç”¨å¼€å‘å·¥å…·
- è€ƒè™‘é›†æˆCI/CDæµç¨‹
- å¤‡ä»½é‡è¦é…ç½®æ–‡ä»¶</think>