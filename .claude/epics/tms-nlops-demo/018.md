---
title: "TMS NL-Opsæ¼”ç¤ºç³»ç»Ÿä»»åŠ¡018: åœ¨é€”è·Ÿè¸ªç•Œé¢å®ç°"
epic: "tms-nlops-demo"
task: "018"
phase: "3"
status: "pending"
priority: "high"
estimated_hours: 16
parallel: false
depends_on: ["008", "009", "010", "011", "013"]
tags: ["ui", "tracking", "real-time", "maps"]
created: "2025-09-20T04:20:45Z"
updated: "2025-09-20T04:20:45Z"
---

## æ¦‚è¿°

å®ç°TMS NL-Opsæ¼”ç¤ºç³»ç»Ÿçš„åœ¨é€”è·Ÿè¸ªç•Œé¢ï¼ŒåŒ…æ‹¬å®æ—¶åœ°å›¾è§†å›¾ã€è½¦è¾†ä½ç½®è¿½è¸ªã€çŠ¶æ€æ—¶é—´çº¿ç­‰åŠŸèƒ½ã€‚ä¸ºç”¨æˆ·æä¾›ç›´è§‚çš„è´§ç‰©è¿è¾“å®æ—¶ç›‘æ§ä½“éªŒã€‚

## ç›®æ ‡

- åˆ›å»ºå®æ—¶åœ°å›¾è§†å›¾æ˜¾ç¤ºè½¦è¾†ä½ç½®å’Œè·¯çº¿
- å®ç°è½¦è¾†ä½ç½®å®æ—¶æ›´æ–°å’Œè½¨è¿¹å›æ”¾
- å¼€å‘çŠ¶æ€æ—¶é—´çº¿æ˜¾ç¤ºè¿è¾“è¿›åº¦
- æä¾›è½¦è¾†è¯¦ç»†ä¿¡æ¯ç›‘æ§
- å®ç°å¼‚å¸¸æƒ…å†µçš„å‘Šè­¦å’Œæé†’
- æ”¯æŒå¤šè½¦è¾†åŒæ—¶è·Ÿè¸ªå’Œç®¡ç†

## æŠ€æœ¯æ ˆ

- **æ¡†æ¶**: Next.js 15+ App Router
- **è¯­è¨€**: TypeScript
- **æ ·å¼**: Tailwind CSS + shadcn/ui v2
- **åœ°å›¾**: Leaflet + React-Leaflet
- **å®æ—¶é€šä¿¡**: WebSocket / Server-Sent Events
- **å›¾è¡¨**: Recharts
- **çŠ¶æ€ç®¡ç†**: Zustand

## å®æ–½æ­¥éª¤

### 1. åˆ›å»ºè·Ÿè¸ªä¸»ç•Œé¢ç»„ä»¶

åˆ›å»º`src/components/tracking/tracking-dashboard.tsx`:

```typescript
'use client'

import { useState, useEffect, useMemo } from 'react'
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'
import { Button } from '@/components/ui/button'
import { Badge } from '@/components/ui/badge'
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs'
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select'
import { VehicleTrackingMap } from './vehicle-tracking-map'
import { VehicleStatusList } from './vehicle-status-list'
import { TrackingTimeline } from './tracking-timeline'
import { AlertPanel } from './alert-panel'
import { VehicleTracking, TrackingAlert } from '@/types/tracking'

interface TrackingDashboardProps {
  vehicles: VehicleTracking[]
  alerts: TrackingAlert[]
  onVehicleSelect: (vehicleId: string) => void
  onAlertAcknowledge: (alertId: string) => Promise<void>
}

export function TrackingDashboard({
  vehicles,
  alerts,
  onVehicleSelect,
  onAlertAcknowledge,
}: TrackingDashboardProps) {
  const [selectedVehicleId, setSelectedVehicleId] = useState<string | null>(null)
  const [viewMode, setViewMode] = useState<'realtime' | 'replay'>('realtime')
  const [filterStatus, setFilterStatus] = useState<string>('all')
  const [showPaths, setShowPaths] = useState(true)

  // ç­›é€‰è½¦è¾†
  const filteredVehicles = useMemo(() => {
    return vehicles.filter(vehicle => {
      if (filterStatus === 'all') return true
      return vehicle.status === filterStatus
    })
  }, [vehicles, filterStatus])

  // é€‰ä¸­çš„è½¦è¾†
  const selectedVehicle = useMemo(() => {
    return vehicles.find(v => v.id === selectedVehicleId)
  }, [vehicles, selectedVehicleId])

  // ç»Ÿè®¡æ•°æ®
  const stats = useMemo(() => {
    const total = vehicles.length
    const inTransit = vehicles.filter(v => v.status === 'IN_TRANSIT').length
    const stopped = vehicles.filter(v => v.status === 'STOPPED').length
    const offline = vehicles.filter(v => v.status === 'OFFLINE').length
    const alertsCount = alerts.filter(a => !a.acknowledged).length

    return {
      total,
      inTransit,
      stopped,
      offline,
      alertsCount,
    }
  }, [vehicles, alerts])

  // å¤„ç†è½¦è¾†é€‰æ‹©
  const handleVehicleSelect = (vehicleId: string) => {
    setSelectedVehicleId(vehicleId)
    onVehicleSelect(vehicleId)
  }

  return (
    <div className="space-y-6">
      {/* é¡µé¢æ ‡é¢˜å’Œæ§åˆ¶æ  */}
      <div className="flex justify-between items-center">
        <div>
          <h1 className="text-3xl font-bold tracking-tight">åœ¨é€”è·Ÿè¸ª</h1>
          <p className="text-muted-foreground">å®æ—¶ç›‘æ§è´§ç‰©è¿è¾“çŠ¶æ€</p>
        </div>

        <div className="flex space-x-4">
          <Select value={viewMode} onValueChange={(value: any) => setViewMode(value)}>
            <SelectTrigger className="w-[120px]">
              <SelectValue />
            </SelectTrigger>
            <SelectContent>
              <SelectItem value="realtime">å®æ—¶è·Ÿè¸ª</SelectItem>
              <SelectItem value="replay">è½¨è¿¹å›æ”¾</SelectItem>
            </SelectContent>
          </Select>

          <Select value={filterStatus} onValueChange={setFilterStatus}>
            <SelectTrigger className="w-[120px]">
              <SelectValue />
            </SelectTrigger>
            <SelectContent>
              <SelectItem value="all">æ‰€æœ‰çŠ¶æ€</SelectItem>
              <SelectItem value="IN_TRANSIT">è¿è¾“ä¸­</SelectItem>
              <SelectItem value="STOPPED">åœè½¦ä¸­</SelectItem>
              <SelectItem value="OFFLINE">ç¦»çº¿</SelectItem>
            </SelectContent>
          </Select>

          <Button
            variant="outline"
            onClick={() => setShowPaths(!showPaths)}
          >
            {showPaths ? 'éšè—è·¯çº¿' : 'æ˜¾ç¤ºè·¯çº¿'}
          </Button>
        </div>
      </div>

      {/* ç»Ÿè®¡å¡ç‰‡ */}
      <div className="grid grid-cols-1 md:grid-cols-5 gap-4">
        <Card>
          <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
            <CardTitle className="text-sm font-medium">æ€»è½¦è¾†æ•°</CardTitle>
          </CardHeader>
          <CardContent>
            <div className="text-2xl font-bold">{stats.total}</div>
          </CardContent>
        </Card>

        <Card>
          <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
            <CardTitle className="text-sm font-medium">è¿è¾“ä¸­</CardTitle>
          </CardHeader>
          <CardContent>
            <div className="text-2xl font-bold text-green-600">{stats.inTransit}</div>
          </CardContent>
        </Card>

        <Card>
          <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
            <CardTitle className="text-sm font-medium">åœè½¦ä¸­</CardTitle>
          </CardHeader>
          <CardContent>
            <div className="text-2xl font-bold text-orange-600">{stats.stopped}</div>
          </CardContent>
        </Card>

        <Card>
          <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
            <CardTitle className="text-sm font-medium">ç¦»çº¿</CardTitle>
          </CardHeader>
          <CardContent>
            <div className="text-2xl font-bold text-red-600">{stats.offline}</div>
          </CardContent>
        </Card>

        <Card>
          <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
            <CardTitle className="text-sm font-medium">å¾…å¤„ç†å‘Šè­¦</CardTitle>
          </CardHeader>
          <CardContent>
            <div className="text-2xl font-bold text-red-600">{stats.alertsCount}</div>
          </CardContent>
        </Card>
      </div>

      {/* ä¸»è¦å†…å®¹åŒºåŸŸ */}
      <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
        {/* å·¦ä¾§ï¼šåœ°å›¾ */}
        <div className="lg:col-span-2">
          <Card className="h-[600px]">
            <CardHeader>
              <CardTitle className="flex items-center justify-between">
                å®æ—¶åœ°å›¾
                <Badge variant={viewMode === 'realtime' ? 'default' : 'secondary'}>
                  {viewMode === 'realtime' ? 'å®æ—¶' : 'å›æ”¾'}
                </Badge>
              </CardTitle>
            </CardHeader>
            <CardContent className="h-[520px] p-0">
              <VehicleTrackingMap
                vehicles={filteredVehicles}
                selectedVehicleId={selectedVehicleId}
                showPaths={showPaths}
                onVehicleSelect={handleVehicleSelect}
                viewMode={viewMode}
              />
            </CardContent>
          </Card>
        </div>

        {/* å³ä¾§ï¼šè½¦è¾†åˆ—è¡¨å’Œå‘Šè­¦ */}
        <div className="space-y-6">
          <Tabs defaultValue="vehicles" className="w-full">
            <TabsList className="grid w-full grid-cols-2">
              <TabsTrigger value="vehicles">è½¦è¾†åˆ—è¡¨</TabsTrigger>
              <TabsTrigger value="alerts">å‘Šè­¦é¢æ¿</TabsTrigger>
            </TabsList>

            <TabsContent value="vehicles">
              <VehicleStatusList
                vehicles={filteredVehicles}
                selectedVehicleId={selectedVehicleId}
                onVehicleSelect={handleVehicleSelect}
              />
            </TabsContent>

            <TabsContent value="alerts">
              <AlertPanel
                alerts={alerts}
                onAlertAcknowledge={onAlertAcknowledge}
              />
            </TabsContent>
          </Tabs>
        </div>
      </div>

      {/* åº•éƒ¨ï¼šé€‰ä¸­è½¦è¾†çš„è¯¦ç»†ä¿¡æ¯ */}
      {selectedVehicle && (
        <Card>
          <CardHeader>
            <CardTitle className="flex items-center justify-between">
              è½¦è¾†è¯¦æƒ… - {selectedVehicle.licensePlate}
              <Button variant="ghost" size="sm" onClick={() => setSelectedVehicleId(null)}>
                å…³é—­
              </Button>
            </CardTitle>
          </CardHeader>
          <CardContent>
            <TrackingTimeline
              vehicle={selectedVehicle}
              viewMode={viewMode}
            />
          </CardContent>
        </Card>
      )}
    </div>
  )
}
```

### 2. åˆ›å»ºè½¦è¾†è·Ÿè¸ªåœ°å›¾ç»„ä»¶

åˆ›å»º`src/components/tracking/vehicle-tracking-map.tsx`:

```typescript
'use client'

import { useState, useEffect, useRef } from 'react'
import { Card, CardContent } from '@/components/ui/card'
import { Badge } from '@/components/ui/badge'
import { Button } from '@/components/ui/button'
import { VehicleTracking } from '@/types/tracking'

interface VehicleTrackingMapProps {
  vehicles: VehicleTracking[]
  selectedVehicleId: string | null
  showPaths: boolean
  onVehicleSelect: (vehicleId: string) => void
  viewMode: 'realtime' | 'replay'
}

export function VehicleTrackingMap({
  vehicles,
  selectedVehicleId,
  showPaths,
  onVehicleSelect,
  viewMode,
}: VehicleTrackingMapProps) {
  const mapRef = useRef<HTMLDivElement>(null)
  const [map, setMap] = useState<any>(null)
  const [markers, setMarkers] = useState<any[]>([])
  const [replayTime, setReplayTime] = useState<number>(Date.now())

  // åˆå§‹åŒ–åœ°å›¾
  useEffect(() => {
    if (!mapRef.current) return

    // æ¨¡æ‹Ÿåœ°å›¾åˆå§‹åŒ–
    const initMap = async () => {
      // è¿™é‡Œåº”è¯¥é›†æˆ Leaflet æˆ–å…¶ä»–åœ°å›¾åº“
      // ä¸ºæ¼”ç¤ºç›®çš„ï¼Œæˆ‘ä»¬æ˜¾ç¤ºä¸€ä¸ªå ä½ç¬¦
    }

    initMap()
  }, [])

  // æ›´æ–°è½¦è¾†ä½ç½®
  useEffect(() => {
    if (!map) return

    // æ¸…é™¤ç°æœ‰æ ‡è®°
    markers.forEach(marker => map.removeLayer(marker))
    setMarkers([])

    // æ·»åŠ è½¦è¾†æ ‡è®°
    vehicles.forEach(vehicle => {
      if (vehicle.location) {
        const marker = createVehicleMarker(vehicle)
        markers.push(marker)
        map.addLayer(marker)
      }
    })

    // å¦‚æœå¯ç”¨äº†è·¯å¾„æ˜¾ç¤ºï¼Œç»˜åˆ¶è·¯çº¿
    if (showPaths) {
      vehicles.forEach(vehicle => {
        if (vehicle.path && vehicle.path.length > 1) {
          drawVehiclePath(vehicle)
        }
      })
    }
  }, [vehicles, map, showPaths, selectedVehicleId])

  // å®æ—¶æ›´æ–°ï¼ˆæ¨¡æ‹Ÿï¼‰
  useEffect(() => {
    if (viewMode !== 'realtime') return

    const interval = setInterval(() => {
      // æ¨¡æ‹Ÿä½ç½®æ›´æ–°
      updateVehiclePositions()
    }, 5000)

    return () => clearInterval(interval)
  }, [viewMode])

  // åˆ›å»ºè½¦è¾†æ ‡è®°
  const createVehicleMarker = (vehicle: VehicleTracking) => {
    // è¿™é‡Œåº”è¯¥åˆ›å»ºå®é™…çš„åœ°å›¾æ ‡è®°
    return {
      vehicle,
      remove: () => {},
      // å…¶ä»–æ ‡è®°æ–¹æ³•
    }
  }

  // ç»˜åˆ¶è½¦è¾†è·¯å¾„
  const drawVehiclePath = (vehicle: VehicleTracking) => {
    // è¿™é‡Œåº”è¯¥ç»˜åˆ¶å®é™…çš„è·¯å¾„
  }

  // æ›´æ–°è½¦è¾†ä½ç½®ï¼ˆæ¨¡æ‹Ÿï¼‰
  const updateVehiclePositions = () => {
    // æ¨¡æ‹Ÿä½ç½®æ›´æ–°é€»è¾‘
  }

  // å¤„ç†åœ°å›¾ç‚¹å‡»
  const handleMapClick = (e: any) => {
    // å¤„ç†åœ°å›¾ç‚¹å‡»äº‹ä»¶
  }

  // è·å–è½¦è¾†çŠ¶æ€é¢œè‰²
  const getVehicleColor = (status: string) => {
    switch (status) {
      case 'IN_TRANSIT': return '#10b981' // green
      case 'STOPPED': return '#f59e0b' // amber
      case 'OFFLINE': return '#6b7280' // gray
      default: return '#3b82f6' // blue
    }
  }

  return (
    <div className="relative h-full w-full bg-muted rounded-lg overflow-hidden">
      {/* åœ°å›¾å ä½ç¬¦ */}
      <div
        ref={mapRef}
        className="h-full w-full flex items-center justify-center"
        onClick={handleMapClick}
      >
        <div className="text-center">
          <div className="text-lg font-medium mb-2">å®æ—¶åœ°å›¾è§†å›¾</div>
          <div className="text-sm text-muted-foreground mb-4">
            æ˜¾ç¤º {vehicles.length} è¾†è½¦çš„å®æ—¶ä½ç½®
          </div>
          <div className="grid grid-cols-2 md:grid-cols-4 gap-4 max-w-md mx-auto">
            {vehicles.slice(0, 8).map((vehicle) => (
              <VehicleMapCard
                key={vehicle.id}
                vehicle={vehicle}
                isSelected={vehicle.id === selectedVehicleId}
                onClick={() => onVehicleSelect(vehicle.id)}
              />
            ))}
          </div>
        </div>
      </div>

      {/* åœ°å›¾æ§åˆ¶æŒ‰é’® */}
      <div className="absolute top-4 right-4 flex flex-col space-y-2">
        <Button variant="outline" size="sm">
          +
        </Button>
        <Button variant="outline" size="sm">
          -
        </Button>
        <Button variant="outline" size="sm">
          âŸ²
        </Button>
      </div>

      {/* å›¾ä¾‹ */}
      <div className="absolute bottom-4 left-4 bg-white p-3 rounded-lg shadow-md">
        <div className="text-sm font-medium mb-2">å›¾ä¾‹</div>
        <div className="space-y-1">
          <div className="flex items-center space-x-2">
            <div className="w-3 h-3 bg-green-500 rounded-full"></div>
            <span className="text-xs">è¿è¾“ä¸­</span>
          </div>
          <div className="flex items-center space-x-2">
            <div className="w-3 h-3 bg-orange-500 rounded-full"></div>
            <span className="text-xs">åœè½¦ä¸­</span>
          </div>
          <div className="flex items-center space-x-2">
            <div className="w-3 h-3 bg-gray-500 rounded-full"></div>
            <span className="text-xs">ç¦»çº¿</span>
          </div>
        </div>
      </div>
    </div>
  )
}

// è½¦è¾†åœ°å›¾å¡ç‰‡ç»„ä»¶
function VehicleMapCard({ vehicle, isSelected, onClick }: {
  vehicle: VehicleTracking
  isSelected: boolean
  onClick: () => void
}) {
  const getVehicleColor = (status: string) => {
    switch (status) {
      case 'IN_TRANSIT': return 'bg-green-500'
      case 'STOPPED': return 'bg-orange-500'
      case 'OFFLINE': return 'bg-gray-500'
      default: return 'bg-blue-500'
    }
  }

  return (
    <div
      className={`p-2 rounded border cursor-pointer transition-colors ${
        isSelected ? 'border-primary bg-primary/10' : 'border-border hover:border-primary/50'
      }`}
      onClick={onClick}
    >
      <div className="text-xs font-medium truncate">{vehicle.licensePlate}</div>
      <div className="flex items-center space-x-1 mt-1">
        <div className={`w-2 h-2 rounded-full ${getVehicleColor(vehicle.status)}`}></div>
        <div className="text-xs text-muted-foreground truncate">
          {vehicle.currentLocation?.address || 'æœªçŸ¥ä½ç½®'}
        </div>
      </div>
      <div className="text-xs text-muted-foreground mt-1">
        {vehicle.speed ? `${vehicle.speed} km/h` : 'é™æ­¢'}
      </div>
    </div>
  )
}
```

### 3. åˆ›å»ºè½¦è¾†çŠ¶æ€åˆ—è¡¨ç»„ä»¶

åˆ›å»º`src/components/tracking/vehicle-status-list.tsx`:

```typescript
'use client'

import { useMemo } from 'react'
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'
import { Badge } from '@/components/ui/badge'
import { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar'
import { Button } from '@/components/ui/button'
import { VehicleTracking } from '@/types/tracking'
import { format } from 'date-fns'
import { zhCN } from 'date-fns/locale'

interface VehicleStatusListProps {
  vehicles: VehicleTracking[]
  selectedVehicleId: string | null
  onVehicleSelect: (vehicleId: string) => void
}

export function VehicleStatusList({
  vehicles,
  selectedVehicleId,
  onVehicleSelect,
}: VehicleStatusListProps) {
  // æŒ‰çŠ¶æ€åˆ†ç»„è½¦è¾†
  const groupedVehicles = useMemo(() => {
    return vehicles.reduce((acc, vehicle) => {
      if (!acc[vehicle.status]) {
        acc[vehicle.status] = []
      }
      acc[vehicle.status].push(vehicle)
      return acc
    }, {} as Record<string, VehicleTracking[]>)
  }, [vehicles])

  // è·å–çŠ¶æ€ä¿¡æ¯
  const getStatusInfo = (status: string) => {
    switch (status) {
      case 'IN_TRANSIT':
        return {
          label: 'è¿è¾“ä¸­',
          color: 'default',
          icon: 'ğŸšš',
        }
      case 'STOPPED':
        return {
          label: 'åœè½¦ä¸­',
          color: 'secondary',
          icon: 'ğŸ…¿ï¸',
        }
      case 'OFFLINE':
        return {
          label: 'ç¦»çº¿',
          color: 'outline',
          icon: 'ğŸ“´',
        }
      default:
        return {
          label: status,
          color: 'outline',
          icon: 'â“',
        }
    }
  }

  return (
    <Card className="h-[500px]">
      <CardHeader>
        <CardTitle>è½¦è¾†çŠ¶æ€</CardTitle>
        <CardDescription>
          å½“å‰æ‰€æœ‰è½¦è¾†çš„å®æ—¶çŠ¶æ€
        </CardDescription>
      </CardHeader>
      <CardContent className="p-0">
        <div className="h-[420px] overflow-y-auto">
          {Object.entries(groupedVehicles).map(([status, vehicleList]) => {
            const statusInfo = getStatusInfo(status)

            return (
              <div key={status} className="border-b last:border-b-0">
                <div className="sticky top-0 bg-background border-b px-4 py-2">
                  <div className="flex items-center space-x-2">
                    <span>{statusInfo.icon}</span>
                    <Badge variant={statusInfo.color as any}>
                      {statusInfo.label} ({vehicleList.length})
                    </Badge>
                  </div>
                </div>

                <div className="p-2 space-y-2">
                  {vehicleList.map((vehicle) => (
                    <VehicleStatusCard
                      key={vehicle.id}
                      vehicle={vehicle}
                      isSelected={vehicle.id === selectedVehicleId}
                      onClick={() => onVehicleSelect(vehicle.id)}
                    />
                  ))}
                </div>
              </div>
            )
          })}
        </div>
      </CardContent>
    </Card>
  )
}

// å•ä¸ªè½¦è¾†çŠ¶æ€å¡ç‰‡
function VehicleStatusCard({ vehicle, isSelected, onClick }: {
  vehicle: VehicleTracking
  isSelected: boolean
  onClick: () => void
}) {
  const getSpeedColor = (speed: number) => {
    if (speed === 0) return 'text-gray-500'
    if (speed < 30) return 'text-green-600'
    if (speed < 60) return 'text-orange-600'
    return 'text-red-600'
  }

  const getFuelColor = (fuelLevel: number) => {
    if (fuelLevel < 20) return 'text-red-600'
    if (fuelLevel < 50) return 'text-orange-600'
    return 'text-green-600'
  }

  return (
    <div
      className={`p-3 rounded-lg border cursor-pointer transition-colors ${
        isSelected ? 'border-primary bg-primary/5' : 'border-border hover:border-primary/50 hover:bg-muted/50'
      }`}
      onClick={onClick}
    >
      <div className="flex items-center justify-between mb-2">
        <div className="flex items-center space-x-2">
          <Avatar className="w-8 h-8">
            <AvatarFallback>{vehicle.licensePlate.slice(-2)}</AvatarFallback>
          </Avatar>
          <div>
            <div className="font-medium text-sm">{vehicle.licensePlate}</div>
            <div className="text-xs text-muted-foreground">{vehicle.driverName}</div>
          </div>
        </div>

        <div className="text-right">
          <div className={`text-sm font-medium ${getSpeedColor(vehicle.speed || 0)}`}>
            {vehicle.speed || 0} km/h
          </div>
          <div className="text-xs text-muted-foreground">
            {vehicle.fuelLevel !== undefined && (
              <span className={getFuelColor(vehicle.fuelLevel)}>
                æ²¹é‡: {vehicle.fuelLevel}%
              </span>
            )}
          </div>
        </div>
      </div>

      <div className="space-y-1 text-xs">
        <div className="flex items-center space-x-2">
          <span className="text-muted-foreground">ä½ç½®:</span>
          <span className="truncate">{vehicle.currentLocation?.address || 'ä½ç½®æœªçŸ¥'}</span>
        </div>

        {vehicle.destination && (
          <div className="flex items-center space-x-2">
            <span className="text-muted-foreground">ç›®çš„åœ°:</span>
            <span className="truncate">{vehicle.destination.address}</span>
          </div>
        )}

        {vehicle.eta && (
          <div className="flex items-center space-x-2">
            <span className="text-muted-foreground">é¢„è®¡åˆ°è¾¾:</span>
            <span>
              {format(new Date(vehicle.eta), 'MM-dd HH:mm', { locale: zhCN })}
            </span>
          </div>
        )}

        {vehicle.lastUpdate && (
          <div className="flex items-center space-x-2">
            <span className="text-muted-foreground">æ›´æ–°æ—¶é—´:</span>
            <span>
              {format(new Date(vehicle.lastUpdate), 'HH:mm:ss', { locale: zhCN })}
            </span>
          </div>
        )}
      </div>

      {/* è½¦è¾†çŠ¶æ€æŒ‡ç¤ºå™¨ */}
      <div className="flex items-center space-x-2 mt-2">
        <div className="flex items-center space-x-1">
          <div className={`w-2 h-2 rounded-full ${
            vehicle.status === 'IN_TRANSIT' ? 'bg-green-500' :
            vehicle.status === 'STOPPED' ? 'bg-orange-500' :
            vehicle.status === 'OFFLINE' ? 'bg-gray-500' : 'bg-blue-500'
          }`}></div>
          <span className="text-xs text-muted-foreground">
            {vehicle.status === 'IN_TRANSIT' ? 'è¡Œé©¶ä¸­' :
             vehicle.status === 'STOPPED' ? 'å·²åœè½¦' :
             vehicle.status === 'OFFLINE' ? 'ç¦»çº¿' : vehicle.status}
          </span>
        </div>

        {vehicle.alerts && vehicle.alerts.length > 0 && (
          <Badge variant="destructive" className="text-xs">
            {vehicle.alerts.length} å‘Šè­¦
          </Badge>
        )}
      </div>
    </div>
  )
}
```

### 4. åˆ›å»ºè·Ÿè¸ªæ—¶é—´çº¿ç»„ä»¶

åˆ›å»º`src/components/tracking/tracking-timeline.tsx`:

```typescript
'use client'

import { useMemo } from 'react'
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'
import { Badge } from '@/components/ui/badge'
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs'
import { VehicleTracking } from '@/types/tracking'
import { format } from 'date-fns'
import { zhCN } from 'date-fns/locale'

interface TrackingTimelineProps {
  vehicle: VehicleTracking
  viewMode: 'realtime' | 'replay'
}

export function TrackingTimeline({ vehicle, viewMode }: TrackingTimelineProps) {
  // ç”Ÿæˆæ—¶é—´çº¿äº‹ä»¶
  const timelineEvents = useMemo(() => {
    const events = []

    // æ·»åŠ åŸºæœ¬äº‹ä»¶
    if (vehicle.assignmentTime) {
      events.push({
        id: 'assignment',
        type: 'assignment',
        time: vehicle.assignmentTime,
        title: 'åˆ†é…ä»»åŠ¡',
        description: `åˆ†é…è®¢å• ${vehicle.orderNumber}`,
        status: 'completed',
      })
    }

    if (vehicle.departureTime) {
      events.push({
        id: 'departure',
        type: 'departure',
        time: vehicle.departureTime,
        title: 'å‡ºå‘',
        description: `ä» ${vehicle.startLocation?.address || 'ä»“åº“'} å‡ºå‘`,
        status: 'completed',
      })
    }

    // æ·»åŠ è·¯å¾„ç‚¹äº‹ä»¶
    if (vehicle.path && vehicle.path.length > 0) {
      vehicle.path.forEach((point, index) => {
        if (point.timestamp && index > 0 && index < vehicle.path!.length - 1) {
          events.push({
            id: `waypoint-${index}`,
            type: 'waypoint',
            time: point.timestamp,
            title: 'é€”å¾„ç‚¹',
            description: `é€”å¾„ ${point.address || 'æœªçŸ¥ä½ç½®'}`,
            status: 'completed',
          })
        }
      })
    }

    // æ·»åŠ é¢„è®¡åˆ°è¾¾äº‹ä»¶
    if (vehicle.eta) {
      events.push({
        id: 'eta',
        type: 'eta',
        time: vehicle.eta,
        title: 'é¢„è®¡åˆ°è¾¾',
        description: `é¢„è®¡åˆ°è¾¾ ${vehicle.destination?.address}`,
        status: 'pending',
      })
    }

    // æ·»åŠ å‘Šè­¦äº‹ä»¶
    if (vehicle.alerts) {
      vehicle.alerts.forEach((alert, index) => {
        events.push({
          id: `alert-${index}`,
          type: 'alert',
          time: alert.timestamp,
          title: 'å‘Šè­¦',
          description: alert.message,
          status: alert.acknowledged ? 'resolved' : 'active',
        })
      })
    }

    // æŒ‰æ—¶é—´æ’åº
    return events.sort((a, b) => new Date(a.time).getTime() - new Date(b.time).getTime())
  }, [vehicle])

  // è·å–äº‹ä»¶ç±»å‹å›¾æ ‡
  const getEventIcon = (type: string) => {
    switch (type) {
      case 'assignment': return 'ğŸ“‹'
      case 'departure': return 'ğŸšš'
      case 'waypoint': return 'ğŸ“'
      case 'eta': return 'â°'
      case 'alert': return 'âš ï¸'
      default: return 'ğŸ“Œ'
    }
  }

  // è·å–äº‹ä»¶çŠ¶æ€æ ·å¼
  const getEventStatusStyle = (status: string) => {
    switch (status) {
      case 'completed': return 'bg-green-100 text-green-800 border-green-200'
      case 'pending': return 'bg-blue-100 text-blue-800 border-blue-200'
      case 'active': return 'bg-red-100 text-red-800 border-red-200'
      case 'resolved': return 'bg-gray-100 text-gray-800 border-gray-200'
      default: return 'bg-gray-100 text-gray-800 border-gray-200'
    }
  }

  // è·å–äº‹ä»¶çŠ¶æ€æ–‡æœ¬
  const getEventStatusText = (status: string) => {
    switch (status) {
      case 'completed': return 'å·²å®Œæˆ'
      case 'pending': return 'å¾…å¤„ç†'
      case 'active': return 'è¿›è¡Œä¸­'
      case 'resolved': return 'å·²è§£å†³'
      default: return status
    }
  }

  return (
    <Tabs defaultValue="timeline" className="w-full">
      <TabsList className="grid w-full grid-cols-3">
        <TabsTrigger value="timeline">æ—¶é—´çº¿</TabsTrigger>
        <TabsTrigger value="details">è¯¦ç»†ä¿¡æ¯</TabsTrigger>
        <TabsTrigger value="analytics">æ•°æ®åˆ†æ</TabsTrigger>
      </TabsList>

      <TabsContent value="timeline">
        <div className="space-y-4">
          {timelineEvents.map((event, index) => (
            <TimelineEvent
              key={event.id}
              event={event}
              isLast={index === timelineEvents.length - 1}
            />
          ))}
        </div>
      </TabsContent>

      <TabsContent value="details">
        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
          <DetailSection
            title="è¡Œç¨‹ä¿¡æ¯"
            data={[
              { label: 'æ€»è·ç¦»', value: `${vehicle.totalDistance?.toFixed(1) || 0} km` },
              { label: 'å·²è¡Œé©¶è·ç¦»', value: `${vehicle.traveledDistance?.toFixed(1) || 0} km` },
              { label: 'å‰©ä½™è·ç¦»', value: `${vehicle.remainingDistance?.toFixed(1) || 0} km` },
              { label: 'é¢„è®¡æ€»æ—¶é—´', value: `${vehicle.estimatedDuration || 0} åˆ†é’Ÿ` },
              { label: 'å·²ç”¨æ—¶é—´', value: `${vehicle.elapsedTime || 0} åˆ†é’Ÿ` },
            ]}
          />

          <DetailSection
            title="è½¦è¾†çŠ¶æ€"
            data={[
              { label: 'å½“å‰é€Ÿåº¦', value: `${vehicle.speed || 0} km/h` },
              { label: 'å¹³å‡é€Ÿåº¦', value: `${vehicle.averageSpeed || 0} km/h` },
              { label: 'æœ€é«˜é€Ÿåº¦', value: `${vehicle.maxSpeed || 0} km/h` },
              { label: 'ç‡ƒæ²¹æ°´å¹³', value: `${vehicle.fuelLevel || 0}%` },
              { label: 'å‘åŠ¨æœºçŠ¶æ€', value: vehicle.engineStatus || 'æœªçŸ¥' },
            ]}
          />
        </div>
      </TabsContent>

      <TabsContent value="analytics">
        <div className="space-y-4">
          <AnalyticsCard
            title="è¡Œé©¶æ•ˆç‡"
            metrics={[
              { label: 'å¹³å‡é€Ÿåº¦', value: `${vehicle.averageSpeed || 0} km/h`, trend: 'up' },
              { label: 'ç‡ƒæ²¹æ•ˆç‡', value: `${vehicle.fuelEfficiency || 0} L/100km`, trend: 'down' },
              { label: 'å‡†æ—¶ç‡', value: `${vehicle.onTimeRate || 0}%`, trend: 'up' },
            ]}
          />

          <AnalyticsCard
            title="å®‰å…¨æŒ‡æ ‡"
            metrics={[
              { label: 'æ€¥åŠ é€Ÿæ¬¡æ•°', value: vehicle.hardAccelerations || 0, trend: 'down' },
              { label: 'æ€¥åˆ¹è½¦æ¬¡æ•°', value: vehicle.hardBrakings || 0, trend: 'down' },
              { label: 'è¶…é€Ÿæ¬¡æ•°', value: vehicle.speedingEvents || 0, trend: 'down' },
            ]}
          />
        </div>
      </TabsContent>
    </Tabs>
  )
}

// æ—¶é—´çº¿äº‹ä»¶ç»„ä»¶
function TimelineEvent({ event, isLast }: { event: any, isLast: boolean }) {
  const getEventIcon = (type: string) => {
    switch (type) {
      case 'assignment': return 'ğŸ“‹'
      case 'departure': return 'ğŸšš'
      case 'waypoint': return 'ğŸ“'
      case 'eta': return 'â°'
      case 'alert': return 'âš ï¸'
      default: return 'ğŸ“Œ'
    }
  }

  const getEventStatusStyle = (status: string) => {
    switch (status) {
      case 'completed': return 'bg-green-100 text-green-800 border-green-200'
      case 'pending': return 'bg-blue-100 text-blue-800 border-blue-200'
      case 'active': return 'bg-red-100 text-red-800 border-red-200'
      case 'resolved': return 'bg-gray-100 text-gray-800 border-gray-200'
      default: return 'bg-gray-100 text-gray-800 border-gray-200'
    }
  }

  return (
    <div className="flex space-x-4">
      <div className="flex flex-col items-center">
        <div className="w-10 h-10 bg-primary/10 rounded-full flex items-center justify-center text-lg">
          {getEventIcon(event.type)}
        </div>
        {!isLast && <div className="w-0.5 h-16 bg-border mt-2"></div>}
      </div>

      <div className="flex-1 min-w-0">
        <div className="flex items-center space-x-2 mb-1">
          <h3 className="font-medium">{event.title}</h3>
          <Badge variant="outline" className={getEventStatusStyle(event.status)}>
            {getEventStatusText(event.status)}
          </Badge>
        </div>
        <p className="text-sm text-muted-foreground mb-1">{event.description}</p>
        <p className="text-xs text-muted-foreground">
          {format(new Date(event.time), 'yyyy-MM-dd HH:mm:ss', { locale: zhCN })}
        </p>
      </div>
    </div>
  )
}

// è¯¦æƒ…æ®µè½ç»„ä»¶
function DetailSection({ title, data }: { title: string, data: Array<{ label: string, value: string }> }) {
  return (
    <Card>
      <CardHeader>
        <CardTitle className="text-lg">{title}</CardTitle>
      </CardHeader>
      <CardContent>
        <div className="space-y-3">
          {data.map((item, index) => (
            <div key={index} className="flex justify-between">
              <span className="text-sm text-muted-foreground">{item.label}</span>
              <span className="text-sm font-medium">{item.value}</span>
            </div>
          ))}
        </div>
      </CardContent>
    </Card>
  )
}

// åˆ†æå¡ç‰‡ç»„ä»¶
function AnalyticsCard({ title, metrics }: { title: string, metrics: Array<{ label: string, value: string, trend: string }> }) {
  return (
    <Card>
      <CardHeader>
        <CardTitle className="text-lg">{title}</CardTitle>
      </CardHeader>
      <CardContent>
        <div className="grid grid-cols-3 gap-4">
          {metrics.map((metric, index) => (
            <div key={index} className="text-center">
              <div className="text-2xl font-bold">{metric.value}</div>
              <div className="text-sm text-muted-foreground">{metric.label}</div>
              <div className={`text-xs ${
                metric.trend === 'up' ? 'text-green-600' : 'text-red-600'
              }`}>
                {metric.trend === 'up' ? 'â†‘' : 'â†“'}
              </div>
            </div>
          ))}
        </div>
      </CardContent>
    </Card>
  )
}
```

### 5. åˆ›å»ºå‘Šè­¦é¢æ¿ç»„ä»¶

åˆ›å»º`src/components/tracking/alert-panel.tsx`:

```typescript
'use client'

import { useMemo } from 'react'
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'
import { Button } from '@/components/ui/button'
import { Badge } from '@/components/ui/badge'
import { TrackingAlert } from '@/types/tracking'
import { format } from 'date-fns'
import { zhCN } from 'date-fns/locale'

interface AlertPanelProps {
  alerts: TrackingAlert[]
  onAlertAcknowledge: (alertId: string) => Promise<void>
}

export function AlertPanel({ alerts, onAlertAcknowledge }: AlertPanelProps) {
  // æŒ‰ä¸¥é‡ç¨‹åº¦å’ŒçŠ¶æ€æ’åºå‘Šè­¦
  const sortedAlerts = useMemo(() => {
    return [...alerts].sort((a, b) => {
      // æœªç¡®è®¤çš„å‘Šè­¦ä¼˜å…ˆ
      if (a.acknowledged !== b.acknowledged) {
        return a.acknowledged ? 1 : -1
      }
      // æŒ‰ä¸¥é‡ç¨‹åº¦æ’åº
      const severityOrder = { critical: 0, high: 1, medium: 2, low: 3 }
      return severityOrder[a.severity] - severityOrder[b.severity]
    })
  }, [alerts])

  // æŒ‰çŠ¶æ€åˆ†ç»„
  const activeAlerts = sortedAlerts.filter(alert => !alert.acknowledged)
  const acknowledgedAlerts = sortedAlerts.filter(alert => alert.acknowledged)

  // è·å–ä¸¥é‡ç¨‹åº¦æ ·å¼
  const getSeverityStyle = (severity: string) => {
    switch (severity) {
      case 'critical':
        return {
          color: 'destructive',
          text: 'ä¸¥é‡',
          bg: 'bg-red-50 border-red-200'
        }
      case 'high':
        return {
          color: 'destructive',
          text: 'é«˜',
          bg: 'bg-orange-50 border-orange-200'
        }
      case 'medium':
        return {
          color: 'secondary',
          text: 'ä¸­',
          bg: 'bg-yellow-50 border-yellow-200'
        }
      case 'low':
        return {
          color: 'outline',
          text: 'ä½',
          bg: 'bg-gray-50 border-gray-200'
        }
      default:
        return {
          color: 'outline',
          text: severity,
          bg: 'bg-gray-50 border-gray-200'
        }
    }
  }

  return (
    <Card className="h-[500px]">
      <CardHeader>
        <CardTitle className="flex items-center justify-between">
          å‘Šè­¦é¢æ¿
          <Badge variant={activeAlerts.length > 0 ? 'destructive' : 'secondary'}>
            {activeAlerts.length} ä¸ªå¾…å¤„ç†
          </Badge>
        </CardTitle>
        <CardDescription>
          ç³»ç»Ÿç›‘æ§å‘Šè­¦å’Œå¼‚å¸¸äº‹ä»¶
        </CardDescription>
      </CardHeader>
      <CardContent className="p-0">
        <div className="h-[420px] overflow-y-auto">
          {/* æœªç¡®è®¤å‘Šè­¦ */}
          {activeAlerts.length > 0 && (
            <div className="border-b last:border-b-0">
              <div className="sticky top-0 bg-background border-b px-4 py-2">
                <h3 className="font-medium text-red-600">å¾…å¤„ç†å‘Šè­¦</h3>
              </div>
              <div className="p-2 space-y-2">
                {activeAlerts.map((alert) => (
                  <AlertCard
                    key={alert.id}
                    alert={alert}
                    onAcknowledge={onAlertAcknowledge}
                  />
                ))}
              </div>
            </div>
          )}

          {/* å·²ç¡®è®¤å‘Šè­¦ */}
          {acknowledgedAlerts.length > 0 && (
            <div>
              <div className="sticky top-0 bg-background border-b px-4 py-2">
                <h3 className="font-medium text-gray-600">å·²å¤„ç†å‘Šè­¦</h3>
              </div>
              <div className="p-2 space-y-2">
                {acknowledgedAlerts.map((alert) => (
                  <AlertCard
                    key={alert.id}
                    alert={alert}
                    onAcknowledge={onAlertAcknowledge}
                  />
                ))}
              </div>
            </div>
          )}

          {/* æ— å‘Šè­¦ */}
          {sortedAlerts.length === 0 && (
            <div className="h-full flex items-center justify-center">
              <div className="text-center text-muted-foreground">
                <div className="text-lg mb-2">âœ… æš‚æ— å‘Šè­¦</div>
                <div className="text-sm">ç³»ç»Ÿè¿è¡Œæ­£å¸¸</div>
              </div>
            </div>
          )}
        </div>
      </CardContent>
    </Card>
  )
}

// å‘Šè­¦å¡ç‰‡ç»„ä»¶
function AlertCard({ alert, onAcknowledge }: {
  alert: TrackingAlert
  onAcknowledge: (alertId: string) => Promise<void>
}) {
  const [isAcknowledging, setIsAcknowledging] = useState(false)

  const getSeverityStyle = (severity: string) => {
    switch (severity) {
      case 'critical':
        return {
          color: 'destructive',
          text: 'ä¸¥é‡',
          bg: 'bg-red-50 border-red-200'
        }
      case 'high':
        return {
          color: 'destructive',
          text: 'é«˜',
          bg: 'bg-orange-50 border-orange-200'
        }
      case 'medium':
        return {
          color: 'secondary',
          text: 'ä¸­',
          bg: 'bg-yellow-50 border-yellow-200'
        }
      case 'low':
        return {
          color: 'outline',
          text: 'ä½',
          bg: 'bg-gray-50 border-gray-200'
        }
      default:
        return {
          color: 'outline',
          text: severity,
          bg: 'bg-gray-50 border-gray-200'
        }
    }
  }

  const handleAcknowledge = async () => {
    setIsAcknowledging(true)
    try {
      await onAcknowledge(alert.id)
    } catch (error) {
      console.error('ç¡®è®¤å‘Šè­¦å¤±è´¥:', error)
    } finally {
      setIsAcknowledging(false)
    }
  }

  const severityStyle = getSeverityStyle(alert.severity)

  return (
    <div className={`p-3 rounded-lg border ${severityStyle.bg} ${
      alert.acknowledged ? 'opacity-60' : ''
    }`}>
      <div className="flex items-start justify-between mb-2">
        <div className="flex items-center space-x-2">
          <Badge variant={severityStyle.color as any}>
            {severityStyle.text}
          </Badge>
          <span className="text-sm font-medium">{alert.type}</span>
        </div>

        <div className="flex items-center space-x-2">
          <span className="text-xs text-muted-foreground">
            {format(new Date(alert.timestamp), 'HH:mm', { locale: zhCN })}
          </span>
          {!alert.acknowledged && (
            <Button
              variant="outline"
              size="sm"
              onClick={handleAcknowledge}
              disabled={isAcknowledging}
            >
              {isAcknowledging ? 'å¤„ç†ä¸­...' : 'ç¡®è®¤'}
            </Button>
          )}
        </div>
      </div>

      <div className="space-y-2">
        <p className="text-sm">{alert.message}</p>

        {alert.vehicleId && (
          <div className="text-xs text-muted-foreground">
            è½¦è¾†: {alert.vehicleId}
          </div>
        )}

        {alert.location && (
          <div className="text-xs text-muted-foreground">
            ä½ç½®: {alert.location.address || 'æœªçŸ¥ä½ç½®'}
          </div>
        )}

        {alert.acknowledged && alert.acknowledgedAt && (
          <div className="text-xs text-green-600">
            å·²å¤„ç†äº {format(new Date(alert.acknowledgedAt), 'yyyy-MM-dd HH:mm:ss', { locale: zhCN })}
          </div>
        )}
      </div>
    </div>
  )
}
```

### 6. åˆ›å»ºç±»å‹å®šä¹‰

åˆ›å»º`src/types/tracking.ts`:

```typescript
export interface VehicleTracking {
  id: string
  licensePlate: string
  driverName: string
  driverId: string
  orderNumber: string
  status: 'IN_TRANSIT' | 'STOPPED' | 'OFFLINE'
  location: {
    lat: number
    lng: number
    address: string
  }
  currentLocation?: {
    lat: number
    lng: number
    address: string
  }
  destination?: {
    lat: number
    lng: number
    address: string
  }
  startLocation?: {
    lat: number
    lng: number
    address: string
  }
  speed: number
  heading: number
  fuelLevel?: number
  engineStatus?: string
  totalDistance?: number
  traveledDistance?: number
  remainingDistance?: number
  estimatedDuration?: number
  elapsedTime?: number
  averageSpeed?: number
  maxSpeed?: number
  fuelEfficiency?: number
  onTimeRate?: number
  hardAccelerations?: number
  hardBrakings?: number
  speedingEvents?: number
  assignmentTime?: string
  departureTime?: string
  eta?: string
  lastUpdate: string
  path?: Array<{
    lat: number
    lng: number
    address?: string
    timestamp?: string
  }>
  alerts?: TrackingAlert[]
}

export interface TrackingAlert {
  id: string
  vehicleId?: string
  type: string
  severity: 'critical' | 'high' | 'medium' | 'low'
  message: string
  timestamp: string
  acknowledged: boolean
  acknowledgedAt?: string
  acknowledgedBy?: string
  location?: {
    lat: number
    lng: number
    address: string
  }
  metadata?: Record<string, any>
}

export type AlertType =
  | 'speeding'
  | 'hard_braking'
  | 'hard_acceleration'
  | 'fuel_low'
  | 'engine_warning'
  | 'route_deviation'
  | 'delay_warning'
  | 'geofence_violation'
  | 'connection_lost'
  | 'emergency'
```

### 7. åˆ›å»ºè·Ÿè¸ªé¡µé¢

åˆ›å»º`src/app/tracking/page.tsx`:

```typescript
'use client'

import { useState, useEffect } from 'react'
import { TrackingDashboard } from '@/components/tracking/tracking-dashboard'
import { VehicleTracking, TrackingAlert } from '@/types/tracking'

// æ¨¡æ‹Ÿæ•°æ®
const mockVehicles: VehicleTracking[] = [
  {
    id: '1',
    licensePlate: 'äº¬A12345',
    driverName: 'å¼ å¸æœº',
    driverId: '1',
    orderNumber: 'ORD-2024-0001',
    status: 'IN_TRANSIT',
    location: {
      lat: 39.9042,
      lng: 116.4074,
      address: 'åŒ—äº¬å¸‚æœé˜³åŒºå»ºå›½è·¯'
    },
    currentLocation: {
      lat: 39.9042,
      lng: 116.4074,
      address: 'åŒ—äº¬å¸‚æœé˜³åŒºå»ºå›½è·¯'
    },
    destination: {
      lat: 31.2304,
      lng: 121.4737,
      address: 'ä¸Šæµ·å¸‚æµ¦ä¸œæ–°åŒºä¸–çºªå¤§é“100å·'
    },
    speed: 65,
    heading: 120,
    fuelLevel: 75,
    engineStatus: 'normal',
    totalDistance: 1200,
    traveledDistance: 300,
    remainingDistance: 900,
    estimatedDuration: 720,
    elapsedTime: 180,
    averageSpeed: 60,
    maxSpeed: 85,
    fuelEfficiency: 8.5,
    onTimeRate: 95,
    hardAccelerations: 2,
    hardBrakings: 1,
    speedingEvents: 1,
    assignmentTime: '2024-01-15T08:00:00Z',
    departureTime: '2024-01-15T09:00:00Z',
    eta: '2024-01-15T18:00:00Z',
    lastUpdate: '2024-01-15T12:30:00Z',
  },
  {
    id: '2',
    licensePlate: 'æ²ªB67890',
    driverName: 'æå¸æœº',
    driverId: '2',
    orderNumber: 'ORD-2024-0002',
    status: 'STOPPED',
    location: {
      lat: 23.1291,
      lng: 113.2644,
      address: 'å¹¿å·å¸‚å¤©æ²³åŒºå¤©æ²³è·¯'
    },
    currentLocation: {
      lat: 23.1291,
      lng: 113.2644,
      address: 'å¹¿å·å¸‚å¤©æ²³åŒºå¤©æ²³è·¯'
    },
    destination: {
      lat: 22.5431,
      lng: 114.0579,
      address: 'æ·±åœ³å¸‚å—å±±åŒºç§‘æŠ€å›­è·¯'
    },
    speed: 0,
    heading: 0,
    fuelLevel: 45,
    engineStatus: 'off',
    totalDistance: 150,
    traveledDistance: 80,
    remainingDistance: 70,
    estimatedDuration: 120,
    elapsedTime: 90,
    averageSpeed: 45,
    maxSpeed: 60,
    fuelEfficiency: 9.2,
    onTimeRate: 100,
    hardAccelerations: 0,
    hardBrakings: 0,
    speedingEvents: 0,
    assignmentTime: '2024-01-15T10:00:00Z',
    departureTime: '2024-01-15T10:30:00Z',
    eta: '2024-01-15T12:30:00Z',
    lastUpdate: '2024-01-15T12:00:00Z',
  },
]

const mockAlerts: TrackingAlert[] = [
  {
    id: '1',
    vehicleId: '1',
    type: 'speeding',
    severity: 'medium',
    message: 'è½¦è¾†è¶…é€Ÿè¡Œé©¶ï¼š85km/hï¼ˆé™é€Ÿ80km/hï¼‰',
    timestamp: '2024-01-15T12:25:00Z',
    acknowledged: false,
    location: {
      lat: 39.9042,
      lng: 116.4074,
      address: 'åŒ—äº¬å¸‚æœé˜³åŒºå»ºå›½è·¯'
    }
  },
  {
    id: '2',
    vehicleId: '2',
    type: 'fuel_low',
    severity: 'high',
    message: 'ç‡ƒæ²¹æ°´å¹³åä½ï¼š45%ï¼Œå»ºè®®åŠæ—¶åŠ æ²¹',
    timestamp: '2024-01-15T11:45:00Z',
    acknowledged: true,
    acknowledgedAt: '2024-01-15T11:50:00Z',
    location: {
      lat: 23.1291,
      lng: 113.2644,
      address: 'å¹¿å·å¸‚å¤©æ²³åŒºå¤©æ²³è·¯'
    }
  },
]

export default function TrackingPage() {
  const [vehicles, setVehicles] = useState<VehicleTracking[]>(mockVehicles)
  const [alerts, setAlerts] = useState<TrackingAlert[]>(mockAlerts)
  const [selectedVehicleId, setSelectedVehicleId] = useState<string | null>(null)

  // æ¨¡æ‹Ÿå®æ—¶æ•°æ®æ›´æ–°
  useEffect(() => {
    const interval = setInterval(() => {
      setVehicles(prevVehicles =>
        prevVehicles.map(vehicle => ({
          ...vehicle,
          speed: vehicle.status === 'IN_TRANSIT' ?
            Math.max(0, vehicle.speed + (Math.random() - 0.5) * 10) : 0,
          lastUpdate: new Date().toISOString(),
          traveledDistance: vehicle.status === 'IN_TRANSIT' ?
            vehicle.traveledDistance! + (vehicle.speed / 3600) * 5 : vehicle.traveledDistance,
          remainingDistance: vehicle.status === 'IN_TRANSIT' ?
            Math.max(0, vehicle.remainingDistance! - (vehicle.speed / 3600) * 5) : vehicle.remainingDistance,
        }))
      )
    }, 5000)

    return () => clearInterval(interval)
  }, [])

  // å¤„ç†è½¦è¾†é€‰æ‹©
  const handleVehicleSelect = (vehicleId: string) => {
    setSelectedVehicleId(vehicleId)
  }

  // å¤„ç†å‘Šè­¦ç¡®è®¤
  const handleAlertAcknowledge = async (alertId: string) => {
    try {
      // æ¨¡æ‹ŸAPIè°ƒç”¨
      await new Promise(resolve => setTimeout(resolve, 500))

      setAlerts(prevAlerts =>
        prevAlerts.map(alert =>
          alert.id === alertId
            ? {
                ...alert,
                acknowledged: true,
                acknowledgedAt: new Date().toISOString(),
                acknowledgedBy: 'system',
              }
            : alert
        )
      )
    } catch (error) {
      console.error('ç¡®è®¤å‘Šè­¦å¤±è´¥:', error)
    }
  }

  return (
    <div className="container mx-auto py-8">
      <TrackingDashboard
        vehicles={vehicles}
        alerts={alerts}
        onVehicleSelect={handleVehicleSelect}
        onAlertAcknowledge={handleAlertAcknowledge}
      />
    </div>
  )
}
```

## éªŒè¯æ¸…å•

- [ ] è·Ÿè¸ªä¸»ç•Œé¢å¸ƒå±€æ­£ç¡®
- [ ] è½¦è¾†ä½ç½®å®æ—¶æ›´æ–°æ­£å¸¸
- [ ] åœ°å›¾è§†å›¾æ˜¾ç¤ºæ­£ç¡®
- [ ] çŠ¶æ€æ—¶é—´çº¿å®Œæ•´
- [ ] å‘Šè­¦é¢æ¿åŠŸèƒ½æ­£å¸¸
- [ ] è½¦è¾†è¯¦æƒ…æ˜¾ç¤ºå®Œæ•´
- [ ] å®æ—¶æ•°æ®æ›´æ–°æµç•…
- [ ] å“åº”å¼è®¾è®¡è‰¯å¥½

## æµ‹è¯•å‘½ä»¤

```bash
# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev

# è¿è¡Œç±»å‹æ£€æŸ¥
npm run type-check

# è¿è¡Œæµ‹è¯•
npm test

# æ£€æŸ¥æ„å»º
npm run build
```

## æ³¨æ„äº‹é¡¹

- ç¡®ä¿åœ°å›¾é›†æˆæ­£ç¡®ä¸”æ€§èƒ½ä¼˜åŒ–
- å®ç°å®æ—¶æ•°æ®é€šä¿¡æœºåˆ¶
- ä¼˜åŒ–å¤§é‡è½¦è¾†æ ‡è®°çš„æ¸²æŸ“æ€§èƒ½
- æ·»åŠ é€‚å½“çš„é”™è¯¯å¤„ç†å’Œé‡è¿æœºåˆ¶
- è€ƒè™‘æ·»åŠ ç¦»çº¿æ•°æ®ç¼“å­˜
- ç¡®ä¿ç§»åŠ¨ç«¯åœ°å›¾æ“ä½œä½“éªŒè‰¯å¥½