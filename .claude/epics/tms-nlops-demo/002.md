---
title: "TMS NL-Opsæ¼”ç¤ºç³»ç»Ÿä»»åŠ¡002: ç›®å½•ç»“æ„è®¾è®¡å’ŒåŸºç¡€æ–‡ä»¶åˆ›å»º"
epic: "tms-nlops-demo"
task: "002"
phase: "1"
status: "pending"
priority: "high"
estimated_hours: 2
parallel: true
depends_on: ["001"]
tags: ["infrastructure", "structure", "architecture"]
created: "2025-09-20T04:20:45Z"
updated: "2025-09-20T04:20:45Z"
---

## æ¦‚è¿°

è®¾è®¡å¹¶åˆ›å»ºTMS NL-Opsæ¼”ç¤ºç³»ç»Ÿçš„ç›®å½•ç»“æ„ï¼ŒæŒ‰ç…§ç°ä»£å‰ç«¯é¡¹ç›®æœ€ä½³å®è·µç»„ç»‡ä»£ç ï¼Œç¡®ä¿å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§ã€‚

## ç›®æ ‡

- è®¾è®¡æ¸…æ™°çš„ç›®å½•ç»“æ„
- åˆ›å»ºåŸºç¡€é…ç½®æ–‡ä»¶
- å»ºç«‹æ¨¡å—åŒ–ç»„ä»¶æ¶æ„
- è®¾ç½®ç±»å‹å®šä¹‰å’Œå·¥å…·å‡½æ•°
- åˆ›å»ºç¯å¢ƒé…ç½®æ–‡ä»¶

## ç›®å½•ç»“æ„

```
tms-nlops-demo/
â”œâ”€â”€ .claude/
â”‚   â””â”€â”€ epics/
â”‚       â””â”€â”€ tms-nlops-demo/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app/                    # Next.js App Router
â”‚   â”‚   â”œâ”€â”€ (dashboard)/        # ä»ªè¡¨æ¿è·¯ç”±ç»„
â”‚   â”‚   â”œâ”€â”€ (auth)/             # è®¤è¯è·¯ç”±ç»„
â”‚   â”‚   â”œâ”€â”€ api/                # APIè·¯ç”±
â”‚   â”‚   â”‚   â”œâ”€â”€ auth/           # è®¤è¯ç›¸å…³API
â”‚   â”‚   â”‚   â”œâ”€â”€ orders/         # è®¢å•ç›¸å…³API
â”‚   â”‚   â”‚   â”œâ”€â”€ vehicles/       # è½¦è¾†ç›¸å…³API
â”‚   â”‚   â”‚   â”œâ”€â”€ tracking/       # è·Ÿè¸ªç›¸å…³API
â”‚   â”‚   â”‚   â””â”€â”€ nlops/          # NL-Opsç›¸å…³API
â”‚   â”‚   â”œâ”€â”€ globals.css         # å…¨å±€æ ·å¼
â”‚   â”‚   â”œâ”€â”€ layout.tsx          # æ ¹å¸ƒå±€
â”‚   â”‚   â””â”€â”€ page.tsx            # é¦–é¡µ
â”‚   â”œâ”€â”€ components/             # ç»„ä»¶åº“
â”‚   â”‚   â”œâ”€â”€ ui/                 # åŸºç¡€UIç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ layout/             # å¸ƒå±€ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ forms/              # è¡¨å•ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ charts/             # å›¾è¡¨ç»„ä»¶
â”‚   â”‚   â””â”€â”€ nlops/              # NL-Opsç›¸å…³ç»„ä»¶
â”‚   â”œâ”€â”€ lib/                    # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ utils.ts            # é€šç”¨å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ db/                 # æ•°æ®åº“ç›¸å…³
â”‚   â”‚   â”œâ”€â”€ api/                # APIå®¢æˆ·ç«¯
â”‚   â”‚   â”œâ”€â”€ types/              # ç±»å‹å®šä¹‰
â”‚   â”‚   â””â”€â”€ nlops/              # NL-Opså·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ hooks/                  # React Hooks
â”‚   â”œâ”€â”€ store/                  # çŠ¶æ€ç®¡ç†
â”‚   â”œâ”€â”€ constants/              # å¸¸é‡å®šä¹‰
â”‚   â”œâ”€â”€ types/                  # TypeScriptç±»å‹
â”‚   â””â”€â”€ styles/                 # æ ·å¼æ–‡ä»¶
â”œâ”€â”€ prisma/                     # Prismaæ•°æ®åº“
â”œâ”€â”€ public/                     # é™æ€èµ„æº
â”œâ”€â”€ docs/                       # æ–‡æ¡£
â”œâ”€â”€ tests/                      # æµ‹è¯•æ–‡ä»¶
â”œâ”€â”€ .env.local                  # ç¯å¢ƒå˜é‡
â”œâ”€â”€ .env.example               # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â”œâ”€â”€ package.json               # ä¾èµ–é…ç½®
â”œâ”€â”€ tsconfig.json              # TypeScripté…ç½®
â”œâ”€â”€ tailwind.config.js         # Tailwindé…ç½®
â””â”€â”€ README.md                  # é¡¹ç›®è¯´æ˜
```

## å®æ–½æ­¥éª¤

### 1. åˆ›å»ºåŸºç¡€ç›®å½•ç»“æ„

```bash
# åˆ›å»ºæ‰€æœ‰ç›®å½•
mkdir -p src/app/\(dashboard\)
mkdir -p src/app/\(auth\)
mkdir -p src/app/api/{auth,orders,vehicles,tracking,nlops}
mkdir -p src/components/{ui,layout,forms,charts,nlops}
mkdir -p src/lib/{db,api,types,nlops}
mkdir -p src/{hooks,store,constants,styles}
mkdir -p prisma
mkdir -p docs
mkdir -p tests
```

### 2. åˆ›å»ºç¯å¢ƒé…ç½®æ–‡ä»¶

åˆ›å»º`.env.example`:

```env
# æ•°æ®åº“é…ç½®
DATABASE_URL="postgresql://username:password@localhost:5432/tms_nlops_demo"

# NextAuthé…ç½®
NEXTAUTH_URL="http://localhost:3000"
NEXTAUTH_SECRET="your-secret-key-here"

# OpenAIé…ç½®
OPENAI_API_KEY="your-openai-api-key"
OPENAI_ORGANIZATION="your-openai-org-id"

# åº”ç”¨é…ç½®
NODE_ENV="development"
APP_NAME="TMS NL-Ops Demo"
APP_VERSION="1.0.0"
```

åˆ›å»º`.env.local`:

```env
# æ•°æ®åº“é…ç½®
DATABASE_URL="postgresql://postgres:password@localhost:5432/tms_nlops_demo"

# NextAuthé…ç½®
NEXTAUTH_URL="http://localhost:3000"
NEXTAUTH_SECRET="dev-secret-key-change-in-production"

# OpenAIé…ç½®
OPENAI_API_KEY="your-openai-api-key-here"
OPENAI_ORGANIZATION="your-openai-org-id"

# åº”ç”¨é…ç½®
NODE_ENV="development"
APP_NAME="TMS NL-Ops Demo"
APP_VERSION="1.0.0"
```

### 3. åˆ›å»ºåŸºç¡€ç±»å‹å®šä¹‰

åˆ›å»º`src/types/index.ts`:

```typescript
// åŸºç¡€ç±»å‹
export interface BaseEntity {
  id: string
  createdAt: Date
  updatedAt: Date
}

// ç”¨æˆ·ç›¸å…³ç±»å‹
export interface User extends BaseEntity {
  email: string
  name: string
  role: 'admin' | 'manager' | 'driver' | 'customer'
  avatar?: string
}

// å®¢æˆ·ç›¸å…³ç±»å‹
export interface Customer extends BaseEntity {
  name: string
  contactPerson: string
  phone: string
  email: string
  address: string
  company: string
  creditLimit?: number
}

// è®¢å•ç›¸å…³ç±»å‹
export interface Order extends BaseEntity {
  orderNumber: string
  customerId: string
  customer: Customer
  status: 'pending' | 'confirmed' | 'in_transit' | 'delivered' | 'cancelled'
  origin: string
  destination: string
  weight: number
  volume: number
  value?: number
  pickupTime: Date
  deliveryTime: Date
  specialInstructions?: string
  assignedVehicleId?: string
  assignedVehicle?: Vehicle
}

// è½¦è¾†ç›¸å…³ç±»å‹
export interface Vehicle extends BaseEntity {
  licensePlate: string
  type: 'truck' | 'van' | 'trailer'
  capacity: number
  driverId: string
  driver: User
  status: 'available' | 'in_transit' | 'maintenance' | 'unavailable'
  currentLocation?: string
  lastMaintenance?: Date
}

// æ’è½¦ç›¸å…³ç±»å‹
export interface Schedule extends BaseEntity {
  orderId: string
  order: Order
  vehicleId: string
  vehicle: Vehicle
  plannedDeparture: Date
  plannedArrival: Date
  actualDeparture?: Date
  actualArrival?: Date
  status: 'planned' | 'in_progress' | 'completed' | 'delayed'
  route?: string[]
}

// è·Ÿè¸ªç›¸å…³ç±»å‹
export interface Tracking extends BaseEntity {
  orderId: string
  order: Order
  location: string
  coordinates: {
    lat: number
    lng: number
  }
  status: 'pickup' | 'in_transit' | 'delivery' | 'completed'
  timestamp: Date
  notes?: string
  imageUrl?: string
}

// å›å•ç›¸å…³ç±»å‹
export interface Receipt extends BaseEntity {
  orderId: string
  order: Order
  status: 'pending' | 'uploaded' | 'verified' | 'rejected'
  imageUrl?: string
  notes?: string
  verifiedBy?: string
  verifiedAt?: Date
}

// NL-Opsç›¸å…³ç±»å‹
export interface NLCommand {
  id: string
  command: string
  intent: string
  parameters: Record<string, any>
  confidence: number
  executed: boolean
  result?: any
  createdAt: Date
  executedAt?: Date
}

export interface Intent {
  name: string
  description: string
  parameters: Parameter[]
  requiredParameters: string[]
}

export interface Parameter {
  name: string
  type: 'string' | 'number' | 'date' | 'boolean' | 'array'
  description: string
  required: boolean
}

// APIå“åº”ç±»å‹
export interface ApiResponse<T> {
  success: boolean
  data?: T
  error?: string
  message?: string
}

// åˆ†é¡µç±»å‹
export interface PaginationParams {
  page: number
  limit: number
  sortBy?: string
  sortOrder?: 'asc' | 'desc'
}

export interface PaginatedResponse<T> {
  data: T[]
  pagination: {
    page: number
    limit: number
    total: number
    pages: number
  }
}
```

### 4. åˆ›å»ºå¸¸é‡å®šä¹‰

åˆ›å»º`src/constants/index.ts`:

```typescript
// åº”ç”¨å¸¸é‡
export const APP_CONFIG = {
  name: 'TMS NL-Ops Demo',
  version: '1.0.0',
  description: 'è‡ªç„¶è¯­è¨€æ“ä½œè¿è¾“ç®¡ç†ç³»ç»Ÿæ¼”ç¤º',
} as const

// åˆ†é¡µå¸¸é‡
export const PAGINATION = {
  defaultLimit: 20,
  maxLimit: 100,
} as const

// è®¢å•çŠ¶æ€
export const ORDER_STATUS = {
  PENDING: 'pending',
  CONFIRMED: 'confirmed',
  IN_TRANSIT: 'in_transit',
  DELIVERED: 'delivered',
  CANCELLED: 'cancelled',
} as const

// è½¦è¾†çŠ¶æ€
export const VEHICLE_STATUS = {
  AVAILABLE: 'available',
  IN_TRANSIT: 'in_transit',
  MAINTENANCE: 'maintenance',
  UNAVAILABLE: 'unavailable',
} as const

// è½¦è¾†ç±»å‹
export const VEHICLE_TYPE = {
  TRUCK: 'truck',
  VAN: 'van',
  TRAILER: 'trailer',
} as const

// ç”¨æˆ·è§’è‰²
export const USER_ROLE = {
  ADMIN: 'admin',
  MANAGER: 'manager',
  DRIVER: 'driver',
  CUSTOMER: 'customer',
} as const

// è·Ÿè¸ªçŠ¶æ€
export const TRACKING_STATUS = {
  PICKUP: 'pickup',
  IN_TRANSIT: 'in_transit',
  DELIVERY: 'delivery',
  COMPLETED: 'completed',
} as const

// å›å•çŠ¶æ€
export const RECEIPT_STATUS = {
  PENDING: 'pending',
  UPLOADED: 'uploaded',
  VERIFIED: 'verified',
  REJECTED: 'rejected',
} as const

// NL-Opsæ„å›¾
export const NLOPS_INTENTS = {
  CREATE_ORDER: 'create_order',
  UPDATE_ORDER: 'update_order',
  CANCEL_ORDER: 'cancel_order',
  ASSIGN_VEHICLE: 'assign_vehicle',
  TRACK_ORDER: 'track_order',
  UPLOAD_RECEIPT: 'upload_receipt',
  GET_ORDERS: 'get_orders',
  GET_VEHICLES: 'get_vehicles',
} as const

// APIç«¯ç‚¹
export const API_ENDPOINTS = {
  AUTH: {
    LOGIN: '/api/auth/login',
    LOGOUT: '/api/auth/logout',
    PROFILE: '/api/auth/profile',
  },
  ORDERS: {
    LIST: '/api/orders',
    CREATE: '/api/orders',
    UPDATE: '/api/orders/[id]',
    DELETE: '/api/orders/[id]',
    TRACK: '/api/orders/[id]/track',
  },
  VEHICLES: {
    LIST: '/api/vehicles',
    CREATE: '/api/vehicles',
    UPDATE: '/api/vehicles/[id]',
    DELETE: '/api/vehicles/[id]',
  },
  TRACKING: {
    LIST: '/api/tracking',
    CREATE: '/api/tracking',
    UPDATE: '/api/tracking/[id]',
  },
  NLOPS: {
    COMMAND: '/api/nlops/command',
    HISTORY: '/api/nlops/history',
    INTENTS: '/api/nlops/intents',
  },
} as const

// æœ¬åœ°å­˜å‚¨é”®
export const STORAGE_KEYS = {
  AUTH_TOKEN: 'auth_token',
  USER_DATA: 'user_data',
  THEME: 'theme',
  LANGUAGE: 'language',
} as const
```

### 5. åˆ›å»ºåŸºç¡€å¸ƒå±€ç»„ä»¶

åˆ›å»º`src/components/layout/sidebar.tsx`:

```typescript
'use client'

import { cn } from '@/lib/utils'
import Link from 'next/link'
import { usePathname } from 'next/navigation'

const navigation = [
  { name: 'ä»ªè¡¨æ¿', href: '/dashboard', icon: 'ğŸ“Š' },
  { name: 'è®¢å•ç®¡ç†', href: '/dashboard/orders', icon: 'ğŸ“¦' },
  { name: 'è½¦è¾†è°ƒåº¦', href: '/dashboard/vehicles', icon: 'ğŸšš' },
  { name: 'å®æ—¶è·Ÿè¸ª', href: '/dashboard/tracking', icon: 'ğŸ“' },
  { name: 'å›å•ç®¡ç†', href: '/dashboard/receipts', icon: 'ğŸ“„' },
  { name: 'NL-Ops', href: '/dashboard/nlops', icon: 'ğŸ¤–' },
]

export function Sidebar() {
  const pathname = usePathname()

  return (
    <div className="flex h-full w-64 flex-col bg-gray-50">
      <div className="flex h-16 items-center px-6 border-b">
        <h1 className="text-xl font-semibold">TMS NL-Ops</h1>
      </div>
      <nav className="flex-1 space-y-1 px-3 py-4">
        {navigation.map((item) => {
          const isActive = pathname === item.href
          return (
            <Link
              key={item.name}
              href={item.href}
              className={cn(
                'flex items-center px-3 py-2 text-sm font-medium rounded-md transition-colors',
                isActive
                  ? 'bg-primary text-primary-foreground'
                  : 'text-gray-700 hover:bg-gray-100'
              )}
            >
              <span className="mr-3">{item.icon}</span>
              {item.name}
            </Link>
          )
        })}
      </nav>
    </div>
  )
}
```

åˆ›å»º`src/components/layout/header.tsx`:

```typescript
'use client'

import { Button } from '@/components/ui/button'
import { cn } from '@/lib/utils'

interface HeaderProps {
  className?: string
}

export function Header({ className }: HeaderProps) {
  return (
    <header className={cn('flex h-16 items-center justify-between border-b bg-white px-6', className)}>
      <div className="flex items-center space-x-4">
        <h2 className="text-lg font-semibold">è¿è¾“ç®¡ç†ç³»ç»Ÿ</h2>
      </div>

      <div className="flex items-center space-x-4">
        <Button variant="outline" size="sm">
          å¸®åŠ©
        </Button>
        <Button variant="outline" size="sm">
          è®¾ç½®
        </Button>
        <div className="h-8 w-8 rounded-full bg-gray-300 flex items-center justify-center">
          <span className="text-sm font-medium">ç”¨æˆ·</span>
        </div>
      </div>
    </header>
  )
}
```

### 6. åˆ›å»ºæ ¹å¸ƒå±€

æ›´æ–°`src/app/layout.tsx`:

```typescript
import type { Metadata } from 'next'
import { Inter } from 'next/font/google'
import './globals.css'

const inter = Inter({ subsets: ['latin'] })

export const metadata: Metadata = {
  title: 'TMS NL-Ops æ¼”ç¤ºç³»ç»Ÿ',
  description: 'è‡ªç„¶è¯­è¨€æ“ä½œè¿è¾“ç®¡ç†ç³»ç»Ÿæ¼”ç¤º',
}

export default function RootLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return (
    <html lang="zh-CN">
      <body className={inter.className}>{children}</body>
    </html>
  )
}
```

## éªŒè¯æ¸…å•

- [ ] æ‰€æœ‰ç›®å½•åˆ›å»ºæˆåŠŸ
- [ ] ç¯å¢ƒé…ç½®æ–‡ä»¶åˆ›å»ºå®Œæˆ
- [ ] ç±»å‹å®šä¹‰æ–‡ä»¶å®Œæ•´
- [ ] å¸¸é‡å®šä¹‰å®Œæ•´
- [ ] åŸºç¡€ç»„ä»¶åˆ›å»ºæˆåŠŸ
- [ ] ç›®å½•ç»“æ„ç¬¦åˆæœ€ä½³å®è·µ
- [ ] TypeScripté…ç½®æ­£ç¡®

## æµ‹è¯•å‘½ä»¤

```bash
# æ£€æŸ¥ç›®å½•ç»“æ„
ls -la src/

# éªŒè¯TypeScriptç±»å‹
npx tsc --noEmit

# æ£€æŸ¥ç¯å¢ƒå˜é‡
npm run dev
```

## æ³¨æ„äº‹é¡¹

- ç¡®ä¿ç›®å½•ç»“æ„çš„ä¸€è‡´æ€§
- ç±»å‹å®šä¹‰è¦è¦†ç›–æ‰€æœ‰ä¸šåŠ¡å®ä½“
- å¸¸é‡å®šä¹‰è¦ä¾¿äºç»´æŠ¤å’Œä¿®æ”¹
- å¸ƒå±€ç»„ä»¶è¦æ”¯æŒå“åº”å¼è®¾è®¡
- ç¯å¢ƒå˜é‡æ–‡ä»¶ä¸è¦æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶