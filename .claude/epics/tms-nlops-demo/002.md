---
title: "TMS NL-Ops演示系统任务002: 目录结构设计和基础文件创建"
epic: "tms-nlops-demo"
task: "002"
phase: "1"
status: "pending"
priority: "high"
estimated_hours: 2
parallel: true
depends_on: ["001"]
tags: ["infrastructure", "structure", "architecture"]
created: "2025-09-20T04:20:45Z"
updated: "2025-09-20T04:20:45Z"
---

## 概述

设计并创建TMS NL-Ops演示系统的目录结构，按照现代前端项目最佳实践组织代码，确保可维护性和可扩展性。

## 目标

- 设计清晰的目录结构
- 创建基础配置文件
- 建立模块化组件架构
- 设置类型定义和工具函数
- 创建环境配置文件

## 目录结构

```
tms-nlops-demo/
├── .claude/
│   └── epics/
│       └── tms-nlops-demo/
├── src/
│   ├── app/                    # Next.js App Router
│   │   ├── (dashboard)/        # 仪表板路由组
│   │   ├── (auth)/             # 认证路由组
│   │   ├── api/                # API路由
│   │   │   ├── auth/           # 认证相关API
│   │   │   ├── orders/         # 订单相关API
│   │   │   ├── vehicles/       # 车辆相关API
│   │   │   ├── tracking/       # 跟踪相关API
│   │   │   └── nlops/          # NL-Ops相关API
│   │   ├── globals.css         # 全局样式
│   │   ├── layout.tsx          # 根布局
│   │   └── page.tsx            # 首页
│   ├── components/             # 组件库
│   │   ├── ui/                 # 基础UI组件
│   │   ├── layout/             # 布局组件
│   │   ├── forms/              # 表单组件
│   │   ├── charts/             # 图表组件
│   │   └── nlops/              # NL-Ops相关组件
│   ├── lib/                    # 工具函数
│   │   ├── utils.ts            # 通用工具函数
│   │   ├── db/                 # 数据库相关
│   │   ├── api/                # API客户端
│   │   ├── types/              # 类型定义
│   │   └── nlops/              # NL-Ops工具函数
│   ├── hooks/                  # React Hooks
│   ├── store/                  # 状态管理
│   ├── constants/              # 常量定义
│   ├── types/                  # TypeScript类型
│   └── styles/                 # 样式文件
├── prisma/                     # Prisma数据库
├── public/                     # 静态资源
├── docs/                       # 文档
├── tests/                      # 测试文件
├── .env.local                  # 环境变量
├── .env.example               # 环境变量示例
├── package.json               # 依赖配置
├── tsconfig.json              # TypeScript配置
├── tailwind.config.js         # Tailwind配置
└── README.md                  # 项目说明
```

## 实施步骤

### 1. 创建基础目录结构

```bash
# 创建所有目录
mkdir -p src/app/\(dashboard\)
mkdir -p src/app/\(auth\)
mkdir -p src/app/api/{auth,orders,vehicles,tracking,nlops}
mkdir -p src/components/{ui,layout,forms,charts,nlops}
mkdir -p src/lib/{db,api,types,nlops}
mkdir -p src/{hooks,store,constants,styles}
mkdir -p prisma
mkdir -p docs
mkdir -p tests
```

### 2. 创建环境配置文件

创建`.env.example`:

```env
# 数据库配置
DATABASE_URL="postgresql://username:password@localhost:5432/tms_nlops_demo"

# NextAuth配置
NEXTAUTH_URL="http://localhost:3000"
NEXTAUTH_SECRET="your-secret-key-here"

# OpenAI配置
OPENAI_API_KEY="your-openai-api-key"
OPENAI_ORGANIZATION="your-openai-org-id"

# 应用配置
NODE_ENV="development"
APP_NAME="TMS NL-Ops Demo"
APP_VERSION="1.0.0"
```

创建`.env.local`:

```env
# 数据库配置
DATABASE_URL="postgresql://postgres:password@localhost:5432/tms_nlops_demo"

# NextAuth配置
NEXTAUTH_URL="http://localhost:3000"
NEXTAUTH_SECRET="dev-secret-key-change-in-production"

# OpenAI配置
OPENAI_API_KEY="your-openai-api-key-here"
OPENAI_ORGANIZATION="your-openai-org-id"

# 应用配置
NODE_ENV="development"
APP_NAME="TMS NL-Ops Demo"
APP_VERSION="1.0.0"
```

### 3. 创建基础类型定义

创建`src/types/index.ts`:

```typescript
// 基础类型
export interface BaseEntity {
  id: string
  createdAt: Date
  updatedAt: Date
}

// 用户相关类型
export interface User extends BaseEntity {
  email: string
  name: string
  role: 'admin' | 'manager' | 'driver' | 'customer'
  avatar?: string
}

// 客户相关类型
export interface Customer extends BaseEntity {
  name: string
  contactPerson: string
  phone: string
  email: string
  address: string
  company: string
  creditLimit?: number
}

// 订单相关类型
export interface Order extends BaseEntity {
  orderNumber: string
  customerId: string
  customer: Customer
  status: 'pending' | 'confirmed' | 'in_transit' | 'delivered' | 'cancelled'
  origin: string
  destination: string
  weight: number
  volume: number
  value?: number
  pickupTime: Date
  deliveryTime: Date
  specialInstructions?: string
  assignedVehicleId?: string
  assignedVehicle?: Vehicle
}

// 车辆相关类型
export interface Vehicle extends BaseEntity {
  licensePlate: string
  type: 'truck' | 'van' | 'trailer'
  capacity: number
  driverId: string
  driver: User
  status: 'available' | 'in_transit' | 'maintenance' | 'unavailable'
  currentLocation?: string
  lastMaintenance?: Date
}

// 排车相关类型
export interface Schedule extends BaseEntity {
  orderId: string
  order: Order
  vehicleId: string
  vehicle: Vehicle
  plannedDeparture: Date
  plannedArrival: Date
  actualDeparture?: Date
  actualArrival?: Date
  status: 'planned' | 'in_progress' | 'completed' | 'delayed'
  route?: string[]
}

// 跟踪相关类型
export interface Tracking extends BaseEntity {
  orderId: string
  order: Order
  location: string
  coordinates: {
    lat: number
    lng: number
  }
  status: 'pickup' | 'in_transit' | 'delivery' | 'completed'
  timestamp: Date
  notes?: string
  imageUrl?: string
}

// 回单相关类型
export interface Receipt extends BaseEntity {
  orderId: string
  order: Order
  status: 'pending' | 'uploaded' | 'verified' | 'rejected'
  imageUrl?: string
  notes?: string
  verifiedBy?: string
  verifiedAt?: Date
}

// NL-Ops相关类型
export interface NLCommand {
  id: string
  command: string
  intent: string
  parameters: Record<string, any>
  confidence: number
  executed: boolean
  result?: any
  createdAt: Date
  executedAt?: Date
}

export interface Intent {
  name: string
  description: string
  parameters: Parameter[]
  requiredParameters: string[]
}

export interface Parameter {
  name: string
  type: 'string' | 'number' | 'date' | 'boolean' | 'array'
  description: string
  required: boolean
}

// API响应类型
export interface ApiResponse<T> {
  success: boolean
  data?: T
  error?: string
  message?: string
}

// 分页类型
export interface PaginationParams {
  page: number
  limit: number
  sortBy?: string
  sortOrder?: 'asc' | 'desc'
}

export interface PaginatedResponse<T> {
  data: T[]
  pagination: {
    page: number
    limit: number
    total: number
    pages: number
  }
}
```

### 4. 创建常量定义

创建`src/constants/index.ts`:

```typescript
// 应用常量
export const APP_CONFIG = {
  name: 'TMS NL-Ops Demo',
  version: '1.0.0',
  description: '自然语言操作运输管理系统演示',
} as const

// 分页常量
export const PAGINATION = {
  defaultLimit: 20,
  maxLimit: 100,
} as const

// 订单状态
export const ORDER_STATUS = {
  PENDING: 'pending',
  CONFIRMED: 'confirmed',
  IN_TRANSIT: 'in_transit',
  DELIVERED: 'delivered',
  CANCELLED: 'cancelled',
} as const

// 车辆状态
export const VEHICLE_STATUS = {
  AVAILABLE: 'available',
  IN_TRANSIT: 'in_transit',
  MAINTENANCE: 'maintenance',
  UNAVAILABLE: 'unavailable',
} as const

// 车辆类型
export const VEHICLE_TYPE = {
  TRUCK: 'truck',
  VAN: 'van',
  TRAILER: 'trailer',
} as const

// 用户角色
export const USER_ROLE = {
  ADMIN: 'admin',
  MANAGER: 'manager',
  DRIVER: 'driver',
  CUSTOMER: 'customer',
} as const

// 跟踪状态
export const TRACKING_STATUS = {
  PICKUP: 'pickup',
  IN_TRANSIT: 'in_transit',
  DELIVERY: 'delivery',
  COMPLETED: 'completed',
} as const

// 回单状态
export const RECEIPT_STATUS = {
  PENDING: 'pending',
  UPLOADED: 'uploaded',
  VERIFIED: 'verified',
  REJECTED: 'rejected',
} as const

// NL-Ops意图
export const NLOPS_INTENTS = {
  CREATE_ORDER: 'create_order',
  UPDATE_ORDER: 'update_order',
  CANCEL_ORDER: 'cancel_order',
  ASSIGN_VEHICLE: 'assign_vehicle',
  TRACK_ORDER: 'track_order',
  UPLOAD_RECEIPT: 'upload_receipt',
  GET_ORDERS: 'get_orders',
  GET_VEHICLES: 'get_vehicles',
} as const

// API端点
export const API_ENDPOINTS = {
  AUTH: {
    LOGIN: '/api/auth/login',
    LOGOUT: '/api/auth/logout',
    PROFILE: '/api/auth/profile',
  },
  ORDERS: {
    LIST: '/api/orders',
    CREATE: '/api/orders',
    UPDATE: '/api/orders/[id]',
    DELETE: '/api/orders/[id]',
    TRACK: '/api/orders/[id]/track',
  },
  VEHICLES: {
    LIST: '/api/vehicles',
    CREATE: '/api/vehicles',
    UPDATE: '/api/vehicles/[id]',
    DELETE: '/api/vehicles/[id]',
  },
  TRACKING: {
    LIST: '/api/tracking',
    CREATE: '/api/tracking',
    UPDATE: '/api/tracking/[id]',
  },
  NLOPS: {
    COMMAND: '/api/nlops/command',
    HISTORY: '/api/nlops/history',
    INTENTS: '/api/nlops/intents',
  },
} as const

// 本地存储键
export const STORAGE_KEYS = {
  AUTH_TOKEN: 'auth_token',
  USER_DATA: 'user_data',
  THEME: 'theme',
  LANGUAGE: 'language',
} as const
```

### 5. 创建基础布局组件

创建`src/components/layout/sidebar.tsx`:

```typescript
'use client'

import { cn } from '@/lib/utils'
import Link from 'next/link'
import { usePathname } from 'next/navigation'

const navigation = [
  { name: '仪表板', href: '/dashboard', icon: '📊' },
  { name: '订单管理', href: '/dashboard/orders', icon: '📦' },
  { name: '车辆调度', href: '/dashboard/vehicles', icon: '🚚' },
  { name: '实时跟踪', href: '/dashboard/tracking', icon: '📍' },
  { name: '回单管理', href: '/dashboard/receipts', icon: '📄' },
  { name: 'NL-Ops', href: '/dashboard/nlops', icon: '🤖' },
]

export function Sidebar() {
  const pathname = usePathname()

  return (
    <div className="flex h-full w-64 flex-col bg-gray-50">
      <div className="flex h-16 items-center px-6 border-b">
        <h1 className="text-xl font-semibold">TMS NL-Ops</h1>
      </div>
      <nav className="flex-1 space-y-1 px-3 py-4">
        {navigation.map((item) => {
          const isActive = pathname === item.href
          return (
            <Link
              key={item.name}
              href={item.href}
              className={cn(
                'flex items-center px-3 py-2 text-sm font-medium rounded-md transition-colors',
                isActive
                  ? 'bg-primary text-primary-foreground'
                  : 'text-gray-700 hover:bg-gray-100'
              )}
            >
              <span className="mr-3">{item.icon}</span>
              {item.name}
            </Link>
          )
        })}
      </nav>
    </div>
  )
}
```

创建`src/components/layout/header.tsx`:

```typescript
'use client'

import { Button } from '@/components/ui/button'
import { cn } from '@/lib/utils'

interface HeaderProps {
  className?: string
}

export function Header({ className }: HeaderProps) {
  return (
    <header className={cn('flex h-16 items-center justify-between border-b bg-white px-6', className)}>
      <div className="flex items-center space-x-4">
        <h2 className="text-lg font-semibold">运输管理系统</h2>
      </div>

      <div className="flex items-center space-x-4">
        <Button variant="outline" size="sm">
          帮助
        </Button>
        <Button variant="outline" size="sm">
          设置
        </Button>
        <div className="h-8 w-8 rounded-full bg-gray-300 flex items-center justify-center">
          <span className="text-sm font-medium">用户</span>
        </div>
      </div>
    </header>
  )
}
```

### 6. 创建根布局

更新`src/app/layout.tsx`:

```typescript
import type { Metadata } from 'next'
import { Inter } from 'next/font/google'
import './globals.css'

const inter = Inter({ subsets: ['latin'] })

export const metadata: Metadata = {
  title: 'TMS NL-Ops 演示系统',
  description: '自然语言操作运输管理系统演示',
}

export default function RootLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return (
    <html lang="zh-CN">
      <body className={inter.className}>{children}</body>
    </html>
  )
}
```

## 验证清单

- [ ] 所有目录创建成功
- [ ] 环境配置文件创建完成
- [ ] 类型定义文件完整
- [ ] 常量定义完整
- [ ] 基础组件创建成功
- [ ] 目录结构符合最佳实践
- [ ] TypeScript配置正确

## 测试命令

```bash
# 检查目录结构
ls -la src/

# 验证TypeScript类型
npx tsc --noEmit

# 检查环境变量
npm run dev
```

## 注意事项

- 确保目录结构的一致性
- 类型定义要覆盖所有业务实体
- 常量定义要便于维护和修改
- 布局组件要支持响应式设计
- 环境变量文件不要提交到版本控制