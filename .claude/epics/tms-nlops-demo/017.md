---
title: "TMS NL-Ops演示系统任务017: 排车调度界面实现"
epic: "tms-nlops-demo"
task: "017"
phase: "3"
status: "pending"
priority: "high"
estimated_hours: 20
parallel: false
depends_on: ["008", "009", "010", "011", "012"]
tags: ["ui", "dispatch", "vehicle-management", "route-planning"]
created: "2025-09-20T04:20:45Z"
updated: "2025-09-20T04:20:45Z"
---

## 概述

实现TMS NL-Ops演示系统的排车调度界面，包括订单池管理、车辆分配和路线规划功能。这是系统的核心业务功能，需要提供直观的可视化界面来管理运输资源的调度。

## 目标

- 创建订单池管理界面，显示待分配订单
- 实现车辆资源管理，包括车辆状态和位置
- 开发拖拽式订单分配功能
- 实现路线规划可视化
- 提供调度决策支持和优化建议
- 确保界面操作流畅且符合业务逻辑

## 技术栈

- **框架**: Next.js 15+ App Router
- **语言**: TypeScript
- **样式**: Tailwind CSS + shadcn/ui v2
- **拖拽**: react-dnd / @dnd-kit
- **地图**: Leaflet / React-Leaflet
- **图表**: Recharts / Chart.js
- **状态管理**: Zustand

## 实施步骤

### 1. 创建调度主界面组件

创建`src/components/dispatch/dispatch-board.tsx`:

```typescript
'use client'

import { useState, useMemo } from 'react'
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'
import { Button } from '@/components/ui/button'
import { Badge } from '@/components/ui/badge'
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs'
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select'
import { OrderPool } from './order-pool'
import { VehicleList } from './vehicle-list'
import { RoutePlanner } from './route-planner'
import { ScheduleTimeline } from './schedule-timeline'
import { DispatchSummary } from './dispatch-summary'
import { Order, Vehicle, DispatchAssignment } from '@/types/dispatch'

interface DispatchBoardProps {
  orders: Order[]
  vehicles: Vehicle[]
  assignments: DispatchAssignment[]
  onAssignOrder: (orderId: string, vehicleId: string) => Promise<void>
  onUnassignOrder: (assignmentId: string) => Promise<void>
  onUpdateRoute: (assignmentId: string, route: any) => Promise<void>
}

export function DispatchBoard({
  orders,
  vehicles,
  assignments,
  onAssignOrder,
  onUnassignOrder,
  onUpdateRoute,
}: DispatchBoardProps) {
  const [selectedDate, setSelectedDate] = useState<string>(new Date().toISOString().split('T')[0])
  const [selectedVehicleType, setSelectedVehicleType] = useState<string>('all')
  const [selectedRegion, setSelectedRegion] = useState<string>('all')

  // 筛选待分配订单
  const pendingOrders = useMemo(() => {
    return orders.filter(order =>
      order.status === 'PENDING' || order.status === 'ACCEPTED'
    )
  }, [orders])

  // 筛选车辆
  const filteredVehicles = useMemo(() => {
    return vehicles.filter(vehicle => {
      const typeMatch = selectedVehicleType === 'all' || vehicle.type === selectedVehicleType
      const regionMatch = selectedRegion === 'all' || vehicle.region === selectedRegion
      const available = vehicle.status === 'AVAILABLE'

      return typeMatch && regionMatch && available
    })
  }, [vehicles, selectedVehicleType, selectedRegion])

  // 统计数据
  const stats = useMemo(() => {
    const totalOrders = orders.length
    const pendingOrdersCount = pendingOrders.length
    const totalVehicles = vehicles.length
    const availableVehicles = vehicles.filter(v => v.status === 'AVAILABLE').length
    const assignedVehicles = vehicles.filter(v => v.status === 'ASSIGNED').length
    const inTransitVehicles = vehicles.filter(v => v.status === 'IN_TRANSIT').length

    return {
      totalOrders,
      pendingOrdersCount,
      totalVehicles,
      availableVehicles,
      assignedVehicles,
      inTransitVehicles,
    }
  }, [orders, vehicles, pendingOrders])

  return (
    <div className="space-y-6">
      {/* 页面标题和统计 */}
      <div className="flex justify-between items-center">
        <div>
          <h1 className="text-3xl font-bold tracking-tight">排车调度</h1>
          <p className="text-muted-foreground">管理订单分配和车辆调度</p>
        </div>
      </div>

      {/* 统计卡片 */}
      <div className="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-6 gap-4">
        <Card>
          <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
            <CardTitle className="text-sm font-medium">待分配订单</CardTitle>
          </CardHeader>
          <CardContent>
            <div className="text-2xl font-bold">{stats.pendingOrdersCount}</div>
          </CardContent>
        </Card>

        <Card>
          <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
            <CardTitle className="text-sm font-medium">总订单数</CardTitle>
          </CardHeader>
          <CardContent>
            <div className="text-2xl font-bold">{stats.totalOrders}</div>
          </CardContent>
        </Card>

        <Card>
          <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
            <CardTitle className="text-sm font-medium">可用车辆</CardTitle>
          </CardHeader>
          <CardContent>
            <div className="text-2xl font-bold text-green-600">{stats.availableVehicles}</div>
          </CardContent>
        </Card>

        <Card>
          <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
            <CardTitle className="text-sm font-medium">已分配车辆</CardTitle>
          </CardHeader>
          <CardContent>
            <div className="text-2xl font-bold text-blue-600">{stats.assignedVehicles}</div>
          </CardContent>
        </Card>

        <Card>
          <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
            <CardTitle className="text-sm font-medium">运输中车辆</CardTitle>
          </CardHeader>
          <CardContent>
            <div className="text-2xl font-bold text-orange-600">{stats.inTransitVehicles}</div>
          </CardContent>
        </Card>

        <Card>
          <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
            <CardTitle className="text-sm font-medium">总车辆数</CardTitle>
          </CardHeader>
          <CardContent>
            <div className="text-2xl font-bold">{stats.totalVehicles}</div>
          </CardContent>
        </Card>
      </div>

      {/* 筛选条件 */}
      <Card>
        <CardContent className="pt-6">
          <div className="flex space-x-4">
            <div>
              <label className="text-sm font-medium">调度日期</label>
              <Input
                type="date"
                value={selectedDate}
                onChange={(e) => setSelectedDate(e.target.value)}
                className="mt-1"
              />
            </div>
            <div>
              <label className="text-sm font-medium">车辆类型</label>
              <Select value={selectedVehicleType} onValueChange={setSelectedVehicleType}>
                <SelectTrigger className="mt-1">
                  <SelectValue placeholder="选择车辆类型" />
                </SelectTrigger>
                <SelectContent>
                  <SelectItem value="all">所有类型</SelectItem>
                  <SelectItem value="VAN">厢式车</SelectItem>
                  <SelectItem value="TRUCK">卡车</SelectItem>
                  <SelectItem value="TRAILER">挂车</SelectItem>
                </SelectContent>
              </Select>
            </div>
            <div>
              <label className="text-sm font-medium">服务区域</label>
              <Select value={selectedRegion} onValueChange={setSelectedRegion}>
                <SelectTrigger className="mt-1">
                  <SelectValue placeholder="选择服务区域" />
                </SelectTrigger>
                <SelectContent>
                  <SelectItem value="all">所有区域</SelectItem>
                  <SelectItem value="NORTH">华北</SelectItem>
                  <SelectItem value="SOUTH">华南</SelectItem>
                  <SelectItem value="EAST">华东</SelectItem>
                  <SelectItem value="WEST">华西</SelectItem>
                </SelectContent>
              </Select>
            </div>
          </div>
        </CardContent>
      </Card>

      {/* 主要内容区域 */}
      <Tabs defaultValue="dispatch" className="w-full">
        <TabsList className="grid w-full grid-cols-4">
          <TabsTrigger value="dispatch">智能调度</TabsTrigger>
          <TabsTrigger value="orders">订单池</TabsTrigger>
          <TabsTrigger value="vehicles">车辆管理</TabsTrigger>
          <TabsTrigger value="routes">路线规划</TabsTrigger>
        </TabsList>

        <TabsContent value="dispatch" className="space-y-6">
          <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
            {/* 左侧：订单池 */}
            <OrderPool
              orders={pendingOrders}
              onOrderSelect={(order) => {
                // 处理订单选择
              }}
            />

            {/* 右侧：车辆列表 */}
            <VehicleList
              vehicles={filteredVehicles}
              assignments={assignments}
              onAssignOrder={onAssignOrder}
              onUnassignOrder={onUnassignOrder}
            />
          </div>

          {/* 调度摘要 */}
          <DispatchSummary
            orders={pendingOrders}
            vehicles={filteredVehicles}
            assignments={assignments}
          />
        </TabsContent>

        <TabsContent value="orders">
          <OrderPool
            orders={pendingOrders}
            onOrderSelect={(order) => {
              // 处理订单选择
            }}
          />
        </TabsContent>

        <TabsContent value="vehicles">
          <VehicleList
            vehicles={vehicles}
            assignments={assignments}
            onAssignOrder={onAssignOrder}
            onUnassignOrder={onUnassignOrder}
          />
        </TabsContent>

        <TabsContent value="routes">
          <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <RoutePlanner
              assignments={assignments}
              onUpdateRoute={onUpdateRoute}
            />
            <ScheduleTimeline
              assignments={assignments}
              selectedDate={selectedDate}
            />
          </div>
        </TabsContent>
      </Tabs>
    </div>
  )
}
```

### 2. 创建订单池组件

创建`src/components/dispatch/order-pool.tsx`:

```typescript
'use client'

import { useState, useMemo } from 'react'
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'
import { Button } from '@/components/ui/button'
import { Badge } from '@/components/ui/badge'
import { Input } from '@/components/ui/input'
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select'
import { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table'
import { format } from 'date-fns'
import { zhCN } from 'date-fns/locale'
import { Order } from '@/types/dispatch'
import { cn } from '@/lib/utils'

interface OrderPoolProps {
  orders: Order[]
  onOrderSelect: (order: Order) => void
}

export function OrderPool({ orders, onOrderSelect }: OrderPoolProps) {
  const [searchTerm, setSearchTerm] = useState('')
  const [sortBy, setSortBy] = useState<'createdAt' | 'weight' | 'priority'>('createdAt')
  const [sortOrder, setSortOrder] = useState<'asc' | 'desc'>('desc')
  const [selectedOrders, setSelectedOrders] = useState<Set<string>>(new Set())

  // 筛选和排序订单
  const filteredOrders = useMemo(() => {
    let filtered = orders.filter(order =>
      order.orderNumber.toLowerCase().includes(searchTerm.toLowerCase()) ||
      order.consignorName.toLowerCase().includes(searchTerm.toLowerCase()) ||
      order.consigneeName.toLowerCase().includes(searchTerm.toLowerCase())
    )

    // 排序
    filtered.sort((a, b) => {
      let aValue: any, bValue: any

      switch (sortBy) {
        case 'createdAt':
          aValue = new Date(a.createdAt)
          bValue = new Date(b.createdAt)
          break
        case 'weight':
          aValue = a.weight
          bValue = b.weight
          break
        case 'priority':
          aValue = a.priority || 0
          bValue = b.priority || 0
          break
        default:
          aValue = new Date(a.createdAt)
          bValue = new Date(b.createdAt)
      }

      if (sortOrder === 'asc') {
        return aValue < bValue ? -1 : aValue > bValue ? 1 : 0
      } else {
        return aValue > bValue ? -1 : aValue < bValue ? 1 : 0
      }
    })

    return filtered
  }, [orders, searchTerm, sortBy, sortOrder])

  // 计算总重量和总体积
  const totals = useMemo(() => {
    return filteredOrders.reduce((acc, order) => {
      acc.totalWeight += order.weight
      acc.totalVolume += order.volume
      return acc
    }, { totalWeight: 0, totalVolume: 0 })
  }, [filteredOrders])

  // 获取优先级颜色
  const getPriorityColor = (priority: number) => {
    if (priority >= 8) return 'destructive'
    if (priority >= 6) return 'default'
    if (priority >= 4) return 'secondary'
    return 'outline'
  }

  // 获取优先级文本
  const getPriorityText = (priority: number) => {
    if (priority >= 8) return '紧急'
    if (priority >= 6) return '高'
    if (priority >= 4) return '中'
    return '低'
  }

  // 处理订单选择
  const handleOrderSelect = (order: Order) => {
    onOrderSelect(order)
  }

  // 批量选择处理
  const handleOrderCheckboxChange = (orderId: string, checked: boolean) => {
    const newSelected = new Set(selectedOrders)
    if (checked) {
      newSelected.add(orderId)
    } else {
      newSelected.delete(orderId)
    }
    setSelectedOrders(newSelected)
  }

  // 全选/取消全选
  const handleSelectAll = (checked: boolean) => {
    if (checked) {
      const allIds = new Set(filteredOrders.map(order => order.id))
      setSelectedOrders(allIds)
    } else {
      setSelectedOrders(new Set())
    }
  }

  return (
    <Card>
      <CardHeader>
        <CardTitle className="flex items-center justify-between">
          订单池
          <Badge variant="secondary">
            {filteredOrders.length} 个订单
          </Badge>
        </CardTitle>
        <CardDescription>
          待分配的订单 - 总重量: {totals.totalWeight.toFixed(1)}kg, 总体积: {totals.totalVolume.toFixed(2)}m³
        </CardDescription>
      </CardHeader>
      <CardContent className="space-y-4">
        {/* 搜索和排序 */}
        <div className="flex space-x-4">
          <Input
            placeholder="搜索订单号、发货人或收货人..."
            value={searchTerm}
            onChange={(e) => setSearchTerm(e.target.value)}
            className="flex-1"
          />
          <Select value={sortBy} onValueChange={(value: any) => setSortBy(value)}>
            <SelectTrigger className="w-[120px]">
              <SelectValue />
            </SelectTrigger>
            <SelectContent>
              <SelectItem value="createdAt">创建时间</SelectItem>
              <SelectItem value="weight">重量</SelectItem>
              <SelectItem value="priority">优先级</SelectItem>
            </SelectContent>
          </Select>
          <Select value={sortOrder} onValueChange={(value: any) => setSortOrder(value)}>
            <SelectTrigger className="w-[100px]">
              <SelectValue />
            </SelectTrigger>
            <SelectContent>
              <SelectItem value="desc">降序</SelectItem>
              <SelectItem value="asc">升序</SelectItem>
            </SelectContent>
          </Select>
        </div>

        {/* 订单表格 */}
        <div className="border rounded-lg">
          <Table>
            <TableHeader>
              <TableRow>
                <TableHead className="w-[40px]">
                  <input
                    type="checkbox"
                    checked={selectedOrders.size === filteredOrders.length && filteredOrders.length > 0}
                    onChange={(e) => handleSelectAll(e.target.checked)}
                    className="rounded border-gray-300"
                  />
                </TableHead>
                <TableHead>订单号</TableHead>
                <TableHead>发货人</TableHead>
                <TableHead>收货人</TableHead>
                <TableHead>重量</TableHead>
                <TableHead>体积</TableHead>
                <TableHead>优先级</TableHead>
                <TableHead>创建时间</TableHead>
                <TableHead>操作</TableHead>
              </TableRow>
            </TableHeader>
            <TableBody>
              {filteredOrders.map((order) => (
                <TableRow
                  key={order.id}
                  className={cn(
                    "cursor-pointer hover:bg-muted/50",
                    selectedOrders.has(order.id) && "bg-muted/30"
                  )}
                >
                  <TableCell>
                    <input
                      type="checkbox"
                      checked={selectedOrders.has(order.id)}
                      onChange={(e) => handleOrderCheckboxChange(order.id, e.target.checked)}
                      onClick={(e) => e.stopPropagation()}
                      className="rounded border-gray-300"
                    />
                  </TableCell>
                  <TableCell className="font-medium">{order.orderNumber}</TableCell>
                  <TableCell>
                    <div>
                      <div className="font-medium">{order.consignorName}</div>
                      <div className="text-sm text-muted-foreground">{order.consignorPhone}</div>
                    </div>
                  </TableCell>
                  <TableCell>
                    <div>
                      <div className="font-medium">{order.consigneeName}</div>
                      <div className="text-sm text-muted-foreground">{order.consigneePhone}</div>
                    </div>
                  </TableCell>
                  <TableCell>{order.weight.toFixed(1)}kg</TableCell>
                  <TableCell>{order.volume.toFixed(2)}m³</TableCell>
                  <TableCell>
                    <Badge variant={getPriorityColor(order.priority || 0)}>
                      {getPriorityText(order.priority || 0)}
                    </Badge>
                  </TableCell>
                  <TableCell>
                    {format(new Date(order.createdAt), 'MM-dd HH:mm', { locale: zhCN })}
                  </TableCell>
                  <TableCell>
                    <div className="flex space-x-2">
                      <Button
                        variant="outline"
                        size="sm"
                        onClick={(e) => {
                          e.stopPropagation()
                          handleOrderSelect(order)
                        }}
                      >
                        分配
                      </Button>
                      <Button
                        variant="ghost"
                        size="sm"
                        onClick={(e) => {
                          e.stopPropagation()
                          // 查看详情
                        }}
                      >
                        详情
                      </Button>
                    </div>
                  </TableCell>
                </TableRow>
              ))}
            </TableBody>
          </Table>
        </div>

        {/* 批量操作 */}
        {selectedOrders.size > 0 && (
          <div className="flex items-center justify-between p-4 bg-muted rounded-lg">
            <span className="text-sm text-muted-foreground">
              已选择 {selectedOrders.size} 个订单
            </span>
            <div className="flex space-x-2">
              <Button variant="outline" size="sm">
                批量分配
              </Button>
              <Button variant="ghost" size="sm" onClick={() => setSelectedOrders(new Set())}>
                取消选择
              </Button>
            </div>
          </div>
        )}
      </CardContent>
    </Card>
  )
}
```

### 3. 创建车辆列表组件

创建`src/components/dispatch/vehicle-list.tsx`:

```typescript
'use client'

import { useState, useMemo } from 'react'
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'
import { Button } from '@/components/ui/button'
import { Badge } from '@/components/ui/badge'
import { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar'
import { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog'
import { Vehicle, DispatchAssignment } from '@/types/dispatch'

interface VehicleListProps {
  vehicles: Vehicle[]
  assignments: DispatchAssignment[]
  onAssignOrder: (orderId: string, vehicleId: string) => Promise<void>
  onUnassignOrder: (assignmentId: string) => Promise<void>
}

export function VehicleList({ vehicles, assignments, onAssignOrder, onUnassignOrder }: VehicleListProps) {
  const [selectedVehicle, setSelectedVehicle] = useState<Vehicle | null>(null)

  // 获取车辆状态颜色
  const getStatusColor = (status: string) => {
    switch (status) {
      case 'AVAILABLE': return 'default'
      case 'ASSIGNED': return 'secondary'
      case 'IN_TRANSIT': return 'default'
      case 'MAINTENANCE': return 'destructive'
      case 'OFFLINE': return 'outline'
      default: return 'outline'
    }
  }

  // 获取状态文本
  const getStatusText = (status: string) => {
    switch (status) {
      case 'AVAILABLE': return '可用'
      case 'ASSIGNED': return '已分配'
      case 'IN_TRANSIT': return '运输中'
      case 'MAINTENANCE': return '维护中'
      case 'OFFLINE': return '离线'
      default: return status
    }
  }

  // 获取车辆类型文本
  const getVehicleTypeText = (type: string) => {
    switch (type) {
      case 'VAN': return '厢式车'
      case 'TRUCK': return '卡车'
      case 'TRAILER': return '挂车'
      default: return type
    }
  }

  // 获取车辆的分配信息
  const getVehicleAssignments = (vehicleId: string) => {
    return assignments.filter(assignment => assignment.vehicleId === vehicleId)
  }

  // 计算车辆负载
  const calculateVehicleLoad = (vehicleId: string) => {
    const vehicleAssignments = getVehicleAssignments(vehicleId)
    const totalWeight = vehicleAssignments.reduce((sum, assignment) => sum + assignment.order.weight, 0)
    const totalVolume = vehicleAssignments.reduce((sum, assignment) => sum + assignment.order.volume, 0)

    const vehicle = vehicles.find(v => v.id === vehicleId)
    if (!vehicle) return { totalWeight, totalVolume, weightPercent: 0, volumePercent: 0 }

    return {
      totalWeight,
      totalVolume,
      weightPercent: (totalWeight / vehicle.maxWeight) * 100,
      volumePercent: (totalVolume / vehicle.maxVolume) * 100,
    }
  }

  return (
    <Card>
      <CardHeader>
        <CardTitle>可用车辆</CardTitle>
        <CardDescription>
          当前可用的运输车辆资源
        </CardDescription>
      </CardHeader>
      <CardContent>
        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
          {vehicles.map((vehicle) => {
            const assignments = getVehicleAssignments(vehicle.id)
            const load = calculateVehicleLoad(vehicle.id)

            return (
              <Card key={vehicle.id} className="hover:shadow-md transition-shadow">
                <CardContent className="p-4">
                  <div className="flex items-start justify-between mb-4">
                    <div className="flex items-center space-x-3">
                      <Avatar>
                        <AvatarImage src={`/api/placeholder/40/40?text=${vehicle.licensePlate}`} />
                        <AvatarFallback>{vehicle.licensePlate.slice(-2)}</AvatarFallback>
                      </Avatar>
                      <div>
                        <h3 className="font-medium">{vehicle.licensePlate}</h3>
                        <div className="flex items-center space-x-2">
                          <Badge variant={getStatusColor(vehicle.status)}>
                            {getStatusText(vehicle.status)}
                          </Badge>
                          <Badge variant="outline">
                            {getVehicleTypeText(vehicle.type)}
                          </Badge>
                        </div>
                      </div>
                    </div>
                    <Dialog>
                      <DialogTrigger asChild>
                        <Button variant="ghost" size="sm">
                          详情
                        </Button>
                      </DialogTrigger>
                      <DialogContent className="max-w-2xl">
                        <DialogHeader>
                          <DialogTitle>车辆详情 - {vehicle.licensePlate}</DialogTitle>
                        </DialogHeader>
                        <VehicleDetail vehicle={vehicle} assignments={assignments} />
                      </DialogContent>
                    </Dialog>
                  </div>

                  {/* 车辆容量显示 */}
                  <div className="space-y-2 mb-4">
                    <div className="flex justify-between text-sm">
                      <span>载重: {load.totalWeight.toFixed(1)}kg / {vehicle.maxWeight}kg</span>
                      <span>{load.weightPercent.toFixed(0)}%</span>
                    </div>
                    <div className="w-full bg-gray-200 rounded-full h-2">
                      <div
                        className={`h-2 rounded-full ${load.weightPercent > 90 ? 'bg-red-500' : load.weightPercent > 70 ? 'bg-yellow-500' : 'bg-green-500'}`}
                        style={{ width: `${Math.min(load.weightPercent, 100)}%` }}
                      />
                    </div>

                    <div className="flex justify-between text-sm">
                      <span>容积: {load.totalVolume.toFixed(2)}m³ / {vehicle.maxVolume}m³</span>
                      <span>{load.volumePercent.toFixed(0)}%</span>
                    </div>
                    <div className="w-full bg-gray-200 rounded-full h-2">
                      <div
                        className={`h-2 rounded-full ${load.volumePercent > 90 ? 'bg-red-500' : load.volumePercent > 70 ? 'bg-yellow-500' : 'bg-green-500'}`}
                        style={{ width: `${Math.min(load.volumePercent, 100)}%` }}
                      />
                    </div>
                  </div>

                  {/* 司机信息 */}
                  <div className="flex items-center space-x-2 mb-4">
                    <Avatar className="w-6 h-6">
                      <AvatarFallback>{vehicle.driver.name.slice(-1)}</AvatarFallback>
                    </Avatar>
                    <div className="text-sm">
                      <div className="font-medium">{vehicle.driver.name}</div>
                      <div className="text-muted-foreground">{vehicle.driver.phone}</div>
                    </div>
                  </div>

                  {/* 分配的订单 */}
                  {assignments.length > 0 && (
                    <div className="space-y-2">
                      <div className="text-sm font-medium">已分配订单 ({assignments.length})</div>
                      <div className="space-y-1">
                        {assignments.slice(0, 3).map((assignment) => (
                          <div key={assignment.id} className="flex items-center justify-between text-sm bg-muted/50 rounded p-2">
                            <span>{assignment.order.orderNumber}</span>
                            <Button
                              variant="ghost"
                              size="sm"
                              onClick={() => onUnassignOrder(assignment.id)}
                            >
                              取消
                            </Button>
                          </div>
                        ))}
                        {assignments.length > 3 && (
                          <div className="text-center text-sm text-muted-foreground">
                            还有 {assignments.length - 3} 个订单
                          </div>
                        )}
                      </div>
                    </div>
                  )}

                  {/* 操作按钮 */}
                  {vehicle.status === 'AVAILABLE' && (
                    <Button
                      className="w-full mt-4"
                      onClick={() => {
                        setSelectedVehicle(vehicle)
                        // 触发分配流程
                      }}
                    >
                      分配订单
                    </Button>
                  )}
                </CardContent>
              </Card>
            )
          })}
        </div>

        {vehicles.length === 0 && (
          <div className="text-center py-8 text-muted-foreground">
            没有可用的车辆
          </div>
        )}
      </CardContent>
    </Card>
  )
}

// 车辆详情组件
function VehicleDetail({ vehicle, assignments }: { vehicle: Vehicle, assignments: DispatchAssignment[] }) {
  return (
    <div className="space-y-4">
      <div className="grid grid-cols-2 gap-4">
        <div>
          <label className="text-sm font-medium">车牌号</label>
          <div className="text-sm">{vehicle.licensePlate}</div>
        </div>
        <div>
          <label className="text-sm font-medium">车辆类型</label>
          <div className="text-sm">{vehicle.type}</div>
        </div>
        <div>
          <label className="text-sm font-medium">最大载重</label>
          <div className="text-sm">{vehicle.maxWeight}kg</div>
        </div>
        <div>
          <label className="text-sm font-medium">最大容积</label>
          <div className="text-sm">{vehicle.maxVolume}m³</div>
        </div>
        <div>
          <label className="text-sm font-medium">状态</label>
          <div className="text-sm">{vehicle.status}</div>
        </div>
        <div>
          <label className="text-sm font-medium">区域</label>
          <div className="text-sm">{vehicle.region}</div>
        </div>
      </div>

      <div>
        <label className="text-sm font-medium">司机信息</label>
        <div className="mt-2 p-3 bg-muted rounded-lg">
          <div className="flex items-center space-x-3">
            <Avatar>
              <AvatarFallback>{vehicle.driver.name.slice(-1)}</AvatarFallback>
            </Avatar>
            <div>
              <div className="font-medium">{vehicle.driver.name}</div>
              <div className="text-sm text-muted-foreground">{vehicle.driver.phone}</div>
              <div className="text-sm text-muted-foreground">{vehicle.driver.license}</div>
            </div>
          </div>
        </div>
      </div>

      {assignments.length > 0 && (
        <div>
          <label className="text-sm font-medium">当前分配</label>
          <div className="mt-2 space-y-2">
            {assignments.map((assignment) => (
              <div key={assignment.id} className="p-3 bg-muted rounded-lg">
                <div className="flex justify-between items-start">
                  <div>
                    <div className="font-medium">{assignment.order.orderNumber}</div>
                    <div className="text-sm text-muted-foreground">
                      {assignment.order.consignorName} → {assignment.order.consigneeName}
                    </div>
                    <div className="text-sm">
                      重量: {assignment.order.weight}kg, 体积: {assignment.order.volume}m³
                    </div>
                  </div>
                </div>
              </div>
            ))}
          </div>
        </div>
      )}
    </div>
  )
}
```

### 4. 创建路线规划组件

创建`src/components/dispatch/route-planner.tsx`:

```typescript
'use client'

import { useState, useMemo } from 'react'
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'
import { Button } from '@/components/ui/button'
import { Badge } from '@/components/ui/badge'
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs'
import { DispatchAssignment } from '@/types/dispatch'

interface RoutePlannerProps {
  assignments: DispatchAssignment[]
  onUpdateRoute: (assignmentId: string, route: any) => Promise<void>
}

export function RoutePlanner({ assignments, onUpdateRoute }: RoutePlannerProps) {
  const [selectedAssignment, setSelectedAssignment] = useState<DispatchAssignment | null>(null)

  // 按车辆分组
  const groupedByVehicle = useMemo(() => {
    const groups = assignments.reduce((acc, assignment) => {
      if (!acc[assignment.vehicleId]) {
        acc[assignment.vehicleId] = []
      }
      acc[assignment.vehicleId].push(assignment)
      return acc
    }, {} as Record<string, DispatchAssignment[]>)

    return Object.entries(groups).map(([vehicleId, assignments]) => ({
      vehicleId,
      vehicle: assignments[0].vehicle,
      assignments: assignments.sort((a, b) => a.sequence - b.sequence)
    }))
  }, [assignments])

  return (
    <Card>
      <CardHeader>
        <CardTitle>路线规划</CardTitle>
        <CardDescription>
          查看和优化运输路线
        </CardDescription>
      </CardHeader>
      <CardContent>
        <Tabs defaultValue="map" className="w-full">
          <TabsList className="grid w-full grid-cols-2">
            <TabsTrigger value="map">地图视图</TabsTrigger>
            <TabsTrigger value="list">路线列表</TabsTrigger>
          </TabsList>

          <TabsContent value="map">
            <div className="h-96 bg-muted rounded-lg flex items-center justify-center">
              <div className="text-center text-muted-foreground">
                <div className="text-lg font-medium mb-2">地图视图</div>
                <div className="text-sm">显示 {groupedByVehicle.length} 辆车的运输路线</div>
              </div>
            </div>
          </TabsContent>

          <TabsContent value="list">
            <div className="space-y-4">
              {groupedByVehicle.map((group) => (
                <VehicleRoute
                  key={group.vehicleId}
                  vehicle={group.vehicle}
                  assignments={group.assignments}
                  onSelect={setSelectedAssignment}
                />
              ))}
            </div>
          </TabsContent>
        </Tabs>
      </CardContent>
    </Card>
  )
}

// 单个车辆路线组件
function VehicleRoute({ vehicle, assignments, onSelect }: {
  vehicle: any
  assignments: DispatchAssignment[]
  onSelect: (assignment: DispatchAssignment) => void
}) {
  // 计算路线统计
  const routeStats = useMemo(() => {
    const totalWeight = assignments.reduce((sum, a) => sum + a.order.weight, 0)
    const totalVolume = assignments.reduce((sum, a) => sum + a.order.volume, 0)
    const totalDistance = assignments.reduce((sum, a) => sum + (a.route?.distance || 0), 0)
    const estimatedTime = assignments.reduce((sum, a) => sum + (a.route?.estimatedTime || 0), 0)

    return {
      totalWeight,
      totalVolume,
      totalDistance,
      estimatedTime,
      stops: assignments.length
    }
  }, [assignments])

  return (
    <Card>
      <CardHeader>
        <CardTitle className="flex items-center justify-between">
          <span>{vehicle.licensePlate} 路线</span>
          <Badge variant="outline">
            {assignments.length} 个订单
          </Badge>
        </CardTitle>
        <CardDescription>
          司机: {vehicle.driver.name} |
          总重量: {routeStats.totalWeight.toFixed(1)}kg |
          总距离: {routeStats.totalDistance.toFixed(1)}km
        </CardDescription>
      </CardHeader>
      <CardContent>
        <div className="space-y-3">
          {assignments.map((assignment, index) => (
            <div
              key={assignment.id}
              className="flex items-center space-x-4 p-3 bg-muted/50 rounded-lg hover:bg-muted cursor-pointer"
              onClick={() => onSelect(assignment)}
            >
              <div className="flex-shrink-0 w-8 h-8 bg-primary/10 rounded-full flex items-center justify-center">
                <span className="text-sm font-medium">{index + 1}</span>
              </div>

              <div className="flex-1 min-w-0">
                <div className="flex items-center space-x-2">
                  <span className="font-medium">{assignment.order.orderNumber}</span>
                  <Badge variant="outline" className="text-xs">
                    {assignment.order.orderType}
                  </Badge>
                </div>
                <div className="text-sm text-muted-foreground truncate">
                  {assignment.order.consignorAddress} → {assignment.order.consigneeAddress}
                </div>
                <div className="text-xs text-muted-foreground">
                  重量: {assignment.order.weight}kg | 体积: {assignment.order.volume}m³
                </div>
              </div>

              <div className="text-right text-sm">
                {assignment.route?.distance && (
                  <div>{assignment.route.distance.toFixed(1)}km</div>
                )}
                {assignment.route?.estimatedTime && (
                  <div className="text-muted-foreground">{assignment.route.estimatedTime}min</div>
                )}
              </div>
            </div>
          ))}
        </div>

        {/* 路线优化建议 */}
        <div className="mt-4 p-3 bg-blue-50 rounded-lg">
          <div className="text-sm font-medium text-blue-900 mb-2">优化建议</div>
          <ul className="text-sm text-blue-800 space-y-1">
            <li>• 考虑调整第2站和第3站的顺序，可节省约5km</li>
            <li>• 避开高峰时段，预计可节省30分钟</li>
            <li>• 当前负载率为75%，仍有优化空间</li>
          </ul>
        </div>
      </CardContent>
    </Card>
  )
}
```

### 5. 创建调度时间线组件

创建`src/components/dispatch/schedule-timeline.tsx`:

```typescript
'use client'

import { useMemo } from 'react'
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'
import { Badge } from '@/components/ui/badge'
import { DispatchAssignment } from '@/types/dispatch'
import { format, addHours, isWithinInterval, parseISO } from 'date-fns'
import { zhCN } from 'date-fns/locale'

interface ScheduleTimelineProps {
  assignments: DispatchAssignment[]
  selectedDate: string
}

export function ScheduleTimeline({ assignments, selectedDate }: ScheduleTimelineProps) {
  // 生成24小时的时间轴
  const hours = Array.from({ length: 24 }, (_, i) => i)

  // 按时间分组分配
  const scheduledAssignments = useMemo(() => {
    const baseDate = new Date(selectedDate)

    return assignments
      .filter(assignment => {
        if (!assignment.scheduledTime) return false
        const scheduleDate = parseISO(assignment.scheduledTime)
        return scheduleDate.toDateString() === baseDate.toDateString()
      })
      .map(assignment => ({
        ...assignment,
        hour: parseISO(assignment.scheduledTime!).getHours()
      }))
      .sort((a, b) => a.hour - b.hour)
  }, [assignments, selectedDate])

  return (
    <Card>
      <CardHeader>
        <CardTitle>调度时间线</CardTitle>
        <CardDescription>
          {format(new Date(selectedDate), 'yyyy年MM月dd日', { locale: zhCN })} 的车辆调度安排
        </CardDescription>
      </CardHeader>
      <CardContent>
        <div className="space-y-2">
          {hours.map((hour) => {
            const hourAssignments = scheduledAssignments.filter(a => a.hour === hour)

            return (
              <div key={hour} className="flex items-start space-x-4">
                <div className="flex-shrink-0 w-16 text-sm text-muted-foreground">
                  {hour.toString().padStart(2, '0')}:00
                </div>

                <div className="flex-1 min-w-0">
                  {hourAssignments.length > 0 ? (
                    <div className="space-y-2">
                      {hourAssignments.map((assignment) => (
                        <AssignmentCard key={assignment.id} assignment={assignment} />
                      ))}
                    </div>
                  ) : (
                    <div className="h-16 border border-dashed border-muted-foreground/30 rounded-lg flex items-center justify-center">
                      <span className="text-sm text-muted-foreground">空闲</span>
                    </div>
                  )}
                </div>
              </div>
            )
          })}
        </div>
      </CardContent>
    </Card>
  )
}

// 分配卡片组件
function AssignmentCard({ assignment }: { assignment: DispatchAssignment & { hour: number } }) {
  return (
    <div className="p-3 bg-muted rounded-lg border border-border">
      <div className="flex items-center justify-between mb-2">
        <div className="flex items-center space-x-2">
          <Badge variant="outline">
            {assignment.vehicle.licensePlate}
          </Badge>
          <span className="font-medium">{assignment.order.orderNumber}</span>
        </div>
        <div className="text-sm text-muted-foreground">
          {format(parseISO(assignment.scheduledTime!), 'HH:mm')}
        </div>
      </div>

      <div className="text-sm text-muted-foreground">
        {assignment.order.consignorAddress} → {assignment.order.consigneeAddress}
      </div>

      <div className="flex items-center space-x-4 mt-2 text-xs text-muted-foreground">
        <span>重量: {assignment.order.weight}kg</span>
        <span>体积: {assignment.order.volume}m³</span>
        {assignment.route?.estimatedTime && (
          <span>预计: {assignment.route.estimatedTime}分钟</span>
        )}
      </div>
    </div>
  )
}
```

### 6. 创建调度摘要组件

创建`src/components/dispatch/dispatch-summary.tsx`:

```typescript
'use client'

import { useMemo } from 'react'
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'
import { Badge } from '@/components/ui/badge'
import { Order, Vehicle, DispatchAssignment } from '@/types/dispatch'

interface DispatchSummaryProps {
  orders: Order[]
  vehicles: Vehicle[]
  assignments: DispatchAssignment[]
}

export function DispatchSummary({ orders, vehicles, assignments }: DispatchSummaryProps) {
  // 计算统计数据
  const stats = useMemo(() => {
    const totalOrders = orders.length
    const assignedOrders = assignments.length
    const unassignedOrders = totalOrders - assignedOrders
    const assignmentRate = totalOrders > 0 ? (assignedOrders / totalOrders) * 100 : 0

    const availableVehicles = vehicles.filter(v => v.status === 'AVAILABLE').length
    const assignedVehicles = vehicles.filter(v => v.status === 'ASSIGNED').length
    const inTransitVehicles = vehicles.filter(v => v.status === 'IN_TRANSIT').length

    const totalWeight = orders.reduce((sum, order) => sum + order.weight, 0)
    const assignedWeight = assignments.reduce((sum, assignment) => sum + assignment.order.weight, 0)
    const totalVolume = orders.reduce((sum, order) => sum + order.volume, 0)
    const assignedVolume = assignments.reduce((sum, assignment) => sum + assignment.order.volume, 0)

    return {
      totalOrders,
      assignedOrders,
      unassignedOrders,
      assignmentRate,
      availableVehicles,
      assignedVehicles,
      inTransitVehicles,
      totalWeight,
      assignedWeight,
      totalVolume,
      assignedVolume,
    }
  }, [orders, vehicles, assignments])

  // 计算车辆利用率
  const vehicleUtilization = useMemo(() => {
    const activeVehicles = stats.assignedVehicles + stats.inTransitVehicles
    const totalVehicles = vehicles.length
    return totalVehicles > 0 ? (activeVehicles / totalVehicles) * 100 : 0
  }, [vehicles, stats])

  return (
    <Card>
      <CardHeader>
        <CardTitle>调度摘要</CardTitle>
        <CardDescription>
          当前调度状态概览
        </CardDescription>
      </CardHeader>
      <CardContent>
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          {/* 订单分配统计 */}
          <div className="space-y-4">
            <h3 className="text-lg font-medium">订单分配</h3>
            <div className="space-y-2">
              <div className="flex justify-between">
                <span className="text-sm text-muted-foreground">总订单数</span>
                <span className="font-medium">{stats.totalOrders}</span>
              </div>
              <div className="flex justify-between">
                <span className="text-sm text-muted-foreground">已分配</span>
                <span className="font-medium text-green-600">{stats.assignedOrders}</span>
              </div>
              <div className="flex justify-between">
                <span className="text-sm text-muted-foreground">待分配</span>
                <span className="font-medium text-orange-600">{stats.unassignedOrders}</span>
              </div>
              <div className="flex justify-between">
                <span className="text-sm text-muted-foreground">分配率</span>
                <Badge variant={stats.assignmentRate > 80 ? 'default' : 'secondary'}>
                  {stats.assignmentRate.toFixed(1)}%
                </Badge>
              </div>
            </div>
          </div>

          {/* 车辆状态统计 */}
          <div className="space-y-4">
            <h3 className="text-lg font-medium">车辆状态</h3>
            <div className="space-y-2">
              <div className="flex justify-between">
                <span className="text-sm text-muted-foreground">可用</span>
                <span className="font-medium text-green-600">{stats.availableVehicles}</span>
              </div>
              <div className="flex justify-between">
                <span className="text-sm text-muted-foreground">已分配</span>
                <span className="font-medium text-blue-600">{stats.assignedVehicles}</span>
              </div>
              <div className="flex justify-between">
                <span className="text-sm text-muted-foreground">运输中</span>
                <span className="font-medium text-orange-600">{stats.inTransitVehicles}</span>
              </div>
              <div className="flex justify-between">
                <span className="text-sm text-muted-foreground">利用率</span>
                <Badge variant={vehicleUtilization > 70 ? 'default' : 'secondary'}>
                  {vehicleUtilization.toFixed(1)}%
                </Badge>
              </div>
            </div>
          </div>

          {/* 资源利用率 */}
          <div className="space-y-4">
            <h3 className="text-lg font-medium">资源利用</h3>
            <div className="space-y-2">
              <div className="flex justify-between">
                <span className="text-sm text-muted-foreground">重量利用率</span>
                <span className="font-medium">
                  {stats.totalWeight > 0 ? ((stats.assignedWeight / stats.totalWeight) * 100).toFixed(1) : 0}%
                </span>
              </div>
              <div className="flex justify-between">
                <span className="text-sm text-muted-foreground">容积利用率</span>
                <span className="font-medium">
                  {stats.totalVolume > 0 ? ((stats.assignedVolume / stats.totalVolume) * 100).toFixed(1) : 0}%
                </span>
              </div>
              <div className="flex justify-between">
                <span className="text-sm text-muted-foreground">总重量</span>
                <span className="font-medium">{stats.totalWeight.toFixed(1)}kg</span>
              </div>
              <div className="flex justify-between">
                <span className="text-sm text-muted-foreground">总体积</span>
                <span className="font-medium">{stats.totalVolume.toFixed(2)}m³</span>
              </div>
            </div>
          </div>
        </div>

        {/* 建议和提醒 */}
        <div className="mt-6 p-4 bg-blue-50 rounded-lg">
          <h4 className="font-medium text-blue-900 mb-2">调度建议</h4>
          <ul className="text-sm text-blue-800 space-y-1">
            {stats.assignmentRate < 70 && (
              <li>• 订单分配率较低，建议增加车辆调度频次</li>
            )}
            {vehicleUtilization > 85 && (
              <li>• 车辆利用率较高，考虑安排部分车辆维护保养</li>
            )}
            {stats.unassignedOrders > 10 && (
              <li>• 待分配订单较多，建议优化车辆分配策略</li>
            )}
            {stats.availableVehicles < 3 && (
              <li>• 可用车辆较少，建议提前规划车辆调度</li>
            )}
          </ul>
        </div>
      </CardContent>
    </Card>
  )
}
```

### 7. 创建类型定义

创建`src/types/dispatch.ts`:

```typescript
export interface Order {
  id: string
  orderNumber: string
  orderType: string
  status: string
  consignorName: string
  consignorPhone: string
  consignorAddress: string
  consigneeName: string
  consigneePhone: string
  consigneeAddress: string
  goodsName: string
  weight: number
  volume: number
  specialRequirements?: string
  estimatedPrice: number
  priority?: number
  createdAt: string
  updatedAt: string
}

export interface Vehicle {
  id: string
  licensePlate: string
  type: string
  maxWeight: number
  maxVolume: number
  status: string
  region: string
  driver: {
    id: string
    name: string
    phone: string
    license: string
  }
  location?: {
    lat: number
    lng: number
    address: string
  }
  lastMaintenance?: string
  createdAt: string
  updatedAt: string
}

export interface DispatchAssignment {
  id: string
  orderId: string
  vehicleId: string
  driverId: string
  sequence: number
  status: string
  scheduledTime?: string
  actualStartTime?: string
  actualEndTime?: string
  route?: {
    distance: number
    estimatedTime: number
    waypoints: Array<{
      lat: number
      lng: number
      address: string
      type: 'pickup' | 'delivery'
    }>
  }
  order: Order
  vehicle: Vehicle
  createdAt: string
  updatedAt: string
}

export type VehicleType = 'VAN' | 'TRUCK' | 'TRAILER'
export type VehicleStatus = 'AVAILABLE' | 'ASSIGNED' | 'IN_TRANSIT' | 'MAINTENANCE' | 'OFFLINE'
export type DispatchStatus = 'SCHEDULED' | 'IN_PROGRESS' | 'COMPLETED' | 'CANCELLED'
```

### 8. 创建调度页面

创建`src/app/dispatch/page.tsx`:

```typescript
'use client'

import { useState, useEffect } from 'react'
import { DispatchBoard } from '@/components/dispatch/dispatch-board'
import { Order, Vehicle, DispatchAssignment } from '@/types/dispatch'

// 模拟数据
const mockOrders: Order[] = [
  {
    id: '1',
    orderNumber: 'ORD-2024-0001',
    orderType: 'STANDARD',
    status: 'PENDING',
    consignorName: '张三',
    consignorPhone: '13800138001',
    consignorAddress: '北京市朝阳区建国路1号',
    consigneeName: '李四',
    consigneePhone: '13900139001',
    consigneeAddress: '上海市浦东新区世纪大道100号',
    goodsName: '电子产品',
    weight: 50.5,
    volume: 2.5,
    specialRequirements: '易碎品，小心搬运',
    estimatedPrice: 1500.00,
    priority: 7,
    createdAt: '2024-01-15T10:30:00Z',
    updatedAt: '2024-01-15T10:30:00Z',
  },
  {
    id: '2',
    orderNumber: 'ORD-2024-0002',
    orderType: 'EXPRESS',
    status: 'ACCEPTED',
    consignorName: '王五',
    consignorPhone: '13700137001',
    consignorAddress: '广州市天河区天河路123号',
    consigneeName: '赵六',
    consigneePhone: '13600136001',
    consigneeAddress: '深圳市南山区科技园路456号',
    goodsName: '服装',
    weight: 25.0,
    volume: 1.2,
    estimatedPrice: 800.00,
    priority: 5,
    createdAt: '2024-01-14T15:20:00Z',
    updatedAt: '2024-01-14T15:20:00Z',
  },
]

const mockVehicles: Vehicle[] = [
  {
    id: '1',
    licensePlate: '京A12345',
    type: 'VAN',
    maxWeight: 1000,
    maxVolume: 10,
    status: 'AVAILABLE',
    region: 'NORTH',
    driver: {
      id: '1',
      name: '张司机',
      phone: '13812345678',
      license: 'A123456789',
    },
    createdAt: '2024-01-01T00:00:00Z',
    updatedAt: '2024-01-01T00:00:00Z',
  },
  {
    id: '2',
    licensePlate: '沪B67890',
    type: 'TRUCK',
    maxWeight: 5000,
    maxVolume: 30,
    status: 'AVAILABLE',
    region: 'EAST',
    driver: {
      id: '2',
      name: '李司机',
      phone: '13987654321',
      license: 'B987654321',
    },
    createdAt: '2024-01-01T00:00:00Z',
    updatedAt: '2024-01-01T00:00:00Z',
  },
]

const mockAssignments: DispatchAssignment[] = []

export default function DispatchPage() {
  const [orders, setOrders] = useState<Order[]>(mockOrders)
  const [vehicles, setVehicles] = useState<Vehicle[]>(mockVehicles)
  const [assignments, setAssignments] = useState<DispatchAssignment[]>(mockAssignments)
  const [loading, setLoading] = useState(false)

  // 模拟API调用
  const handleAssignOrder = async (orderId: string, vehicleId: string) => {
    setLoading(true)
    try {
      await new Promise(resolve => setTimeout(resolve, 1000))

      const order = orders.find(o => o.id === orderId)
      const vehicle = vehicles.find(v => v.id === vehicleId)

      if (!order || !vehicle) throw new Error('订单或车辆不存在')

      const newAssignment: DispatchAssignment = {
        id: Math.random().toString(36).substr(2, 9),
        orderId,
        vehicleId,
        driverId: vehicle.driver.id,
        sequence: assignments.filter(a => a.vehicleId === vehicleId).length + 1,
        status: 'SCHEDULED',
        order,
        vehicle,
        createdAt: new Date().toISOString(),
        updatedAt: new Date().toISOString(),
      }

      setAssignments([...assignments, newAssignment])

      // 更新车辆状态
      setVehicles(vehicles.map(v =>
        v.id === vehicleId ? { ...v, status: 'ASSIGNED' } : v
      ))

      // 更新订单状态
      setOrders(orders.map(o =>
        o.id === orderId ? { ...o, status: 'IN_TRANSIT' } : o
      ))
    } catch (error) {
      console.error('分配订单失败:', error)
      throw error
    } finally {
      setLoading(false)
    }
  }

  const handleUnassignOrder = async (assignmentId: string) => {
    setLoading(true)
    try {
      await new Promise(resolve => setTimeout(resolve, 500))

      const assignment = assignments.find(a => a.id === assignmentId)
      if (!assignment) throw new Error('分配记录不存在')

      setAssignments(assignments.filter(a => a.id !== assignmentId))

      // 更新车辆状态
      setVehicles(vehicles.map(v =>
        v.id === assignment.vehicleId ? { ...v, status: 'AVAILABLE' } : v
      ))

      // 更新订单状态
      setOrders(orders.map(o =>
        o.id === assignment.orderId ? { ...o, status: 'ACCEPTED' } : o
      ))
    } catch (error) {
      console.error('取消分配失败:', error)
      throw error
    } finally {
      setLoading(false)
    }
  }

  const handleUpdateRoute = async (assignmentId: string, route: any) => {
    setLoading(true)
    try {
      await new Promise(resolve => setTimeout(resolve, 500))

      setAssignments(assignments.map(a =>
        a.id === assignmentId ? { ...a, route, updatedAt: new Date().toISOString() } : a
      ))
    } catch (error) {
      console.error('更新路线失败:', error)
      throw error
    } finally {
      setLoading(false)
    }
  }

  return (
    <div className="container mx-auto py-8">
      <DispatchBoard
        orders={orders}
        vehicles={vehicles}
        assignments={assignments}
        onAssignOrder={handleAssignOrder}
        onUnassignOrder={handleUnassignOrder}
        onUpdateRoute={handleUpdateRoute}
      />
    </div>
  )
}
```

## 验证清单

- [ ] 调度主界面布局正确
- [ ] 订单池功能正常
- [ ] 车辆列表显示完整
- [ ] 订单分配功能正常
- [ ] 路线规划界面可用
- [ ] 时间线显示正确
- [ ] 统计数据计算准确
- [ ] 响应式设计良好

## 测试命令

```bash
# 启动开发服务器
npm run dev

# 运行类型检查
npm run type-check

# 运行测试
npm test

# 检查构建
npm run build
```

## 注意事项

- 确保拖拽功能在移动端也能正常工作
- 优化大数据量时的渲染性能
- 实现实时数据更新和状态同步
- 添加适当的错误处理和用户反馈
- 考虑添加键盘快捷键支持
- 确保无障碍访问支持