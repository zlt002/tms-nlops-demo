---
title: "TMS NL-Opsæ¼”ç¤ºç³»ç»Ÿä»»åŠ¡019: å›å•ç®¡ç†ç•Œé¢å®ç°"
epic: "tms-nlops-demo"
task: "019"
phase: "3"
status: "pending"
priority: "medium"
estimated_hours: 12
parallel: false
depends_on: ["008", "009", "010", "011", "014"]
tags: ["ui", "receipts", "document-management", "upload"]
created: "2025-09-20T04:20:45Z"
updated: "2025-09-20T04:20:45Z"
---

## æ¦‚è¿°

å®ç°TMS NL-Opsæ¼”ç¤ºç³»ç»Ÿçš„å›å•ç®¡ç†ç•Œé¢ï¼ŒåŒ…æ‹¬å›å•ä¸Šä¼ ã€å®¡æ ¸å’ŒæŸ¥çœ‹åŠŸèƒ½ã€‚æä¾›å®Œæ•´çš„ç”µå­å›å•ç®¡ç†æµç¨‹ï¼Œæ”¯æŒå›¾ç‰‡ã€PDFç­‰æ ¼å¼çš„å›å•å¤„ç†ã€‚

## ç›®æ ‡

- åˆ›å»ºå›å•åˆ—è¡¨é¡µé¢ï¼Œæ”¯æŒæœç´¢å’Œç­›é€‰
- å®ç°å›å•ä¸Šä¼ åŠŸèƒ½ï¼Œæ”¯æŒæ‹–æ‹½ä¸Šä¼ 
- å¼€å‘å›å•å®¡æ ¸æµç¨‹ï¼ŒåŒ…æ‹¬å¤šçº§å®¡æ ¸
- æä¾›å›å•è¯¦æƒ…æŸ¥çœ‹å’Œä¸‹è½½åŠŸèƒ½
- å®ç°å›å•çŠ¶æ€ç®¡ç†å’Œæµç¨‹è¿½è¸ª
- æ”¯æŒæ‰¹é‡æ“ä½œå’Œå¯¼å‡ºåŠŸèƒ½

## æŠ€æœ¯æ ˆ

- **æ¡†æ¶**: Next.js 15+ App Router
- **è¯­è¨€**: TypeScript
- **æ ·å¼**: Tailwind CSS + shadcn/ui v2
- **æ–‡ä»¶ä¸Šä¼ **: react-dropzone
- **å›¾ç‰‡å¤„ç†**: html2canvas / sharp
- **çŠ¶æ€ç®¡ç†**: Zustand
- **å›¾è¡¨**: Recharts

## å®æ–½æ­¥éª¤

### 1. åˆ›å»ºå›å•ç®¡ç†ä¸»ç•Œé¢

åˆ›å»º`src/components/receipts/receipt-management.tsx`:

```typescript
'use client'

import { useState, useMemo } from 'react'
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'
import { Button } from '@/components/ui/button'
import { Badge } from '@/components/ui/badge'
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs'
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select'
import { Input } from '@/components/ui/input'
import { ReceiptList } from './receipt-list'
import { ReceiptUpload } from './receipt-upload'
import { ReceiptReview } from './receipt-review'
import { ReceiptAnalytics } from './receipt-analytics'
import { Receipt } from '@/types/receipt'

interface ReceiptManagementProps {
  receipts: Receipt[]
  onReceiptUpload: (data: any) => Promise<void>
  onReceiptUpdate: (id: string, data: Partial<Receipt>) => Promise<void>
  onReceiptDelete: (id: string) => Promise<void>
  onReceiptApprove: (id: string, comments?: string) => Promise<void>
  onReceiptReject: (id: string, reason: string) => Promise<void>
}

export function ReceiptManagement({
  receipts,
  onReceiptUpload,
  onReceiptUpdate,
  onReceiptDelete,
  onReceiptApprove,
  onReceiptReject,
}: ReceiptManagementProps) {
  const [selectedReceiptId, setSelectedReceiptId] = useState<string | null>(null)
  const [showUploadDialog, setShowUploadDialog] = useState(false)
  const [searchTerm, setSearchTerm] = useState('')
  const [statusFilter, setStatusFilter] = useState<string>('all')
  const [dateFilter, setDateFilter] = useState<string>('all')

  // ç­›é€‰å›å•
  const filteredReceipts = useMemo(() => {
    return receipts.filter(receipt => {
      const matchesSearch = receipt.receiptNumber.toLowerCase().includes(searchTerm.toLowerCase()) ||
        receipt.orderNumber.toLowerCase().includes(searchTerm.toLowerCase()) ||
        receipt.customerName.toLowerCase().includes(searchTerm.toLowerCase())

      const matchesStatus = statusFilter === 'all' || receipt.status === statusFilter

      // æ—¥æœŸç­›é€‰é€»è¾‘
      let matchesDate = true
      if (dateFilter !== 'all') {
        const receiptDate = new Date(receipt.uploadTime)
        const now = new Date()

        switch (dateFilter) {
          case 'today':
            matchesDate = receiptDate.toDateString() === now.toDateString()
            break
          case 'week':
            const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000)
            matchesDate = receiptDate >= weekAgo
            break
          case 'month':
            const monthAgo = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000)
            matchesDate = receiptDate >= monthAgo
            break
        }
      }

      return matchesSearch && matchesStatus && matchesDate
    })
  }, [receipts, searchTerm, statusFilter, dateFilter])

  // é€‰ä¸­çš„å›å•
  const selectedReceipt = useMemo(() => {
    return receipts.find(r => r.id === selectedReceiptId)
  }, [receipts, selectedReceiptId])

  // ç»Ÿè®¡æ•°æ®
  const stats = useMemo(() => {
    const total = receipts.length
    const pending = receipts.filter(r => r.status === 'PENDING').length
    const approved = receipts.filter(r => r.status === 'APPROVED').length
    const rejected = receipts.filter(r => r.status === 'REJECTED').length

    return {
      total,
      pending,
      approved,
      rejected,
    }
  }, [receipts])

  // å¤„ç†å›å•é€‰æ‹©
  const handleReceiptSelect = (receiptId: string) => {
    setSelectedReceiptId(receiptId)
  }

  // å¤„ç†å›å•ä¸Šä¼ 
  const handleReceiptUpload = async (data: any) => {
    await onReceiptUpload(data)
    setShowUploadDialog(false)
  }

  return (
    <div className="space-y-6">
      {/* é¡µé¢æ ‡é¢˜å’Œæ“ä½œæ  */}
      <div className="flex justify-between items-center">
        <div>
          <h1 className="text-3xl font-bold tracking-tight">å›å•ç®¡ç†</h1>
          <p className="text-muted-foreground">ç®¡ç†è¿è¾“å›å•çš„ä¸Šä¼ ã€å®¡æ ¸å’Œå­˜æ¡£</p>
        </div>

        <Button onClick={() => setShowUploadDialog(true)}>
          ä¸Šä¼ å›å•
        </Button>
      </div>

      {/* ç»Ÿè®¡å¡ç‰‡ */}
      <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
        <Card>
          <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
            <CardTitle className="text-sm font-medium">æ€»å›å•æ•°</CardTitle>
          </CardHeader>
          <CardContent>
            <div className="text-2xl font-bold">{stats.total}</div>
          </CardContent>
        </Card>

        <Card>
          <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
            <CardTitle className="text-sm font-medium">å¾…å®¡æ ¸</CardTitle>
          </CardHeader>
          <CardContent>
            <div className="text-2xl font-bold text-orange-600">{stats.pending}</div>
          </CardContent>
        </Card>

        <Card>
          <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
            <CardTitle className="text-sm font-medium">å·²é€šè¿‡</CardTitle>
          </CardHeader>
          <CardContent>
            <div className="text-2xl font-bold text-green-600">{stats.approved}</div>
          </CardContent>
        </Card>

        <Card>
          <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
            <CardTitle className="text-sm font-medium">å·²æ‹’ç»</CardTitle>
          </CardHeader>
          <CardContent>
            <div className="text-2xl font-bold text-red-600">{stats.rejected}</div>
          </CardContent>
        </Card>
      </div>

      {/* ä¸»è¦å†…å®¹åŒºåŸŸ */}
      <Tabs defaultValue="list" className="w-full">
        <TabsList className="grid w-full grid-cols-3">
          <TabsTrigger value="list">å›å•åˆ—è¡¨</TabsTrigger>
          <TabsTrigger value="review">å®¡æ ¸é˜Ÿåˆ—</TabsTrigger>
          <TabsTrigger value="analytics">ç»Ÿè®¡åˆ†æ</TabsTrigger>
        </TabsList>

        <TabsContent value="list" className="space-y-6">
          {/* æœç´¢å’Œç­›é€‰ */}
          <Card>
            <CardContent className="pt-6">
              <div className="flex space-x-4">
                <Input
                  placeholder="æœç´¢å›å•å·ã€è®¢å•å·æˆ–å®¢æˆ·åç§°..."
                  value={searchTerm}
                  onChange={(e) => setSearchTerm(e.target.value)}
                  className="flex-1"
                />
                <Select value={statusFilter} onValueChange={setStatusFilter}>
                  <SelectTrigger className="w-[120px]">
                    <SelectValue placeholder="çŠ¶æ€" />
                  </SelectTrigger>
                  <SelectContent>
                    <SelectItem value="all">æ‰€æœ‰çŠ¶æ€</SelectItem>
                    <SelectItem value="PENDING">å¾…å®¡æ ¸</SelectItem>
                    <SelectItem value="APPROVED">å·²é€šè¿‡</SelectItem>
                    <SelectItem value="REJECTED">å·²æ‹’ç»</SelectItem>
                  </SelectContent>
                </Select>
                <Select value={dateFilter} onValueChange={setDateFilter}>
                  <SelectTrigger className="w-[120px]">
                    <SelectValue placeholder="æ—¶é—´" />
                  </SelectTrigger>
                  <SelectContent>
                    <SelectItem value="all">æ‰€æœ‰æ—¶é—´</SelectItem>
                    <SelectItem value="today">ä»Šå¤©</SelectItem>
                    <SelectItem value="week">è¿‘7å¤©</SelectItem>
                    <SelectItem value="month">è¿‘30å¤©</SelectItem>
                  </SelectContent>
                </Select>
              </div>
            </CardContent>
          </Card>

          {/* å›å•åˆ—è¡¨ */}
          <ReceiptList
            receipts={filteredReceipts}
            selectedReceiptId={selectedReceiptId}
            onReceiptSelect={handleReceiptSelect}
            onReceiptUpdate={onReceiptUpdate}
            onReceiptDelete={onReceiptDelete}
            onReceiptApprove={onReceiptApprove}
            onReceiptReject={onReceiptReject}
          />
        </TabsContent>

        <TabsContent value="review">
          <ReceiptReview
            receipts={receipts.filter(r => r.status === 'PENDING')}
            onReceiptApprove={onReceiptApprove}
            onReceiptReject={onReceiptReject}
          />
        </TabsContent>

        <TabsContent value="analytics">
          <ReceiptAnalytics receipts={receipts} />
        </TabsContent>
      </Tabs>

      {/* ä¸Šä¼ å¯¹è¯æ¡† */}
      {showUploadDialog && (
        <ReceiptUpload
          onUpload={handleReceiptUpload}
          onCancel={() => setShowUploadDialog(false)}
        />
      )}

      {/* å›å•è¯¦æƒ… */}
      {selectedReceipt && (
        <ReceiptDetailDialog
          receipt={selectedReceipt}
          onClose={() => setSelectedReceiptId(null)}
          onReceiptUpdate={onReceiptUpdate}
          onReceiptDelete={onReceiptDelete}
          onReceiptApprove={onReceiptApprove}
          onReceiptReject={onReceiptReject}
        />
      )}
    </div>
  )
}
```

### 2. åˆ›å»ºå›å•åˆ—è¡¨ç»„ä»¶

åˆ›å»º`src/components/receipts/receipt-list.tsx`:

```typescript
'use client'

import { useMemo } from 'react'
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'
import { Button } from '@/components/ui/button'
import { Badge } from '@/components/ui/badge'
import { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table'
import { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar'
import { Checkbox } from '@/components/ui/checkbox'
import { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog'
import { Receipt } from '@/types/receipt'
import { format } from 'date-fns'
import { zhCN } from 'date-fns/locale'
import { cn } from '@/lib/utils'

interface ReceiptListProps {
  receipts: Receipt[]
  selectedReceiptId: string | null
  onReceiptSelect: (receiptId: string) => void
  onReceiptUpdate: (id: string, data: Partial<Receipt>) => Promise<void>
  onReceiptDelete: (id: string) => Promise<void>
  onReceiptApprove: (id: string, comments?: string) => Promise<void>
  onReceiptReject: (id: string, reason: string) => Promise<void>
}

export function ReceiptList({
  receipts,
  selectedReceiptId,
  onReceiptSelect,
  onReceiptUpdate,
  onReceiptDelete,
  onReceiptApprove,
  onReceiptReject,
}: ReceiptListProps) {
  const [selectedReceipts, setSelectedReceipts] = useState<Set<string>>(new Set())

  // è·å–çŠ¶æ€æ ·å¼
  const getStatusVariant = (status: string) => {
    switch (status) {
      case 'PENDING': return 'secondary'
      case 'APPROVED': return 'default'
      case 'REJECTED': return 'destructive'
      default: return 'outline'
    }
  }

  // è·å–çŠ¶æ€æ–‡æœ¬
  const getStatusText = (status: string) => {
    switch (status) {
      case 'PENDING': return 'å¾…å®¡æ ¸'
      case 'APPROVED': return 'å·²é€šè¿‡'
      case 'REJECTED': return 'å·²æ‹’ç»'
      default: return status
    }
  }

  // è·å–æ–‡ä»¶ç±»å‹å›¾æ ‡
  const getFileTypeIcon = (fileType: string) => {
    switch (fileType.toLowerCase()) {
      case 'pdf': return 'ğŸ“„'
      case 'jpg':
      case 'jpeg':
      case 'png': return 'ğŸ–¼ï¸'
      case 'doc':
      case 'docx': return 'ğŸ“'
      default: return 'ğŸ“'
    }
  }

  // æ‰¹é‡é€‰æ‹©å¤„ç†
  const handleSelectAll = (checked: boolean) => {
    if (checked) {
      const allIds = new Set(receipts.map(receipt => receipt.id))
      setSelectedReceipts(allIds)
    } else {
      setSelectedReceipts(new Set())
    }
  }

  const handleSelectReceipt = (receiptId: string, checked: boolean) => {
    const newSelected = new Set(selectedReceipts)
    if (checked) {
      newSelected.add(receiptId)
    } else {
      newSelected.delete(receiptId)
    }
    setSelectedReceipts(newSelected)
  }

  // æ‰¹é‡æ“ä½œ
  const handleBatchApprove = async () => {
    for (const receiptId of selectedReceipts) {
      await onReceiptApprove(receiptId)
    }
    setSelectedReceipts(new Set())
  }

  return (
    <Card>
      <CardHeader>
        <CardTitle className="flex items-center justify-between">
          å›å•åˆ—è¡¨
          <Badge variant="secondary">
            {receipts.length} ä¸ªå›å•
          </Badge>
        </CardTitle>
        <CardDescription>
          ç®¡ç†å’Œå®¡æ ¸è¿è¾“å›å•
        </CardDescription>
      </CardHeader>
      <CardContent>
        {/* æ‰¹é‡æ“ä½œæ  */}
        {selectedReceipts.size > 0 && (
          <div className="flex items-center justify-between p-4 bg-muted rounded-lg mb-4">
            <span className="text-sm text-muted-foreground">
              å·²é€‰æ‹© {selectedReceipts.size} ä¸ªå›å•
            </span>
            <div className="flex space-x-2">
              <Button variant="outline" size="sm" onClick={handleBatchApprove}>
                æ‰¹é‡é€šè¿‡
              </Button>
              <Button variant="ghost" size="sm" onClick={() => setSelectedReceipts(new Set())}>
                å–æ¶ˆé€‰æ‹©
              </Button>
            </div>
          </div>
        )}

        <Table>
          <TableHeader>
            <TableRow>
              <TableHead className="w-[40px]">
                <Checkbox
                  checked={selectedReceipts.size === receipts.length && receipts.length > 0}
                  onCheckedChange={handleSelectAll}
                />
              </TableHead>
              <TableHead>å›å•å·</TableHead>
              <TableHead>è®¢å•å·</TableHead>
              <TableHead>å®¢æˆ·</TableHead>
              <TableHead>æ–‡ä»¶</TableHead>
              <TableHead>ä¸Šä¼ æ—¶é—´</TableHead>
              <TableHead>çŠ¶æ€</TableHead>
              <TableHead>å®¡æ ¸äºº</TableHead>
              <TableHead className="text-right">æ“ä½œ</TableHead>
            </TableRow>
          </TableHeader>
          <TableBody>
            {receipts.map((receipt) => (
              <TableRow
                key={receipt.id}
                className={cn(
                  "cursor-pointer hover:bg-muted/50",
                  selectedReceiptId === receipt.id && "bg-muted/30"
                )}
                onClick={() => onReceiptSelect(receipt.id)}
              >
                <TableCell>
                  <Checkbox
                    checked={selectedReceipts.has(receipt.id)}
                    onCheckedChange={(checked) => handleSelectReceipt(receipt.id, checked as boolean)}
                    onClick={(e) => e.stopPropagation()}
                  />
                </TableCell>
                <TableCell className="font-medium">{receipt.receiptNumber}</TableCell>
                <TableCell>{receipt.orderNumber}</TableCell>
                <TableCell>
                  <div className="flex items-center space-x-2">
                    <Avatar className="w-6 h-6">
                      <AvatarFallback>{receipt.customerName.slice(-1)}</AvatarFallback>
                    </Avatar>
                    <span>{receipt.customerName}</span>
                  </div>
                </TableCell>
                <TableCell>
                  <div className="flex items-center space-x-2">
                    <span className="text-lg">{getFileTypeIcon(receipt.fileType)}</span>
                    <span className="text-sm text-muted-foreground">
                      {receipt.fileName}
                    </span>
                  </div>
                </TableCell>
                <TableCell>
                  {format(new Date(receipt.uploadTime), 'yyyy-MM-dd HH:mm', { locale: zhCN })}
                </TableCell>
                <TableCell>
                  <Badge variant={getStatusVariant(receipt.status)}>
                    {getStatusText(receipt.status)}
                  </Badge>
                </TableCell>
                <TableCell>
                  {receipt.reviewerName || '-'}
                </TableCell>
                <TableCell className="text-right">
                  <div className="flex justify-end space-x-2">
                    <Button
                      variant="ghost"
                      size="sm"
                      onClick={(e) => {
                        e.stopPropagation()
                        onReceiptSelect(receipt.id)
                      }}
                    >
                      æŸ¥çœ‹
                    </Button>
                    {receipt.status === 'PENDING' && (
                      <>
                        <Button
                          variant="outline"
                          size="sm"
                          onClick={(e) => {
                            e.stopPropagation()
                            onReceiptApprove(receipt.id)
                          }}
                        >
                          é€šè¿‡
                        </Button>
                        <Button
                          variant="outline"
                          size="sm"
                          onClick={(e) => {
                            e.stopPropagation()
                            onReceiptReject(receipt.id, 'å®¡æ ¸ä¸é€šè¿‡')
                          }}
                        >
                          æ‹’ç»
                        </Button>
                      </>
                    )}
                  </div>
                </TableCell>
              </TableRow>
            ))}
          </TableBody>
        </Table>

        {receipts.length === 0 && (
          <div className="text-center py-8 text-muted-foreground">
            æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„å›å•
          </div>
        )}
      </CardContent>
    </Card>
  )
}
```

### 3. åˆ›å»ºå›å•ä¸Šä¼ ç»„ä»¶

åˆ›å»º`src/components/receipts/receipt-upload.tsx`:

```typescript
'use client'

import { useState, useCallback } from 'react'
import { useDropzone } from 'react-dropzone'
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'
import { Button } from '@/components/ui/button'
import { Input } from '@/components/ui/input'
import { Label } from '@/components/ui/label'
import { Textarea } from '@/components/ui/textarea'
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select'
import { Progress } from '@/components/ui/progress'
import { Badge } from '@/components/ui/badge'
import { Alert, AlertDescription } from '@/components/ui/alert'
import { X, Upload, FileText, Image, File } from 'lucide-react'
import { format } from 'date-fns'
import { zhCN } from 'date-fns/locale'

interface ReceiptUploadProps {
  onUpload: (data: any) => Promise<void>
  onCancel: () => void
}

export function ReceiptUpload({ onUpload, onCancel }: ReceiptUploadProps) {
  const [files, setFiles] = useState<File[]>([])
  const [uploading, setUploading] = useState(false)
  const [uploadProgress, setUploadProgress] = useState(0)
  const [formData, setFormData] = useState({
    orderNumber: '',
    customerName: '',
    receiptType: 'DELIVERY',
    description: '',
    priority: 'NORMAL',
  })
  const [errors, setErrors] = useState<Record<string, string>>({})

  // æ–‡ä»¶æ‹–æ‹½å¤„ç†
  const onDrop = useCallback((acceptedFiles: File[]) => {
    const validFiles = acceptedFiles.filter(file => {
      const maxSize = 10 * 1024 * 1024 // 10MB
      const validTypes = ['image/jpeg', 'image/jpg', 'image/png', 'application/pdf']

      if (file.size > maxSize) {
        setErrors(prev => ({ ...prev, file: 'æ–‡ä»¶å¤§å°ä¸èƒ½è¶…è¿‡10MB' }))
        return false
      }

      if (!validTypes.includes(file.type)) {
        setErrors(prev => ({ ...prev, file: 'åªæ”¯æŒJPGã€PNGã€PDFæ ¼å¼' }))
        return false
      }

      return true
    })

    setFiles(prev => [...prev, ...validFiles])
    setErrors(prev => ({ ...prev, file: '' }))
  }, [])

  const { getRootProps, getInputProps, isDragActive } = useDropzone({
    onDrop,
    accept: {
      'image/*': ['.jpeg', '.jpg', '.png'],
      'application/pdf': ['.pdf']
    },
    multiple: false,
  })

  // ç§»é™¤æ–‡ä»¶
  const removeFile = (index: number) => {
    setFiles(prev => prev.filter((_, i) => i !== index))
  }

  // è¡¨å•å˜æ›´å¤„ç†
  const handleFormChange = (field: string, value: string) => {
    setFormData(prev => ({ ...prev, [field]: value }))
    setErrors(prev => ({ ...prev, [field]: '' }))
  }

  // éªŒè¯è¡¨å•
  const validateForm = () => {
    const newErrors: Record<string, string> = {}

    if (!formData.orderNumber.trim()) {
      newErrors.orderNumber = 'è®¢å•å·ä¸èƒ½ä¸ºç©º'
    }

    if (!formData.customerName.trim()) {
      newErrors.customerName = 'å®¢æˆ·åç§°ä¸èƒ½ä¸ºç©º'
    }

    if (files.length === 0) {
      newErrors.file = 'è¯·é€‰æ‹©è¦ä¸Šä¼ çš„æ–‡ä»¶'
    }

    setErrors(newErrors)
    return Object.keys(newErrors).length === 0
  }

  // ä¸Šä¼ å¤„ç†
  const handleUpload = async () => {
    if (!validateForm()) return

    setUploading(true)
    setUploadProgress(0)

    try {
      // æ¨¡æ‹Ÿä¸Šä¼ è¿›åº¦
      const progressInterval = setInterval(() => {
        setUploadProgress(prev => {
          if (prev >= 90) {
            clearInterval(progressInterval)
            return 90
          }
          return prev + 10
        })
      }, 200)

      const uploadData = {
        ...formData,
        files: files.map(file => ({
          name: file.name,
          size: file.size,
          type: file.type,
          // å®é™…åº”ç”¨ä¸­è¿™é‡Œåº”è¯¥æ˜¯æ–‡ä»¶ä¸Šä¼ åçš„URL
          url: URL.createObjectURL(file),
        })),
        uploadTime: new Date().toISOString(),
      }

      await onUpload(uploadData)

      setUploadProgress(100)
      setTimeout(() => {
        setUploading(false)
        setUploadProgress(0)
        setFiles([])
        setFormData({
          orderNumber: '',
          customerName: '',
          receiptType: 'DELIVERY',
          description: '',
          priority: 'NORMAL',
        })
      }, 500)
    } catch (error) {
      console.error('ä¸Šä¼ å¤±è´¥:', error)
      setUploading(false)
      setUploadProgress(0)
    }
  }

  // è·å–æ–‡ä»¶å›¾æ ‡
  const getFileIcon = (file: File) => {
    if (file.type.startsWith('image/')) {
      return <Image className="w-8 h-8 text-blue-500" />
    } else if (file.type === 'application/pdf') {
      return <FileText className="w-8 h-8 text-red-500" />
    } else {
      return <File className="w-8 h-8 text-gray-500" />
    }
  }

  // æ ¼å¼åŒ–æ–‡ä»¶å¤§å°
  const formatFileSize = (bytes: number) => {
    if (bytes === 0) return '0 Bytes'
    const k = 1024
    const sizes = ['Bytes', 'KB', 'MB', 'GB']
    const i = Math.floor(Math.log(bytes) / Math.log(k))
    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i]
  }

  return (
    <div className="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50">
      <Card className="w-full max-w-2xl max-h-[90vh] overflow-y-auto">
        <CardHeader>
          <div className="flex items-center justify-between">
            <div>
              <CardTitle>ä¸Šä¼ å›å•</CardTitle>
              <CardDescription>ä¸Šä¼ è¿è¾“å›å•æ–‡ä»¶å¹¶å¡«å†™ç›¸å…³ä¿¡æ¯</CardDescription>
            </div>
            <Button variant="ghost" size="sm" onClick={onCancel}>
              <X className="w-4 h-4" />
            </Button>
          </div>
        </CardHeader>

        <CardContent className="space-y-6">
          {/* æ–‡ä»¶ä¸Šä¼ åŒºåŸŸ */}
          <div>
            <Label className="text-sm font-medium">é€‰æ‹©æ–‡ä»¶</Label>
            <div
              {...getRootProps()}
              className={`mt-2 border-2 border-dashed rounded-lg p-8 text-center cursor-pointer transition-colors ${
                isDragActive
                  ? 'border-primary bg-primary/10'
                  : 'border-muted-foreground/25 hover:border-primary/50'
              }`}
            >
              <input {...getInputProps()} />
              <Upload className="w-12 h-12 mx-auto mb-4 text-muted-foreground" />
              {isDragActive ? (
                <p className="text-lg font-medium">æ‹–æ”¾æ–‡ä»¶åˆ°è¿™é‡Œ</p>
              ) : (
                <div>
                  <p className="text-lg font-medium mb-2">æ‹–æ”¾æ–‡ä»¶åˆ°è¿™é‡Œæˆ–ç‚¹å‡»é€‰æ‹©</p>
                  <p className="text-sm text-muted-foreground">
                    æ”¯æŒ JPGã€PNGã€PDF æ ¼å¼ï¼Œæœ€å¤§ 10MB
                  </p>
                </div>
              )}
            </div>

            {errors.file && (
              <Alert className="mt-2">
                <AlertDescription className="text-red-600">
                  {errors.file}
                </AlertDescription>
              </Alert>
            )}

            {/* å·²é€‰æ‹©çš„æ–‡ä»¶åˆ—è¡¨ */}
            {files.length > 0 && (
              <div className="mt-4 space-y-2">
                {files.map((file, index) => (
                  <div key={index} className="flex items-center justify-between p-3 bg-muted rounded-lg">
                    <div className="flex items-center space-x-3">
                      {getFileIcon(file)}
                      <div>
                        <div className="font-medium text-sm">{file.name}</div>
                        <div className="text-xs text-muted-foreground">
                          {formatFileSize(file.size)} â€¢ {file.type}
                        </div>
                      </div>
                    </div>
                    <Button
                      variant="ghost"
                      size="sm"
                      onClick={() => removeFile(index)}
                      disabled={uploading}
                    >
                      <X className="w-4 h-4" />
                    </Button>
                  </div>
                ))}
              </div>
            )}
          </div>

          {/* å›å•ä¿¡æ¯è¡¨å• */}
          <div className="space-y-4">
            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <Label htmlFor="orderNumber">è®¢å•å· *</Label>
                <Input
                  id="orderNumber"
                  value={formData.orderNumber}
                  onChange={(e) => handleFormChange('orderNumber', e.target.value)}
                  placeholder="è¯·è¾“å…¥è®¢å•å·"
                  disabled={uploading}
                />
                {errors.orderNumber && (
                  <p className="text-sm text-red-600 mt-1">{errors.orderNumber}</p>
                )}
              </div>

              <div>
                <Label htmlFor="customerName">å®¢æˆ·åç§° *</Label>
                <Input
                  id="customerName"
                  value={formData.customerName}
                  onChange={(e) => handleFormChange('customerName', e.target.value)}
                  placeholder="è¯·è¾“å…¥å®¢æˆ·åç§°"
                  disabled={uploading}
                />
                {errors.customerName && (
                  <p className="text-sm text-red-600 mt-1">{errors.customerName}</p>
                )}
              </div>
            </div>

            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <Label htmlFor="receiptType">å›å•ç±»å‹</Label>
                <Select value={formData.receiptType} onValueChange={(value) => handleFormChange('receiptType', value)}>
                  <SelectTrigger disabled={uploading}>
                    <SelectValue />
                  </SelectTrigger>
                  <SelectContent>
                    <SelectItem value="DELIVERY">é€è´§å›å•</SelectItem>
                    <SelectItem value="PICKUP">æè´§å›å•</SelectItem>
                    <SelectItem value="TRANSFER">ä¸­è½¬å›å•</SelectItem>
                    <SelectItem value="OTHER">å…¶ä»–</SelectItem>
                  </SelectContent>
                </Select>
              </div>

              <div>
                <Label htmlFor="priority">ä¼˜å…ˆçº§</Label>
                <Select value={formData.priority} onValueChange={(value) => handleFormChange('priority', value)}>
                  <SelectTrigger disabled={uploading}>
                    <SelectValue />
                  </SelectTrigger>
                  <SelectContent>
                    <SelectItem value="HIGH">é«˜</SelectItem>
                    <SelectItem value="NORMAL">æ™®é€š</SelectItem>
                    <SelectItem value="LOW">ä½</SelectItem>
                  </SelectContent>
                </Select>
              </div>
            </div>

            <div>
              <Label htmlFor="description">å¤‡æ³¨è¯´æ˜</Label>
              <Textarea
                id="description"
                value={formData.description}
                onChange={(e) => handleFormChange('description', e.target.value)}
                placeholder="è¯·è¾“å…¥å¤‡æ³¨ä¿¡æ¯..."
                disabled={uploading}
                rows={3}
              />
            </div>
          </div>

          {/* ä¸Šä¼ è¿›åº¦ */}
          {uploading && (
            <div className="space-y-2">
              <div className="flex justify-between text-sm">
                <span>ä¸Šä¼ è¿›åº¦</span>
                <span>{uploadProgress}%</span>
              </div>
              <Progress value={uploadProgress} className="w-full" />
            </div>
          )}

          {/* æ“ä½œæŒ‰é’® */}
          <div className="flex justify-end space-x-4">
            <Button variant="outline" onClick={onCancel} disabled={uploading}>
              å–æ¶ˆ
            </Button>
            <Button onClick={handleUpload} disabled={uploading || files.length === 0}>
              {uploading ? 'ä¸Šä¼ ä¸­...' : 'ä¸Šä¼ å›å•'}
            </Button>
          </div>
        </CardContent>
      </Card>
    </div>
  )
}
```

### 4. åˆ›å»ºå›å•å®¡æ ¸ç»„ä»¶

åˆ›å»º`src/components/receipts/receipt-review.tsx`:

```typescript
'use client'

import { useState } from 'react'
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'
import { Button } from '@/components/ui/button'
import { Badge } from '@/components/ui/badge'
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs'
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select'
import { Textarea } from '@/components/ui/textarea'
import { Receipt } from '@/types/receipt'
import { format } from 'date-fns'
import { zhCN } from 'date-fns/locale'

interface ReceiptReviewProps {
  receipts: Receipt[]
  onReceiptApprove: (id: string, comments?: string) => Promise<void>
  onReceiptReject: (id: string, reason: string) => Promise<void>
}

export function ReceiptReview({ receipts, onReceiptApprove, onReceiptReject }: ReceiptReviewProps) {
  const [currentReviewIndex, setCurrentReviewIndex] = useState(0)
  const [reviewComments, setReviewComments] = useState('')
  const [rejectReason, setRejectReason] = useState('')
  const [actionType, setActionType] = useState<'approve' | 'reject'>('approve')

  const currentReceipt = receipts[currentReviewIndex]
  const totalCount = receipts.length

  // å¤„ç†å®¡æ ¸æ“ä½œ
  const handleReviewAction = async () => {
    if (!currentReceipt) return

    try {
      if (actionType === 'approve') {
        await onReceiptApprove(currentReceipt.id, reviewComments)
      } else {
        if (!rejectReason.trim()) {
          alert('è¯·è¾“å…¥æ‹’ç»åŸå› ')
          return
        }
        await onReceiptReject(currentReceipt.id, rejectReason)
      }

      // ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªå¾…å®¡æ ¸çš„å›å•
      if (currentReviewIndex < receipts.length - 1) {
        setCurrentReviewIndex(currentReviewIndex + 1)
        setReviewComments('')
        setRejectReason('')
      } else {
        // æ‰€æœ‰å›å•å®¡æ ¸å®Œæˆ
        setCurrentReviewIndex(0)
      }
    } catch (error) {
      console.error('å®¡æ ¸æ“ä½œå¤±è´¥:', error)
    }
  }

  // è·³è¿‡å½“å‰å›å•
  const handleSkip = () => {
    if (currentReviewIndex < receipts.length - 1) {
      setCurrentReviewIndex(currentReviewIndex + 1)
      setReviewComments('')
      setRejectReason('')
    }
  }

  if (!currentReceipt) {
    return (
      <Card>
        <CardContent className="flex items-center justify-center h-64">
          <div className="text-center">
            <div className="text-2xl mb-2">âœ…</div>
            <div className="text-lg font-medium">æ²¡æœ‰å¾…å®¡æ ¸çš„å›å•</div>
            <div className="text-sm text-muted-foreground">æ‰€æœ‰å›å•éƒ½å·²å®¡æ ¸å®Œæˆ</div>
          </div>
        </CardContent>
      </Card>
    )
  }

  return (
    <div className="space-y-6">
      {/* å®¡æ ¸è¿›åº¦ */}
      <Card>
        <CardHeader>
          <CardTitle>å®¡æ ¸è¿›åº¦</CardTitle>
          <CardDescription>
            ç¬¬ {currentReviewIndex + 1} / {totalCount} ä¸ªå¾…å®¡æ ¸å›å•
          </CardDescription>
        </CardHeader>
        <CardContent>
          <div className="w-full bg-gray-200 rounded-full h-2">
            <div
              className="bg-blue-600 h-2 rounded-full transition-all duration-300"
              style={{ width: `${((currentReviewIndex + 1) / totalCount) * 100}%` }}
            />
          </div>
        </CardContent>
      </Card>

      <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
        {/* å·¦ä¾§ï¼šå›å•é¢„è§ˆ */}
        <Card>
          <CardHeader>
            <CardTitle>å›å•é¢„è§ˆ</CardTitle>
            <CardDescription>
              å›å•å·: {currentReceipt.receiptNumber}
            </CardDescription>
          </CardHeader>
          <CardContent>
            <div className="space-y-4">
              {/* æ–‡ä»¶é¢„è§ˆ */}
              <div className="border rounded-lg overflow-hidden">
                {currentReceipt.fileType.toLowerCase().includes('image') ? (
                  <img
                    src={currentReceipt.fileUrl}
                    alt={currentReceipt.fileName}
                    className="w-full h-auto max-h-96 object-contain"
                  />
                ) : (
                  <div className="p-8 text-center">
                    <div className="text-4xl mb-2">ğŸ“„</div>
                    <div className="text-sm text-muted-foreground">
                      {currentReceipt.fileName}
                    </div>
                    <Button variant="outline" className="mt-4">
                      ä¸‹è½½æ–‡ä»¶
                    </Button>
                  </div>
                )}
              </div>

              {/* å›å•ä¿¡æ¯ */}
              <div className="grid grid-cols-2 gap-4 text-sm">
                <div>
                  <span className="text-muted-foreground">è®¢å•å·:</span>
                  <div className="font-medium">{currentReceipt.orderNumber}</div>
                </div>
                <div>
                  <span className="text-muted-foreground">å®¢æˆ·:</span>
                  <div className="font-medium">{currentReceipt.customerName}</div>
                </div>
                <div>
                  <span className="text-muted-foreground">ä¸Šä¼ æ—¶é—´:</span>
                  <div className="font-medium">
                    {format(new Date(currentReceipt.uploadTime), 'yyyy-MM-dd HH:mm', { locale: zhCN })}
                  </div>
                </div>
                <div>
                  <span className="text-muted-foreground">æ–‡ä»¶ç±»å‹:</span>
                  <div className="font-medium">{currentReceipt.fileType}</div>
                </div>
              </div>

              {currentReceipt.description && (
                <div>
                  <span className="text-muted-foreground">å¤‡æ³¨:</span>
                  <div className="text-sm mt-1">{currentReceipt.description}</div>
                </div>
              )}
            </div>
          </CardContent>
        </Card>

        {/* å³ä¾§ï¼šå®¡æ ¸æ“ä½œ */}
        <Card>
          <CardHeader>
            <CardTitle>å®¡æ ¸æ“ä½œ</CardTitle>
            <CardDescription>
              å¯¹æ­¤å›å•è¿›è¡Œå®¡æ ¸å¹¶åšå‡ºå†³å®š
            </CardDescription>
          </CardHeader>
          <CardContent className="space-y-6">
            {/* å®¡æ ¸ç±»å‹é€‰æ‹© */}
            <div>
              <label className="text-sm font-medium mb-2 block">å®¡æ ¸å†³å®š</label>
              <div className="flex space-x-4">
                <Button
                  variant={actionType === 'approve' ? 'default' : 'outline'}
                  onClick={() => setActionType('approve')}
                  className="flex-1"
                >
                  âœ… é€šè¿‡
                </Button>
                <Button
                  variant={actionType === 'reject' ? 'default' : 'outline'}
                  onClick={() => setActionType('reject')}
                  className="flex-1"
                >
                  âŒ æ‹’ç»
                </Button>
              </div>
            </div>

            {/* å®¡æ ¸æ„è§ */}
            {actionType === 'approve' ? (
              <div>
                <label className="text-sm font-medium mb-2 block">å®¡æ ¸æ„è§ï¼ˆå¯é€‰ï¼‰</label>
                <Textarea
                  value={reviewComments}
                  onChange={(e) => setReviewComments(e.target.value)}
                  placeholder="è¯·è¾“å…¥å®¡æ ¸æ„è§..."
                  rows={4}
                />
              </div>
            ) : (
              <div>
                <label className="text-sm font-medium mb-2 block">æ‹’ç»åŸå›  *</label>
                <Textarea
                  value={rejectReason}
                  onChange={(e) => setRejectReason(e.target.value)}
                  placeholder="è¯·è¾“å…¥æ‹’ç»åŸå› ..."
                  rows={4}
                />
                <div className="text-xs text-muted-foreground mt-1">
                  è¯·è¯¦ç»†è¯´æ˜æ‹’ç»çš„åŸå› ï¼Œå¸®åŠ©å®¢æˆ·æ”¹è¿›
                </div>
              </div>
            )}

            {/* å®¡æ ¸æ ‡å‡† */}
            <div className="p-4 bg-blue-50 rounded-lg">
              <h4 className="font-medium text-blue-900 mb-2">å®¡æ ¸æ ‡å‡†</h4>
              <ul className="text-sm text-blue-800 space-y-1">
                <li>â€¢ å›å•ä¿¡æ¯æ¸…æ™°å®Œæ•´</li>
                <li>â€¢ ç­¾å­—ç›–ç« é½å…¨æœ‰æ•ˆ</li>
                <li>â€¢ æ—¥æœŸå’Œæ•°é‡å‡†ç¡®æ— è¯¯</li>
                <li>â€¢ æ–‡ä»¶è´¨é‡è‰¯å¥½å¯è¾¨</li>
              </ul>
            </div>

            {/* æ“ä½œæŒ‰é’® */}
            <div className="flex space-x-4">
              <Button variant="outline" onClick={handleSkip} className="flex-1">
                è·³è¿‡
              </Button>
              <Button onClick={handleReviewAction} className="flex-1">
                {actionType === 'approve' ? 'é€šè¿‡' : 'æ‹’ç»'}
              </Button>
            </div>
          </CardContent>
        </Card>
      </div>
    </div>
  )
}
```

### 5. åˆ›å»ºç»Ÿè®¡åˆ†æç»„ä»¶

åˆ›å»º`src/components/receipts/receipt-analytics.tsx`:

```typescript
'use client'

import { useMemo } from 'react'
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'
import { Badge } from '@/components/ui/badge'
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs'
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select'
import { Receipt } from '@/types/receipt'
import { format, subDays, subWeeks, subMonths } from 'date-fns'
import { zhCN } from 'date-fns/locale'

interface ReceiptAnalyticsProps {
  receipts: Receipt[]
}

export function ReceiptAnalytics({ receipts }: ReceiptAnalyticsProps) {
  const [timeRange, setTimeRange] = useState<'week' | 'month' | 'quarter'>('week')

  // åŸºäºæ—¶é—´èŒƒå›´ç­›é€‰æ•°æ®
  const filteredReceipts = useMemo(() => {
    const now = new Date()
    let startDate: Date

    switch (timeRange) {
      case 'week':
        startDate = subWeeks(now, 1)
        break
      case 'month':
        startDate = subMonths(now, 1)
        break
      case 'quarter':
        startDate = subMonths(now, 3)
        break
      default:
        startDate = subWeeks(now, 1)
    }

    return receipts.filter(receipt => new Date(receipt.uploadTime) >= startDate)
  }, [receipts, timeRange])

  // ç»Ÿè®¡æ•°æ®
  const stats = useMemo(() => {
    const total = filteredReceipts.length
    const pending = filteredReceipts.filter(r => r.status === 'PENDING').length
    const approved = filteredReceipts.filter(r => r.status === 'APPROVED').length
    const rejected = filteredReceipts.filter(r => r.status === 'REJECTED').length

    const approvalRate = total > 0 ? (approved / total) * 100 : 0
    const avgProcessingTime = calculateAvgProcessingTime(filteredReceipts)

    return {
      total,
      pending,
      approved,
      rejected,
      approvalRate,
      avgProcessingTime,
    }
  }, [filteredReceipts])

  // æŒ‰ç±»å‹åˆ†ç»„
  const byType = useMemo(() => {
    const groups = filteredReceipts.reduce((acc, receipt) => {
      if (!acc[receipt.receiptType]) {
        acc[receipt.receiptType] = 0
      }
      acc[receipt.receiptType]++
      return acc
    }, {} as Record<string, number>)

    return Object.entries(groups).map(([type, count]) => ({
      type,
      count,
      percentage: stats.total > 0 ? (count / stats.total) * 100 : 0,
    }))
  }, [filteredReceipts, stats.total])

  // æŒ‰å®¢æˆ·åˆ†ç»„
  const byCustomer = useMemo(() => {
    const groups = filteredReceipts.reduce((acc, receipt) => {
      if (!acc[receipt.customerName]) {
        acc[receipt.customerName] = 0
      }
      acc[receipt.customerName]++
      return acc
    }, {} as Record<string, number>)

    return Object.entries(groups)
      .map(([customer, count]) => ({ customer, count }))
      .sort((a, b) => b.count - a.count)
      .slice(0, 10) // å‰10åå®¢æˆ·
  }, [filteredReceipts])

  // æ¯æ—¥è¶‹åŠ¿æ•°æ®
  const dailyTrends = useMemo(() => {
    const days = timeRange === 'week' ? 7 : timeRange === 'month' ? 30 : 90
    const trends = []

    for (let i = days - 1; i >= 0; i--) {
      const date = subDays(new Date(), i)
      const dateStr = format(date, 'yyyy-MM-dd')

      const dayReceipts = filteredReceipts.filter(receipt =>
        format(new Date(receipt.uploadTime), 'yyyy-MM-dd') === dateStr
      )

      trends.push({
        date: dateStr,
        total: dayReceipts.length,
        approved: dayReceipts.filter(r => r.status === 'APPROVED').length,
        rejected: dayReceipts.filter(r => r.status === 'REJECTED').length,
      })
    }

    return trends
  }, [filteredReceipts, timeRange])

  // è®¡ç®—å¹³å‡å¤„ç†æ—¶é—´
  function calculateAvgProcessingTime(receipts: Receipt[]): number {
    const processedReceipts = receipts.filter(r =>
      r.status !== 'PENDING' && r.reviewTime && r.uploadTime
    )

    if (processedReceipts.length === 0) return 0

    const totalTime = processedReceipts.reduce((sum, receipt) => {
      const uploadTime = new Date(receipt.uploadTime).getTime()
      const reviewTime = new Date(receipt.reviewTime!).getTime()
      return sum + (reviewTime - uploadTime)
    }, 0)

    return totalTime / processedReceipts.length / (1000 * 60 * 60) // è½¬æ¢ä¸ºå°æ—¶
  }

  // è·å–å›å•ç±»å‹æ–‡æœ¬
  const getReceiptTypeText = (type: string) => {
    switch (type) {
      case 'DELIVERY': return 'é€è´§å›å•'
      case 'PICKUP': return 'æè´§å›å•'
      case 'TRANSFER': return 'ä¸­è½¬å›å•'
      case 'OTHER': return 'å…¶ä»–'
      default: return type
    }
  }

  return (
    <div className="space-y-6">
      {/* æ—¶é—´èŒƒå›´é€‰æ‹© */}
      <div className="flex justify-between items-center">
        <h3 className="text-lg font-medium">ç»Ÿè®¡åˆ†æ</h3>
        <Select value={timeRange} onValueChange={(value: any) => setTimeRange(value)}>
          <SelectTrigger className="w-[120px]">
            <SelectValue />
          </SelectTrigger>
          <SelectContent>
            <SelectItem value="week">è¿‘ä¸€å‘¨</SelectItem>
            <SelectItem value="month">è¿‘ä¸€æœˆ</SelectItem>
            <SelectItem value="quarter">è¿‘ä¸‰æœˆ</SelectItem>
          </SelectContent>
        </Select>
      </div>

      {/* æ¦‚è§ˆç»Ÿè®¡ */}
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
        <Card>
          <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
            <CardTitle className="text-sm font-medium">æ€»å›å•æ•°</CardTitle>
          </CardHeader>
          <CardContent>
            <div className="text-2xl font-bold">{stats.total}</div>
            <p className="text-xs text-muted-foreground">
              æ—¶é—´èŒƒå›´å†…æ€»æ•°
            </p>
          </CardContent>
        </Card>

        <Card>
          <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
            <CardTitle className="text-sm font-medium">é€šè¿‡ç‡</CardTitle>
          </CardHeader>
          <CardContent>
            <div className="text-2xl font-bold text-green-600">
              {stats.approvalRate.toFixed(1)}%
            </div>
            <p className="text-xs text-muted-foreground">
              {stats.approved} / {stats.total}
            </p>
          </CardContent>
        </Card>

        <Card>
          <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
            <CardTitle className="text-sm font-medium">å¹³å‡å¤„ç†æ—¶é—´</CardTitle>
          </CardHeader>
          <CardContent>
            <div className="text-2xl font-bold text-blue-600">
              {stats.avgProcessingTime.toFixed(1)}h
            </div>
            <p className="text-xs text-muted-foreground">
              ä»ä¸Šä¼ åˆ°å®¡æ ¸å®Œæˆ
            </p>
          </CardContent>
        </Card>

        <Card>
          <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
            <CardTitle className="text-sm font-medium">å¾…å®¡æ ¸</CardTitle>
          </CardHeader>
          <CardContent>
            <div className="text-2xl font-bold text-orange-600">{stats.pending}</div>
            <p className="text-xs text-muted-foreground">
              éœ€è¦å¤„ç†çš„å›å•
            </p>
          </CardContent>
        </Card>
      </div>

      {/* è¯¦ç»†åˆ†æ */}
      <Tabs defaultValue="trends" className="w-full">
        <TabsList className="grid w-full grid-cols-3">
          <TabsTrigger value="trends">è¶‹åŠ¿åˆ†æ</TabsTrigger>
          <TabsTrigger value="types">ç±»å‹åˆ†å¸ƒ</TabsTrigger>
          <TabsTrigger value="customers">å®¢æˆ·åˆ†æ</TabsTrigger>
        </TabsList>

        <TabsContent value="trends">
          <Card>
            <CardHeader>
              <CardTitle>æ¯æ—¥è¶‹åŠ¿</CardTitle>
              <CardDescription>
                å›å•ä¸Šä¼ å’Œå®¡æ ¸çš„æ¯æ—¥è¶‹åŠ¿
              </CardDescription>
            </CardHeader>
            <CardContent>
              <div className="h-64 flex items-center justify-center bg-muted rounded">
                <div className="text-center text-muted-foreground">
                  <div className="text-lg mb-2">ğŸ“Š</div>
                  <div>è¶‹åŠ¿å›¾è¡¨</div>
                  <div className="text-sm">æ˜¾ç¤ºæ¯æ—¥å›å•æ•°é‡è¶‹åŠ¿</div>
                </div>
              </div>
            </CardContent>
          </Card>
        </TabsContent>

        <TabsContent value="types">
          <Card>
            <CardHeader>
              <CardTitle>å›å•ç±»å‹åˆ†å¸ƒ</CardTitle>
              <CardDescription>
                ä¸åŒç±»å‹å›å•çš„æ•°é‡åˆ†å¸ƒ
              </CardDescription>
            </CardHeader>
            <CardContent>
              <div className="space-y-4">
                {byType.map((item) => (
                  <div key={item.type} className="flex items-center justify-between">
                    <div className="flex items-center space-x-3">
                      <span className="font-medium">{getReceiptTypeText(item.type)}</span>
                      <Badge variant="outline">
                        {item.count} ä¸ª
                      </Badge>
                    </div>
                    <div className="flex items-center space-x-3">
                      <div className="w-32 bg-gray-200 rounded-full h-2">
                        <div
                          className="bg-blue-600 h-2 rounded-full"
                          style={{ width: `${item.percentage}%` }}
                        />
                      </div>
                      <span className="text-sm text-muted-foreground w-12">
                        {item.percentage.toFixed(1)}%
                      </span>
                    </div>
                  </div>
                ))}
              </div>
            </CardContent>
          </Card>
        </TabsContent>

        <TabsContent value="customers">
          <Card>
            <CardHeader>
              <CardTitle>å®¢æˆ·åˆ†æ</CardTitle>
              <CardDescription>
                å®¢æˆ·å›å•æäº¤é‡æ’å
              </CardDescription>
            </CardHeader>
            <CardContent>
              <div className="space-y-4">
                {byCustomer.map((customer, index) => (
                  <div key={customer.customer} className="flex items-center justify-between">
                    <div className="flex items-center space-x-3">
                      <div className="w-8 h-8 bg-primary/10 rounded-full flex items-center justify-center text-sm font-medium">
                        {index + 1}
                      </div>
                      <span className="font-medium">{customer.customer}</span>
                    </div>
                    <Badge variant="outline">
                      {customer.count} ä¸ª
                    </Badge>
                  </div>
                ))}
              </div>
            </CardContent>
          </Card>
        </TabsContent>
      </Tabs>
    </div>
  )
}
```

### 6. åˆ›å»ºç±»å‹å®šä¹‰

åˆ›å»º`src/types/receipt.ts`:

```typescript
export interface Receipt {
  id: string
  receiptNumber: string
  orderNumber: string
  customerName: string
  customerId?: string
  receiptType: 'DELIVERY' | 'PICKUP' | 'TRANSFER' | 'OTHER'
  status: 'PENDING' | 'APPROVED' | 'REJECTED'
  fileName: string
  fileType: string
  fileSize: number
  fileUrl: string
  thumbnailUrl?: string
  description?: string
  priority: 'HIGH' | 'NORMAL' | 'LOW'
  uploadBy: string
  uploadTime: string
  reviewerName?: string
  reviewerId?: string
  reviewTime?: string
  reviewComments?: string
  rejectReason?: string
  tags?: string[]
  metadata?: Record<string, any>
}

export interface ReceiptUploadRequest {
  orderNumber: string
  customerName: string
  receiptType: 'DELIVERY' | 'PICKUP' | 'TRANSFER' | 'OTHER'
  description?: string
  priority: 'HIGH' | 'NORMAL' | 'LOW'
  files: Array<{
    name: string
    size: number
    type: string
    url: string
  }>
}

export interface ReceiptReviewRequest {
  status: 'APPROVED' | 'REJECTED'
  comments?: string
  rejectReason?: string
}

export interface ReceiptAnalytics {
  total: number
  pending: number
  approved: number
  rejected: number
  approvalRate: number
  avgProcessingTime: number
  byType: Array<{
    type: string
    count: number
    percentage: number
  }>
  byCustomer: Array<{
    customer: string
    count: number
  }>
  dailyTrends: Array<{
    date: string
    total: number
    approved: number
    rejected: number
  }>
}
```

### 7. åˆ›å»ºå›å•ç®¡ç†é¡µé¢

åˆ›å»º`src/app/receipts/page.tsx`:

```typescript
'use client'

import { useState, useEffect } from 'react'
import { ReceiptManagement } from '@/components/receipts/receipt-management'
import { Receipt } from '@/types/receipt'

// æ¨¡æ‹Ÿæ•°æ®
const mockReceipts: Receipt[] = [
  {
    id: '1',
    receiptNumber: 'RCP-2024-0001',
    orderNumber: 'ORD-2024-0001',
    customerName: 'å¼ ä¸‰',
    customerId: '1',
    receiptType: 'DELIVERY',
    status: 'PENDING',
    fileName: 'delivery_receipt_001.pdf',
    fileType: 'application/pdf',
    fileSize: 1024000,
    fileUrl: '/api/receipts/1',
    description: 'åŒ—äº¬å¸‚æœé˜³åŒºé€è´§å›å•',
    priority: 'NORMAL',
    uploadBy: 'system',
    uploadTime: '2024-01-15T10:30:00Z',
  },
  {
    id: '2',
    receiptNumber: 'RCP-2024-0002',
    orderNumber: 'ORD-2024-0002',
    customerName: 'æå››',
    customerId: '2',
    receiptType: 'PICKUP',
    status: 'APPROVED',
    fileName: 'pickup_receipt_002.jpg',
    fileType: 'image/jpeg',
    fileSize: 2048000,
    fileUrl: '/api/receipts/2',
    thumbnailUrl: '/api/receipts/2/thumb',
    description: 'ä¸Šæµ·å¸‚æµ¦ä¸œæ–°åŒºæè´§å›å•',
    priority: 'HIGH',
    uploadBy: 'system',
    uploadTime: '2024-01-14T15:20:00Z',
    reviewerName: 'å®¡æ ¸å‘˜A',
    reviewerId: '1',
    reviewTime: '2024-01-14T16:00:00Z',
    reviewComments: 'å›å•ä¿¡æ¯å®Œæ•´ï¼Œç­¾å­—æ¸…æ™°',
  },
  {
    id: '3',
    receiptNumber: 'RCP-2024-0003',
    orderNumber: 'ORD-2024-0003',
    customerName: 'ç‹äº”',
    customerId: '3',
    receiptType: 'DELIVERY',
    status: 'REJECTED',
    fileName: 'delivery_receipt_003.pdf',
    fileType: 'application/pdf',
    fileSize: 512000,
    fileUrl: '/api/receipts/3',
    description: 'å¹¿å·å¸‚å¤©æ²³åŒºé€è´§å›å•',
    priority: 'NORMAL',
    uploadBy: 'system',
    uploadTime: '2024-01-13T09:15:00Z',
    reviewerName: 'å®¡æ ¸å‘˜B',
    reviewerId: '2',
    reviewTime: '2024-01-13T10:00:00Z',
    reviewComments: 'ç¼ºå°‘å®¢æˆ·ç­¾å­—ï¼Œè¯·é‡æ–°ä¸Šä¼ ',
    rejectReason: 'å›å•ç¼ºå°‘å¿…è¦çš„ç­¾å­—ä¿¡æ¯',
  },
]

export default function ReceiptsPage() {
  const [receipts, setReceipts] = useState<Receipt[]>(mockReceipts)
  const [loading, setLoading] = useState(false)

  // æ¨¡æ‹ŸAPIè°ƒç”¨
  const handleReceiptUpload = async (data: any) => {
    setLoading(true)
    try {
      await new Promise(resolve => setTimeout(resolve, 1000))

      const newReceipt: Receipt = {
        id: Math.random().toString(36).substr(2, 9),
        receiptNumber: `RCP-${new Date().getFullYear()}-${String(Math.floor(Math.random() * 9999) + 1).padStart(4, '0')}`,
        status: 'PENDING',
        uploadTime: new Date().toISOString(),
        ...data,
      } as Receipt

      setReceipts([newReceipt, ...receipts])
    } catch (error) {
      console.error('ä¸Šä¼ å›å•å¤±è´¥:', error)
      throw error
    } finally {
      setLoading(false)
    }
  }

  const handleReceiptUpdate = async (id: string, data: Partial<Receipt>) => {
    setLoading(true)
    try {
      await new Promise(resolve => setTimeout(resolve, 500))

      setReceipts(receipts.map(receipt =>
        receipt.id === id
          ? { ...receipt, ...data, updatedAt: new Date().toISOString() }
          : receipt
      ))
    } catch (error) {
      console.error('æ›´æ–°å›å•å¤±è´¥:', error)
      throw error
    } finally {
      setLoading(false)
    }
  }

  const handleReceiptDelete = async (id: string) => {
    if (window.confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªå›å•å—ï¼Ÿ')) {
      setLoading(true)
      try {
        await new Promise(resolve => setTimeout(resolve, 500))
        setReceipts(receipts.filter(receipt => receipt.id !== id))
      } catch (error) {
        console.error('åˆ é™¤å›å•å¤±è´¥:', error)
        throw error
      } finally {
        setLoading(false)
      }
    }
  }

  const handleReceiptApprove = async (id: string, comments?: string) => {
    setLoading(true)
    try {
      await new Promise(resolve => setTimeout(resolve, 500))

      setReceipts(receipts.map(receipt =>
        receipt.id === id
          ? {
              ...receipt,
              status: 'APPROVED',
              reviewerName: 'å½“å‰ç”¨æˆ·',
              reviewerId: 'current_user',
              reviewTime: new Date().toISOString(),
              reviewComments: comments,
            }
          : receipt
      ))
    } catch (error) {
      console.error('å®¡æ ¸é€šè¿‡å¤±è´¥:', error)
      throw error
    } finally {
      setLoading(false)
    }
  }

  const handleReceiptReject = async (id: string, reason: string) => {
    setLoading(true)
    try {
      await new Promise(resolve => setTimeout(resolve, 500))

      setReceipts(receipts.map(receipt =>
        receipt.id === id
          ? {
              ...receipt,
              status: 'REJECTED',
              reviewerName: 'å½“å‰ç”¨æˆ·',
              reviewerId: 'current_user',
              reviewTime: new Date().toISOString(),
              rejectReason: reason,
            }
          : receipt
      ))
    } catch (error) {
      console.error('å®¡æ ¸æ‹’ç»å¤±è´¥:', error)
      throw error
    } finally {
      setLoading(false)
    }
  }

  return (
    <div className="container mx-auto py-8">
      <ReceiptManagement
        receipts={receipts}
        onReceiptUpload={handleReceiptUpload}
        onReceiptUpdate={handleReceiptUpdate}
        onReceiptDelete={handleReceiptDelete}
        onReceiptApprove={handleReceiptApprove}
        onReceiptReject={handleReceiptReject}
      />
    </div>
  )
}
```

## éªŒè¯æ¸…å•

- [ ] å›å•åˆ—è¡¨æ˜¾ç¤ºæ­£ç¡®
- [ ] æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½æ­£å¸¸
- [ ] å®¡æ ¸æµç¨‹å®Œæ•´
- [ ] çŠ¶æ€ç®¡ç†æ­£ç¡®
- [ ] æœç´¢ç­›é€‰åŠŸèƒ½æ­£å¸¸
- [ ] æ‰¹é‡æ“ä½œå¯ç”¨
- [ ] ç»Ÿè®¡åˆ†ææ•°æ®å‡†ç¡®
- [ ] å“åº”å¼è®¾è®¡è‰¯å¥½

## æµ‹è¯•å‘½ä»¤

```bash
# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev

# è¿è¡Œç±»å‹æ£€æŸ¥
npm run type-check

# è¿è¡Œæµ‹è¯•
npm test

# æ£€æŸ¥æ„å»º
npm run build
```

## æ³¨æ„äº‹é¡¹

- ç¡®ä¿æ–‡ä»¶ä¸Šä¼ å®‰å…¨æ€§
- ä¼˜åŒ–å¤§æ–‡ä»¶ä¸Šä¼ æ€§èƒ½
- å®ç°å›¾ç‰‡å‹ç¼©å’Œé¢„è§ˆ
- æ·»åŠ æ–‡ä»¶ç±»å‹å’Œå¤§å°éªŒè¯
- å®ç°æ‰¹é‡å¯¼å‡ºåŠŸèƒ½
- ç¡®ä¿ç§»åŠ¨ç«¯æ–‡ä»¶ä¸Šä¼ ä½“éªŒ