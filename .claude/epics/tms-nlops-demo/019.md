---
title: "TMS NL-Ops演示系统任务019: 回单管理界面实现"
epic: "tms-nlops-demo"
task: "019"
phase: "3"
status: "pending"
priority: "medium"
estimated_hours: 12
parallel: false
depends_on: ["008", "009", "010", "011", "014"]
tags: ["ui", "receipts", "document-management", "upload"]
created: "2025-09-20T04:20:45Z"
updated: "2025-09-20T04:20:45Z"
---

## 概述

实现TMS NL-Ops演示系统的回单管理界面，包括回单上传、审核和查看功能。提供完整的电子回单管理流程，支持图片、PDF等格式的回单处理。

## 目标

- 创建回单列表页面，支持搜索和筛选
- 实现回单上传功能，支持拖拽上传
- 开发回单审核流程，包括多级审核
- 提供回单详情查看和下载功能
- 实现回单状态管理和流程追踪
- 支持批量操作和导出功能

## 技术栈

- **框架**: Next.js 15+ App Router
- **语言**: TypeScript
- **样式**: Tailwind CSS + shadcn/ui v2
- **文件上传**: react-dropzone
- **图片处理**: html2canvas / sharp
- **状态管理**: Zustand
- **图表**: Recharts

## 实施步骤

### 1. 创建回单管理主界面

创建`src/components/receipts/receipt-management.tsx`:

```typescript
'use client'

import { useState, useMemo } from 'react'
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'
import { Button } from '@/components/ui/button'
import { Badge } from '@/components/ui/badge'
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs'
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select'
import { Input } from '@/components/ui/input'
import { ReceiptList } from './receipt-list'
import { ReceiptUpload } from './receipt-upload'
import { ReceiptReview } from './receipt-review'
import { ReceiptAnalytics } from './receipt-analytics'
import { Receipt } from '@/types/receipt'

interface ReceiptManagementProps {
  receipts: Receipt[]
  onReceiptUpload: (data: any) => Promise<void>
  onReceiptUpdate: (id: string, data: Partial<Receipt>) => Promise<void>
  onReceiptDelete: (id: string) => Promise<void>
  onReceiptApprove: (id: string, comments?: string) => Promise<void>
  onReceiptReject: (id: string, reason: string) => Promise<void>
}

export function ReceiptManagement({
  receipts,
  onReceiptUpload,
  onReceiptUpdate,
  onReceiptDelete,
  onReceiptApprove,
  onReceiptReject,
}: ReceiptManagementProps) {
  const [selectedReceiptId, setSelectedReceiptId] = useState<string | null>(null)
  const [showUploadDialog, setShowUploadDialog] = useState(false)
  const [searchTerm, setSearchTerm] = useState('')
  const [statusFilter, setStatusFilter] = useState<string>('all')
  const [dateFilter, setDateFilter] = useState<string>('all')

  // 筛选回单
  const filteredReceipts = useMemo(() => {
    return receipts.filter(receipt => {
      const matchesSearch = receipt.receiptNumber.toLowerCase().includes(searchTerm.toLowerCase()) ||
        receipt.orderNumber.toLowerCase().includes(searchTerm.toLowerCase()) ||
        receipt.customerName.toLowerCase().includes(searchTerm.toLowerCase())

      const matchesStatus = statusFilter === 'all' || receipt.status === statusFilter

      // 日期筛选逻辑
      let matchesDate = true
      if (dateFilter !== 'all') {
        const receiptDate = new Date(receipt.uploadTime)
        const now = new Date()

        switch (dateFilter) {
          case 'today':
            matchesDate = receiptDate.toDateString() === now.toDateString()
            break
          case 'week':
            const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000)
            matchesDate = receiptDate >= weekAgo
            break
          case 'month':
            const monthAgo = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000)
            matchesDate = receiptDate >= monthAgo
            break
        }
      }

      return matchesSearch && matchesStatus && matchesDate
    })
  }, [receipts, searchTerm, statusFilter, dateFilter])

  // 选中的回单
  const selectedReceipt = useMemo(() => {
    return receipts.find(r => r.id === selectedReceiptId)
  }, [receipts, selectedReceiptId])

  // 统计数据
  const stats = useMemo(() => {
    const total = receipts.length
    const pending = receipts.filter(r => r.status === 'PENDING').length
    const approved = receipts.filter(r => r.status === 'APPROVED').length
    const rejected = receipts.filter(r => r.status === 'REJECTED').length

    return {
      total,
      pending,
      approved,
      rejected,
    }
  }, [receipts])

  // 处理回单选择
  const handleReceiptSelect = (receiptId: string) => {
    setSelectedReceiptId(receiptId)
  }

  // 处理回单上传
  const handleReceiptUpload = async (data: any) => {
    await onReceiptUpload(data)
    setShowUploadDialog(false)
  }

  return (
    <div className="space-y-6">
      {/* 页面标题和操作栏 */}
      <div className="flex justify-between items-center">
        <div>
          <h1 className="text-3xl font-bold tracking-tight">回单管理</h1>
          <p className="text-muted-foreground">管理运输回单的上传、审核和存档</p>
        </div>

        <Button onClick={() => setShowUploadDialog(true)}>
          上传回单
        </Button>
      </div>

      {/* 统计卡片 */}
      <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
        <Card>
          <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
            <CardTitle className="text-sm font-medium">总回单数</CardTitle>
          </CardHeader>
          <CardContent>
            <div className="text-2xl font-bold">{stats.total}</div>
          </CardContent>
        </Card>

        <Card>
          <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
            <CardTitle className="text-sm font-medium">待审核</CardTitle>
          </CardHeader>
          <CardContent>
            <div className="text-2xl font-bold text-orange-600">{stats.pending}</div>
          </CardContent>
        </Card>

        <Card>
          <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
            <CardTitle className="text-sm font-medium">已通过</CardTitle>
          </CardHeader>
          <CardContent>
            <div className="text-2xl font-bold text-green-600">{stats.approved}</div>
          </CardContent>
        </Card>

        <Card>
          <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
            <CardTitle className="text-sm font-medium">已拒绝</CardTitle>
          </CardHeader>
          <CardContent>
            <div className="text-2xl font-bold text-red-600">{stats.rejected}</div>
          </CardContent>
        </Card>
      </div>

      {/* 主要内容区域 */}
      <Tabs defaultValue="list" className="w-full">
        <TabsList className="grid w-full grid-cols-3">
          <TabsTrigger value="list">回单列表</TabsTrigger>
          <TabsTrigger value="review">审核队列</TabsTrigger>
          <TabsTrigger value="analytics">统计分析</TabsTrigger>
        </TabsList>

        <TabsContent value="list" className="space-y-6">
          {/* 搜索和筛选 */}
          <Card>
            <CardContent className="pt-6">
              <div className="flex space-x-4">
                <Input
                  placeholder="搜索回单号、订单号或客户名称..."
                  value={searchTerm}
                  onChange={(e) => setSearchTerm(e.target.value)}
                  className="flex-1"
                />
                <Select value={statusFilter} onValueChange={setStatusFilter}>
                  <SelectTrigger className="w-[120px]">
                    <SelectValue placeholder="状态" />
                  </SelectTrigger>
                  <SelectContent>
                    <SelectItem value="all">所有状态</SelectItem>
                    <SelectItem value="PENDING">待审核</SelectItem>
                    <SelectItem value="APPROVED">已通过</SelectItem>
                    <SelectItem value="REJECTED">已拒绝</SelectItem>
                  </SelectContent>
                </Select>
                <Select value={dateFilter} onValueChange={setDateFilter}>
                  <SelectTrigger className="w-[120px]">
                    <SelectValue placeholder="时间" />
                  </SelectTrigger>
                  <SelectContent>
                    <SelectItem value="all">所有时间</SelectItem>
                    <SelectItem value="today">今天</SelectItem>
                    <SelectItem value="week">近7天</SelectItem>
                    <SelectItem value="month">近30天</SelectItem>
                  </SelectContent>
                </Select>
              </div>
            </CardContent>
          </Card>

          {/* 回单列表 */}
          <ReceiptList
            receipts={filteredReceipts}
            selectedReceiptId={selectedReceiptId}
            onReceiptSelect={handleReceiptSelect}
            onReceiptUpdate={onReceiptUpdate}
            onReceiptDelete={onReceiptDelete}
            onReceiptApprove={onReceiptApprove}
            onReceiptReject={onReceiptReject}
          />
        </TabsContent>

        <TabsContent value="review">
          <ReceiptReview
            receipts={receipts.filter(r => r.status === 'PENDING')}
            onReceiptApprove={onReceiptApprove}
            onReceiptReject={onReceiptReject}
          />
        </TabsContent>

        <TabsContent value="analytics">
          <ReceiptAnalytics receipts={receipts} />
        </TabsContent>
      </Tabs>

      {/* 上传对话框 */}
      {showUploadDialog && (
        <ReceiptUpload
          onUpload={handleReceiptUpload}
          onCancel={() => setShowUploadDialog(false)}
        />
      )}

      {/* 回单详情 */}
      {selectedReceipt && (
        <ReceiptDetailDialog
          receipt={selectedReceipt}
          onClose={() => setSelectedReceiptId(null)}
          onReceiptUpdate={onReceiptUpdate}
          onReceiptDelete={onReceiptDelete}
          onReceiptApprove={onReceiptApprove}
          onReceiptReject={onReceiptReject}
        />
      )}
    </div>
  )
}
```

### 2. 创建回单列表组件

创建`src/components/receipts/receipt-list.tsx`:

```typescript
'use client'

import { useMemo } from 'react'
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'
import { Button } from '@/components/ui/button'
import { Badge } from '@/components/ui/badge'
import { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table'
import { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar'
import { Checkbox } from '@/components/ui/checkbox'
import { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog'
import { Receipt } from '@/types/receipt'
import { format } from 'date-fns'
import { zhCN } from 'date-fns/locale'
import { cn } from '@/lib/utils'

interface ReceiptListProps {
  receipts: Receipt[]
  selectedReceiptId: string | null
  onReceiptSelect: (receiptId: string) => void
  onReceiptUpdate: (id: string, data: Partial<Receipt>) => Promise<void>
  onReceiptDelete: (id: string) => Promise<void>
  onReceiptApprove: (id: string, comments?: string) => Promise<void>
  onReceiptReject: (id: string, reason: string) => Promise<void>
}

export function ReceiptList({
  receipts,
  selectedReceiptId,
  onReceiptSelect,
  onReceiptUpdate,
  onReceiptDelete,
  onReceiptApprove,
  onReceiptReject,
}: ReceiptListProps) {
  const [selectedReceipts, setSelectedReceipts] = useState<Set<string>>(new Set())

  // 获取状态样式
  const getStatusVariant = (status: string) => {
    switch (status) {
      case 'PENDING': return 'secondary'
      case 'APPROVED': return 'default'
      case 'REJECTED': return 'destructive'
      default: return 'outline'
    }
  }

  // 获取状态文本
  const getStatusText = (status: string) => {
    switch (status) {
      case 'PENDING': return '待审核'
      case 'APPROVED': return '已通过'
      case 'REJECTED': return '已拒绝'
      default: return status
    }
  }

  // 获取文件类型图标
  const getFileTypeIcon = (fileType: string) => {
    switch (fileType.toLowerCase()) {
      case 'pdf': return '📄'
      case 'jpg':
      case 'jpeg':
      case 'png': return '🖼️'
      case 'doc':
      case 'docx': return '📝'
      default: return '📎'
    }
  }

  // 批量选择处理
  const handleSelectAll = (checked: boolean) => {
    if (checked) {
      const allIds = new Set(receipts.map(receipt => receipt.id))
      setSelectedReceipts(allIds)
    } else {
      setSelectedReceipts(new Set())
    }
  }

  const handleSelectReceipt = (receiptId: string, checked: boolean) => {
    const newSelected = new Set(selectedReceipts)
    if (checked) {
      newSelected.add(receiptId)
    } else {
      newSelected.delete(receiptId)
    }
    setSelectedReceipts(newSelected)
  }

  // 批量操作
  const handleBatchApprove = async () => {
    for (const receiptId of selectedReceipts) {
      await onReceiptApprove(receiptId)
    }
    setSelectedReceipts(new Set())
  }

  return (
    <Card>
      <CardHeader>
        <CardTitle className="flex items-center justify-between">
          回单列表
          <Badge variant="secondary">
            {receipts.length} 个回单
          </Badge>
        </CardTitle>
        <CardDescription>
          管理和审核运输回单
        </CardDescription>
      </CardHeader>
      <CardContent>
        {/* 批量操作栏 */}
        {selectedReceipts.size > 0 && (
          <div className="flex items-center justify-between p-4 bg-muted rounded-lg mb-4">
            <span className="text-sm text-muted-foreground">
              已选择 {selectedReceipts.size} 个回单
            </span>
            <div className="flex space-x-2">
              <Button variant="outline" size="sm" onClick={handleBatchApprove}>
                批量通过
              </Button>
              <Button variant="ghost" size="sm" onClick={() => setSelectedReceipts(new Set())}>
                取消选择
              </Button>
            </div>
          </div>
        )}

        <Table>
          <TableHeader>
            <TableRow>
              <TableHead className="w-[40px]">
                <Checkbox
                  checked={selectedReceipts.size === receipts.length && receipts.length > 0}
                  onCheckedChange={handleSelectAll}
                />
              </TableHead>
              <TableHead>回单号</TableHead>
              <TableHead>订单号</TableHead>
              <TableHead>客户</TableHead>
              <TableHead>文件</TableHead>
              <TableHead>上传时间</TableHead>
              <TableHead>状态</TableHead>
              <TableHead>审核人</TableHead>
              <TableHead className="text-right">操作</TableHead>
            </TableRow>
          </TableHeader>
          <TableBody>
            {receipts.map((receipt) => (
              <TableRow
                key={receipt.id}
                className={cn(
                  "cursor-pointer hover:bg-muted/50",
                  selectedReceiptId === receipt.id && "bg-muted/30"
                )}
                onClick={() => onReceiptSelect(receipt.id)}
              >
                <TableCell>
                  <Checkbox
                    checked={selectedReceipts.has(receipt.id)}
                    onCheckedChange={(checked) => handleSelectReceipt(receipt.id, checked as boolean)}
                    onClick={(e) => e.stopPropagation()}
                  />
                </TableCell>
                <TableCell className="font-medium">{receipt.receiptNumber}</TableCell>
                <TableCell>{receipt.orderNumber}</TableCell>
                <TableCell>
                  <div className="flex items-center space-x-2">
                    <Avatar className="w-6 h-6">
                      <AvatarFallback>{receipt.customerName.slice(-1)}</AvatarFallback>
                    </Avatar>
                    <span>{receipt.customerName}</span>
                  </div>
                </TableCell>
                <TableCell>
                  <div className="flex items-center space-x-2">
                    <span className="text-lg">{getFileTypeIcon(receipt.fileType)}</span>
                    <span className="text-sm text-muted-foreground">
                      {receipt.fileName}
                    </span>
                  </div>
                </TableCell>
                <TableCell>
                  {format(new Date(receipt.uploadTime), 'yyyy-MM-dd HH:mm', { locale: zhCN })}
                </TableCell>
                <TableCell>
                  <Badge variant={getStatusVariant(receipt.status)}>
                    {getStatusText(receipt.status)}
                  </Badge>
                </TableCell>
                <TableCell>
                  {receipt.reviewerName || '-'}
                </TableCell>
                <TableCell className="text-right">
                  <div className="flex justify-end space-x-2">
                    <Button
                      variant="ghost"
                      size="sm"
                      onClick={(e) => {
                        e.stopPropagation()
                        onReceiptSelect(receipt.id)
                      }}
                    >
                      查看
                    </Button>
                    {receipt.status === 'PENDING' && (
                      <>
                        <Button
                          variant="outline"
                          size="sm"
                          onClick={(e) => {
                            e.stopPropagation()
                            onReceiptApprove(receipt.id)
                          }}
                        >
                          通过
                        </Button>
                        <Button
                          variant="outline"
                          size="sm"
                          onClick={(e) => {
                            e.stopPropagation()
                            onReceiptReject(receipt.id, '审核不通过')
                          }}
                        >
                          拒绝
                        </Button>
                      </>
                    )}
                  </div>
                </TableCell>
              </TableRow>
            ))}
          </TableBody>
        </Table>

        {receipts.length === 0 && (
          <div className="text-center py-8 text-muted-foreground">
            没有找到匹配的回单
          </div>
        )}
      </CardContent>
    </Card>
  )
}
```

### 3. 创建回单上传组件

创建`src/components/receipts/receipt-upload.tsx`:

```typescript
'use client'

import { useState, useCallback } from 'react'
import { useDropzone } from 'react-dropzone'
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'
import { Button } from '@/components/ui/button'
import { Input } from '@/components/ui/input'
import { Label } from '@/components/ui/label'
import { Textarea } from '@/components/ui/textarea'
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select'
import { Progress } from '@/components/ui/progress'
import { Badge } from '@/components/ui/badge'
import { Alert, AlertDescription } from '@/components/ui/alert'
import { X, Upload, FileText, Image, File } from 'lucide-react'
import { format } from 'date-fns'
import { zhCN } from 'date-fns/locale'

interface ReceiptUploadProps {
  onUpload: (data: any) => Promise<void>
  onCancel: () => void
}

export function ReceiptUpload({ onUpload, onCancel }: ReceiptUploadProps) {
  const [files, setFiles] = useState<File[]>([])
  const [uploading, setUploading] = useState(false)
  const [uploadProgress, setUploadProgress] = useState(0)
  const [formData, setFormData] = useState({
    orderNumber: '',
    customerName: '',
    receiptType: 'DELIVERY',
    description: '',
    priority: 'NORMAL',
  })
  const [errors, setErrors] = useState<Record<string, string>>({})

  // 文件拖拽处理
  const onDrop = useCallback((acceptedFiles: File[]) => {
    const validFiles = acceptedFiles.filter(file => {
      const maxSize = 10 * 1024 * 1024 // 10MB
      const validTypes = ['image/jpeg', 'image/jpg', 'image/png', 'application/pdf']

      if (file.size > maxSize) {
        setErrors(prev => ({ ...prev, file: '文件大小不能超过10MB' }))
        return false
      }

      if (!validTypes.includes(file.type)) {
        setErrors(prev => ({ ...prev, file: '只支持JPG、PNG、PDF格式' }))
        return false
      }

      return true
    })

    setFiles(prev => [...prev, ...validFiles])
    setErrors(prev => ({ ...prev, file: '' }))
  }, [])

  const { getRootProps, getInputProps, isDragActive } = useDropzone({
    onDrop,
    accept: {
      'image/*': ['.jpeg', '.jpg', '.png'],
      'application/pdf': ['.pdf']
    },
    multiple: false,
  })

  // 移除文件
  const removeFile = (index: number) => {
    setFiles(prev => prev.filter((_, i) => i !== index))
  }

  // 表单变更处理
  const handleFormChange = (field: string, value: string) => {
    setFormData(prev => ({ ...prev, [field]: value }))
    setErrors(prev => ({ ...prev, [field]: '' }))
  }

  // 验证表单
  const validateForm = () => {
    const newErrors: Record<string, string> = {}

    if (!formData.orderNumber.trim()) {
      newErrors.orderNumber = '订单号不能为空'
    }

    if (!formData.customerName.trim()) {
      newErrors.customerName = '客户名称不能为空'
    }

    if (files.length === 0) {
      newErrors.file = '请选择要上传的文件'
    }

    setErrors(newErrors)
    return Object.keys(newErrors).length === 0
  }

  // 上传处理
  const handleUpload = async () => {
    if (!validateForm()) return

    setUploading(true)
    setUploadProgress(0)

    try {
      // 模拟上传进度
      const progressInterval = setInterval(() => {
        setUploadProgress(prev => {
          if (prev >= 90) {
            clearInterval(progressInterval)
            return 90
          }
          return prev + 10
        })
      }, 200)

      const uploadData = {
        ...formData,
        files: files.map(file => ({
          name: file.name,
          size: file.size,
          type: file.type,
          // 实际应用中这里应该是文件上传后的URL
          url: URL.createObjectURL(file),
        })),
        uploadTime: new Date().toISOString(),
      }

      await onUpload(uploadData)

      setUploadProgress(100)
      setTimeout(() => {
        setUploading(false)
        setUploadProgress(0)
        setFiles([])
        setFormData({
          orderNumber: '',
          customerName: '',
          receiptType: 'DELIVERY',
          description: '',
          priority: 'NORMAL',
        })
      }, 500)
    } catch (error) {
      console.error('上传失败:', error)
      setUploading(false)
      setUploadProgress(0)
    }
  }

  // 获取文件图标
  const getFileIcon = (file: File) => {
    if (file.type.startsWith('image/')) {
      return <Image className="w-8 h-8 text-blue-500" />
    } else if (file.type === 'application/pdf') {
      return <FileText className="w-8 h-8 text-red-500" />
    } else {
      return <File className="w-8 h-8 text-gray-500" />
    }
  }

  // 格式化文件大小
  const formatFileSize = (bytes: number) => {
    if (bytes === 0) return '0 Bytes'
    const k = 1024
    const sizes = ['Bytes', 'KB', 'MB', 'GB']
    const i = Math.floor(Math.log(bytes) / Math.log(k))
    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i]
  }

  return (
    <div className="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50">
      <Card className="w-full max-w-2xl max-h-[90vh] overflow-y-auto">
        <CardHeader>
          <div className="flex items-center justify-between">
            <div>
              <CardTitle>上传回单</CardTitle>
              <CardDescription>上传运输回单文件并填写相关信息</CardDescription>
            </div>
            <Button variant="ghost" size="sm" onClick={onCancel}>
              <X className="w-4 h-4" />
            </Button>
          </div>
        </CardHeader>

        <CardContent className="space-y-6">
          {/* 文件上传区域 */}
          <div>
            <Label className="text-sm font-medium">选择文件</Label>
            <div
              {...getRootProps()}
              className={`mt-2 border-2 border-dashed rounded-lg p-8 text-center cursor-pointer transition-colors ${
                isDragActive
                  ? 'border-primary bg-primary/10'
                  : 'border-muted-foreground/25 hover:border-primary/50'
              }`}
            >
              <input {...getInputProps()} />
              <Upload className="w-12 h-12 mx-auto mb-4 text-muted-foreground" />
              {isDragActive ? (
                <p className="text-lg font-medium">拖放文件到这里</p>
              ) : (
                <div>
                  <p className="text-lg font-medium mb-2">拖放文件到这里或点击选择</p>
                  <p className="text-sm text-muted-foreground">
                    支持 JPG、PNG、PDF 格式，最大 10MB
                  </p>
                </div>
              )}
            </div>

            {errors.file && (
              <Alert className="mt-2">
                <AlertDescription className="text-red-600">
                  {errors.file}
                </AlertDescription>
              </Alert>
            )}

            {/* 已选择的文件列表 */}
            {files.length > 0 && (
              <div className="mt-4 space-y-2">
                {files.map((file, index) => (
                  <div key={index} className="flex items-center justify-between p-3 bg-muted rounded-lg">
                    <div className="flex items-center space-x-3">
                      {getFileIcon(file)}
                      <div>
                        <div className="font-medium text-sm">{file.name}</div>
                        <div className="text-xs text-muted-foreground">
                          {formatFileSize(file.size)} • {file.type}
                        </div>
                      </div>
                    </div>
                    <Button
                      variant="ghost"
                      size="sm"
                      onClick={() => removeFile(index)}
                      disabled={uploading}
                    >
                      <X className="w-4 h-4" />
                    </Button>
                  </div>
                ))}
              </div>
            )}
          </div>

          {/* 回单信息表单 */}
          <div className="space-y-4">
            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <Label htmlFor="orderNumber">订单号 *</Label>
                <Input
                  id="orderNumber"
                  value={formData.orderNumber}
                  onChange={(e) => handleFormChange('orderNumber', e.target.value)}
                  placeholder="请输入订单号"
                  disabled={uploading}
                />
                {errors.orderNumber && (
                  <p className="text-sm text-red-600 mt-1">{errors.orderNumber}</p>
                )}
              </div>

              <div>
                <Label htmlFor="customerName">客户名称 *</Label>
                <Input
                  id="customerName"
                  value={formData.customerName}
                  onChange={(e) => handleFormChange('customerName', e.target.value)}
                  placeholder="请输入客户名称"
                  disabled={uploading}
                />
                {errors.customerName && (
                  <p className="text-sm text-red-600 mt-1">{errors.customerName}</p>
                )}
              </div>
            </div>

            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <Label htmlFor="receiptType">回单类型</Label>
                <Select value={formData.receiptType} onValueChange={(value) => handleFormChange('receiptType', value)}>
                  <SelectTrigger disabled={uploading}>
                    <SelectValue />
                  </SelectTrigger>
                  <SelectContent>
                    <SelectItem value="DELIVERY">送货回单</SelectItem>
                    <SelectItem value="PICKUP">提货回单</SelectItem>
                    <SelectItem value="TRANSFER">中转回单</SelectItem>
                    <SelectItem value="OTHER">其他</SelectItem>
                  </SelectContent>
                </Select>
              </div>

              <div>
                <Label htmlFor="priority">优先级</Label>
                <Select value={formData.priority} onValueChange={(value) => handleFormChange('priority', value)}>
                  <SelectTrigger disabled={uploading}>
                    <SelectValue />
                  </SelectTrigger>
                  <SelectContent>
                    <SelectItem value="HIGH">高</SelectItem>
                    <SelectItem value="NORMAL">普通</SelectItem>
                    <SelectItem value="LOW">低</SelectItem>
                  </SelectContent>
                </Select>
              </div>
            </div>

            <div>
              <Label htmlFor="description">备注说明</Label>
              <Textarea
                id="description"
                value={formData.description}
                onChange={(e) => handleFormChange('description', e.target.value)}
                placeholder="请输入备注信息..."
                disabled={uploading}
                rows={3}
              />
            </div>
          </div>

          {/* 上传进度 */}
          {uploading && (
            <div className="space-y-2">
              <div className="flex justify-between text-sm">
                <span>上传进度</span>
                <span>{uploadProgress}%</span>
              </div>
              <Progress value={uploadProgress} className="w-full" />
            </div>
          )}

          {/* 操作按钮 */}
          <div className="flex justify-end space-x-4">
            <Button variant="outline" onClick={onCancel} disabled={uploading}>
              取消
            </Button>
            <Button onClick={handleUpload} disabled={uploading || files.length === 0}>
              {uploading ? '上传中...' : '上传回单'}
            </Button>
          </div>
        </CardContent>
      </Card>
    </div>
  )
}
```

### 4. 创建回单审核组件

创建`src/components/receipts/receipt-review.tsx`:

```typescript
'use client'

import { useState } from 'react'
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'
import { Button } from '@/components/ui/button'
import { Badge } from '@/components/ui/badge'
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs'
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select'
import { Textarea } from '@/components/ui/textarea'
import { Receipt } from '@/types/receipt'
import { format } from 'date-fns'
import { zhCN } from 'date-fns/locale'

interface ReceiptReviewProps {
  receipts: Receipt[]
  onReceiptApprove: (id: string, comments?: string) => Promise<void>
  onReceiptReject: (id: string, reason: string) => Promise<void>
}

export function ReceiptReview({ receipts, onReceiptApprove, onReceiptReject }: ReceiptReviewProps) {
  const [currentReviewIndex, setCurrentReviewIndex] = useState(0)
  const [reviewComments, setReviewComments] = useState('')
  const [rejectReason, setRejectReason] = useState('')
  const [actionType, setActionType] = useState<'approve' | 'reject'>('approve')

  const currentReceipt = receipts[currentReviewIndex]
  const totalCount = receipts.length

  // 处理审核操作
  const handleReviewAction = async () => {
    if (!currentReceipt) return

    try {
      if (actionType === 'approve') {
        await onReceiptApprove(currentReceipt.id, reviewComments)
      } else {
        if (!rejectReason.trim()) {
          alert('请输入拒绝原因')
          return
        }
        await onReceiptReject(currentReceipt.id, rejectReason)
      }

      // 移动到下一个待审核的回单
      if (currentReviewIndex < receipts.length - 1) {
        setCurrentReviewIndex(currentReviewIndex + 1)
        setReviewComments('')
        setRejectReason('')
      } else {
        // 所有回单审核完成
        setCurrentReviewIndex(0)
      }
    } catch (error) {
      console.error('审核操作失败:', error)
    }
  }

  // 跳过当前回单
  const handleSkip = () => {
    if (currentReviewIndex < receipts.length - 1) {
      setCurrentReviewIndex(currentReviewIndex + 1)
      setReviewComments('')
      setRejectReason('')
    }
  }

  if (!currentReceipt) {
    return (
      <Card>
        <CardContent className="flex items-center justify-center h-64">
          <div className="text-center">
            <div className="text-2xl mb-2">✅</div>
            <div className="text-lg font-medium">没有待审核的回单</div>
            <div className="text-sm text-muted-foreground">所有回单都已审核完成</div>
          </div>
        </CardContent>
      </Card>
    )
  }

  return (
    <div className="space-y-6">
      {/* 审核进度 */}
      <Card>
        <CardHeader>
          <CardTitle>审核进度</CardTitle>
          <CardDescription>
            第 {currentReviewIndex + 1} / {totalCount} 个待审核回单
          </CardDescription>
        </CardHeader>
        <CardContent>
          <div className="w-full bg-gray-200 rounded-full h-2">
            <div
              className="bg-blue-600 h-2 rounded-full transition-all duration-300"
              style={{ width: `${((currentReviewIndex + 1) / totalCount) * 100}%` }}
            />
          </div>
        </CardContent>
      </Card>

      <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
        {/* 左侧：回单预览 */}
        <Card>
          <CardHeader>
            <CardTitle>回单预览</CardTitle>
            <CardDescription>
              回单号: {currentReceipt.receiptNumber}
            </CardDescription>
          </CardHeader>
          <CardContent>
            <div className="space-y-4">
              {/* 文件预览 */}
              <div className="border rounded-lg overflow-hidden">
                {currentReceipt.fileType.toLowerCase().includes('image') ? (
                  <img
                    src={currentReceipt.fileUrl}
                    alt={currentReceipt.fileName}
                    className="w-full h-auto max-h-96 object-contain"
                  />
                ) : (
                  <div className="p-8 text-center">
                    <div className="text-4xl mb-2">📄</div>
                    <div className="text-sm text-muted-foreground">
                      {currentReceipt.fileName}
                    </div>
                    <Button variant="outline" className="mt-4">
                      下载文件
                    </Button>
                  </div>
                )}
              </div>

              {/* 回单信息 */}
              <div className="grid grid-cols-2 gap-4 text-sm">
                <div>
                  <span className="text-muted-foreground">订单号:</span>
                  <div className="font-medium">{currentReceipt.orderNumber}</div>
                </div>
                <div>
                  <span className="text-muted-foreground">客户:</span>
                  <div className="font-medium">{currentReceipt.customerName}</div>
                </div>
                <div>
                  <span className="text-muted-foreground">上传时间:</span>
                  <div className="font-medium">
                    {format(new Date(currentReceipt.uploadTime), 'yyyy-MM-dd HH:mm', { locale: zhCN })}
                  </div>
                </div>
                <div>
                  <span className="text-muted-foreground">文件类型:</span>
                  <div className="font-medium">{currentReceipt.fileType}</div>
                </div>
              </div>

              {currentReceipt.description && (
                <div>
                  <span className="text-muted-foreground">备注:</span>
                  <div className="text-sm mt-1">{currentReceipt.description}</div>
                </div>
              )}
            </div>
          </CardContent>
        </Card>

        {/* 右侧：审核操作 */}
        <Card>
          <CardHeader>
            <CardTitle>审核操作</CardTitle>
            <CardDescription>
              对此回单进行审核并做出决定
            </CardDescription>
          </CardHeader>
          <CardContent className="space-y-6">
            {/* 审核类型选择 */}
            <div>
              <label className="text-sm font-medium mb-2 block">审核决定</label>
              <div className="flex space-x-4">
                <Button
                  variant={actionType === 'approve' ? 'default' : 'outline'}
                  onClick={() => setActionType('approve')}
                  className="flex-1"
                >
                  ✅ 通过
                </Button>
                <Button
                  variant={actionType === 'reject' ? 'default' : 'outline'}
                  onClick={() => setActionType('reject')}
                  className="flex-1"
                >
                  ❌ 拒绝
                </Button>
              </div>
            </div>

            {/* 审核意见 */}
            {actionType === 'approve' ? (
              <div>
                <label className="text-sm font-medium mb-2 block">审核意见（可选）</label>
                <Textarea
                  value={reviewComments}
                  onChange={(e) => setReviewComments(e.target.value)}
                  placeholder="请输入审核意见..."
                  rows={4}
                />
              </div>
            ) : (
              <div>
                <label className="text-sm font-medium mb-2 block">拒绝原因 *</label>
                <Textarea
                  value={rejectReason}
                  onChange={(e) => setRejectReason(e.target.value)}
                  placeholder="请输入拒绝原因..."
                  rows={4}
                />
                <div className="text-xs text-muted-foreground mt-1">
                  请详细说明拒绝的原因，帮助客户改进
                </div>
              </div>
            )}

            {/* 审核标准 */}
            <div className="p-4 bg-blue-50 rounded-lg">
              <h4 className="font-medium text-blue-900 mb-2">审核标准</h4>
              <ul className="text-sm text-blue-800 space-y-1">
                <li>• 回单信息清晰完整</li>
                <li>• 签字盖章齐全有效</li>
                <li>• 日期和数量准确无误</li>
                <li>• 文件质量良好可辨</li>
              </ul>
            </div>

            {/* 操作按钮 */}
            <div className="flex space-x-4">
              <Button variant="outline" onClick={handleSkip} className="flex-1">
                跳过
              </Button>
              <Button onClick={handleReviewAction} className="flex-1">
                {actionType === 'approve' ? '通过' : '拒绝'}
              </Button>
            </div>
          </CardContent>
        </Card>
      </div>
    </div>
  )
}
```

### 5. 创建统计分析组件

创建`src/components/receipts/receipt-analytics.tsx`:

```typescript
'use client'

import { useMemo } from 'react'
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'
import { Badge } from '@/components/ui/badge'
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs'
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select'
import { Receipt } from '@/types/receipt'
import { format, subDays, subWeeks, subMonths } from 'date-fns'
import { zhCN } from 'date-fns/locale'

interface ReceiptAnalyticsProps {
  receipts: Receipt[]
}

export function ReceiptAnalytics({ receipts }: ReceiptAnalyticsProps) {
  const [timeRange, setTimeRange] = useState<'week' | 'month' | 'quarter'>('week')

  // 基于时间范围筛选数据
  const filteredReceipts = useMemo(() => {
    const now = new Date()
    let startDate: Date

    switch (timeRange) {
      case 'week':
        startDate = subWeeks(now, 1)
        break
      case 'month':
        startDate = subMonths(now, 1)
        break
      case 'quarter':
        startDate = subMonths(now, 3)
        break
      default:
        startDate = subWeeks(now, 1)
    }

    return receipts.filter(receipt => new Date(receipt.uploadTime) >= startDate)
  }, [receipts, timeRange])

  // 统计数据
  const stats = useMemo(() => {
    const total = filteredReceipts.length
    const pending = filteredReceipts.filter(r => r.status === 'PENDING').length
    const approved = filteredReceipts.filter(r => r.status === 'APPROVED').length
    const rejected = filteredReceipts.filter(r => r.status === 'REJECTED').length

    const approvalRate = total > 0 ? (approved / total) * 100 : 0
    const avgProcessingTime = calculateAvgProcessingTime(filteredReceipts)

    return {
      total,
      pending,
      approved,
      rejected,
      approvalRate,
      avgProcessingTime,
    }
  }, [filteredReceipts])

  // 按类型分组
  const byType = useMemo(() => {
    const groups = filteredReceipts.reduce((acc, receipt) => {
      if (!acc[receipt.receiptType]) {
        acc[receipt.receiptType] = 0
      }
      acc[receipt.receiptType]++
      return acc
    }, {} as Record<string, number>)

    return Object.entries(groups).map(([type, count]) => ({
      type,
      count,
      percentage: stats.total > 0 ? (count / stats.total) * 100 : 0,
    }))
  }, [filteredReceipts, stats.total])

  // 按客户分组
  const byCustomer = useMemo(() => {
    const groups = filteredReceipts.reduce((acc, receipt) => {
      if (!acc[receipt.customerName]) {
        acc[receipt.customerName] = 0
      }
      acc[receipt.customerName]++
      return acc
    }, {} as Record<string, number>)

    return Object.entries(groups)
      .map(([customer, count]) => ({ customer, count }))
      .sort((a, b) => b.count - a.count)
      .slice(0, 10) // 前10名客户
  }, [filteredReceipts])

  // 每日趋势数据
  const dailyTrends = useMemo(() => {
    const days = timeRange === 'week' ? 7 : timeRange === 'month' ? 30 : 90
    const trends = []

    for (let i = days - 1; i >= 0; i--) {
      const date = subDays(new Date(), i)
      const dateStr = format(date, 'yyyy-MM-dd')

      const dayReceipts = filteredReceipts.filter(receipt =>
        format(new Date(receipt.uploadTime), 'yyyy-MM-dd') === dateStr
      )

      trends.push({
        date: dateStr,
        total: dayReceipts.length,
        approved: dayReceipts.filter(r => r.status === 'APPROVED').length,
        rejected: dayReceipts.filter(r => r.status === 'REJECTED').length,
      })
    }

    return trends
  }, [filteredReceipts, timeRange])

  // 计算平均处理时间
  function calculateAvgProcessingTime(receipts: Receipt[]): number {
    const processedReceipts = receipts.filter(r =>
      r.status !== 'PENDING' && r.reviewTime && r.uploadTime
    )

    if (processedReceipts.length === 0) return 0

    const totalTime = processedReceipts.reduce((sum, receipt) => {
      const uploadTime = new Date(receipt.uploadTime).getTime()
      const reviewTime = new Date(receipt.reviewTime!).getTime()
      return sum + (reviewTime - uploadTime)
    }, 0)

    return totalTime / processedReceipts.length / (1000 * 60 * 60) // 转换为小时
  }

  // 获取回单类型文本
  const getReceiptTypeText = (type: string) => {
    switch (type) {
      case 'DELIVERY': return '送货回单'
      case 'PICKUP': return '提货回单'
      case 'TRANSFER': return '中转回单'
      case 'OTHER': return '其他'
      default: return type
    }
  }

  return (
    <div className="space-y-6">
      {/* 时间范围选择 */}
      <div className="flex justify-between items-center">
        <h3 className="text-lg font-medium">统计分析</h3>
        <Select value={timeRange} onValueChange={(value: any) => setTimeRange(value)}>
          <SelectTrigger className="w-[120px]">
            <SelectValue />
          </SelectTrigger>
          <SelectContent>
            <SelectItem value="week">近一周</SelectItem>
            <SelectItem value="month">近一月</SelectItem>
            <SelectItem value="quarter">近三月</SelectItem>
          </SelectContent>
        </Select>
      </div>

      {/* 概览统计 */}
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
        <Card>
          <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
            <CardTitle className="text-sm font-medium">总回单数</CardTitle>
          </CardHeader>
          <CardContent>
            <div className="text-2xl font-bold">{stats.total}</div>
            <p className="text-xs text-muted-foreground">
              时间范围内总数
            </p>
          </CardContent>
        </Card>

        <Card>
          <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
            <CardTitle className="text-sm font-medium">通过率</CardTitle>
          </CardHeader>
          <CardContent>
            <div className="text-2xl font-bold text-green-600">
              {stats.approvalRate.toFixed(1)}%
            </div>
            <p className="text-xs text-muted-foreground">
              {stats.approved} / {stats.total}
            </p>
          </CardContent>
        </Card>

        <Card>
          <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
            <CardTitle className="text-sm font-medium">平均处理时间</CardTitle>
          </CardHeader>
          <CardContent>
            <div className="text-2xl font-bold text-blue-600">
              {stats.avgProcessingTime.toFixed(1)}h
            </div>
            <p className="text-xs text-muted-foreground">
              从上传到审核完成
            </p>
          </CardContent>
        </Card>

        <Card>
          <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
            <CardTitle className="text-sm font-medium">待审核</CardTitle>
          </CardHeader>
          <CardContent>
            <div className="text-2xl font-bold text-orange-600">{stats.pending}</div>
            <p className="text-xs text-muted-foreground">
              需要处理的回单
            </p>
          </CardContent>
        </Card>
      </div>

      {/* 详细分析 */}
      <Tabs defaultValue="trends" className="w-full">
        <TabsList className="grid w-full grid-cols-3">
          <TabsTrigger value="trends">趋势分析</TabsTrigger>
          <TabsTrigger value="types">类型分布</TabsTrigger>
          <TabsTrigger value="customers">客户分析</TabsTrigger>
        </TabsList>

        <TabsContent value="trends">
          <Card>
            <CardHeader>
              <CardTitle>每日趋势</CardTitle>
              <CardDescription>
                回单上传和审核的每日趋势
              </CardDescription>
            </CardHeader>
            <CardContent>
              <div className="h-64 flex items-center justify-center bg-muted rounded">
                <div className="text-center text-muted-foreground">
                  <div className="text-lg mb-2">📊</div>
                  <div>趋势图表</div>
                  <div className="text-sm">显示每日回单数量趋势</div>
                </div>
              </div>
            </CardContent>
          </Card>
        </TabsContent>

        <TabsContent value="types">
          <Card>
            <CardHeader>
              <CardTitle>回单类型分布</CardTitle>
              <CardDescription>
                不同类型回单的数量分布
              </CardDescription>
            </CardHeader>
            <CardContent>
              <div className="space-y-4">
                {byType.map((item) => (
                  <div key={item.type} className="flex items-center justify-between">
                    <div className="flex items-center space-x-3">
                      <span className="font-medium">{getReceiptTypeText(item.type)}</span>
                      <Badge variant="outline">
                        {item.count} 个
                      </Badge>
                    </div>
                    <div className="flex items-center space-x-3">
                      <div className="w-32 bg-gray-200 rounded-full h-2">
                        <div
                          className="bg-blue-600 h-2 rounded-full"
                          style={{ width: `${item.percentage}%` }}
                        />
                      </div>
                      <span className="text-sm text-muted-foreground w-12">
                        {item.percentage.toFixed(1)}%
                      </span>
                    </div>
                  </div>
                ))}
              </div>
            </CardContent>
          </Card>
        </TabsContent>

        <TabsContent value="customers">
          <Card>
            <CardHeader>
              <CardTitle>客户分析</CardTitle>
              <CardDescription>
                客户回单提交量排名
              </CardDescription>
            </CardHeader>
            <CardContent>
              <div className="space-y-4">
                {byCustomer.map((customer, index) => (
                  <div key={customer.customer} className="flex items-center justify-between">
                    <div className="flex items-center space-x-3">
                      <div className="w-8 h-8 bg-primary/10 rounded-full flex items-center justify-center text-sm font-medium">
                        {index + 1}
                      </div>
                      <span className="font-medium">{customer.customer}</span>
                    </div>
                    <Badge variant="outline">
                      {customer.count} 个
                    </Badge>
                  </div>
                ))}
              </div>
            </CardContent>
          </Card>
        </TabsContent>
      </Tabs>
    </div>
  )
}
```

### 6. 创建类型定义

创建`src/types/receipt.ts`:

```typescript
export interface Receipt {
  id: string
  receiptNumber: string
  orderNumber: string
  customerName: string
  customerId?: string
  receiptType: 'DELIVERY' | 'PICKUP' | 'TRANSFER' | 'OTHER'
  status: 'PENDING' | 'APPROVED' | 'REJECTED'
  fileName: string
  fileType: string
  fileSize: number
  fileUrl: string
  thumbnailUrl?: string
  description?: string
  priority: 'HIGH' | 'NORMAL' | 'LOW'
  uploadBy: string
  uploadTime: string
  reviewerName?: string
  reviewerId?: string
  reviewTime?: string
  reviewComments?: string
  rejectReason?: string
  tags?: string[]
  metadata?: Record<string, any>
}

export interface ReceiptUploadRequest {
  orderNumber: string
  customerName: string
  receiptType: 'DELIVERY' | 'PICKUP' | 'TRANSFER' | 'OTHER'
  description?: string
  priority: 'HIGH' | 'NORMAL' | 'LOW'
  files: Array<{
    name: string
    size: number
    type: string
    url: string
  }>
}

export interface ReceiptReviewRequest {
  status: 'APPROVED' | 'REJECTED'
  comments?: string
  rejectReason?: string
}

export interface ReceiptAnalytics {
  total: number
  pending: number
  approved: number
  rejected: number
  approvalRate: number
  avgProcessingTime: number
  byType: Array<{
    type: string
    count: number
    percentage: number
  }>
  byCustomer: Array<{
    customer: string
    count: number
  }>
  dailyTrends: Array<{
    date: string
    total: number
    approved: number
    rejected: number
  }>
}
```

### 7. 创建回单管理页面

创建`src/app/receipts/page.tsx`:

```typescript
'use client'

import { useState, useEffect } from 'react'
import { ReceiptManagement } from '@/components/receipts/receipt-management'
import { Receipt } from '@/types/receipt'

// 模拟数据
const mockReceipts: Receipt[] = [
  {
    id: '1',
    receiptNumber: 'RCP-2024-0001',
    orderNumber: 'ORD-2024-0001',
    customerName: '张三',
    customerId: '1',
    receiptType: 'DELIVERY',
    status: 'PENDING',
    fileName: 'delivery_receipt_001.pdf',
    fileType: 'application/pdf',
    fileSize: 1024000,
    fileUrl: '/api/receipts/1',
    description: '北京市朝阳区送货回单',
    priority: 'NORMAL',
    uploadBy: 'system',
    uploadTime: '2024-01-15T10:30:00Z',
  },
  {
    id: '2',
    receiptNumber: 'RCP-2024-0002',
    orderNumber: 'ORD-2024-0002',
    customerName: '李四',
    customerId: '2',
    receiptType: 'PICKUP',
    status: 'APPROVED',
    fileName: 'pickup_receipt_002.jpg',
    fileType: 'image/jpeg',
    fileSize: 2048000,
    fileUrl: '/api/receipts/2',
    thumbnailUrl: '/api/receipts/2/thumb',
    description: '上海市浦东新区提货回单',
    priority: 'HIGH',
    uploadBy: 'system',
    uploadTime: '2024-01-14T15:20:00Z',
    reviewerName: '审核员A',
    reviewerId: '1',
    reviewTime: '2024-01-14T16:00:00Z',
    reviewComments: '回单信息完整，签字清晰',
  },
  {
    id: '3',
    receiptNumber: 'RCP-2024-0003',
    orderNumber: 'ORD-2024-0003',
    customerName: '王五',
    customerId: '3',
    receiptType: 'DELIVERY',
    status: 'REJECTED',
    fileName: 'delivery_receipt_003.pdf',
    fileType: 'application/pdf',
    fileSize: 512000,
    fileUrl: '/api/receipts/3',
    description: '广州市天河区送货回单',
    priority: 'NORMAL',
    uploadBy: 'system',
    uploadTime: '2024-01-13T09:15:00Z',
    reviewerName: '审核员B',
    reviewerId: '2',
    reviewTime: '2024-01-13T10:00:00Z',
    reviewComments: '缺少客户签字，请重新上传',
    rejectReason: '回单缺少必要的签字信息',
  },
]

export default function ReceiptsPage() {
  const [receipts, setReceipts] = useState<Receipt[]>(mockReceipts)
  const [loading, setLoading] = useState(false)

  // 模拟API调用
  const handleReceiptUpload = async (data: any) => {
    setLoading(true)
    try {
      await new Promise(resolve => setTimeout(resolve, 1000))

      const newReceipt: Receipt = {
        id: Math.random().toString(36).substr(2, 9),
        receiptNumber: `RCP-${new Date().getFullYear()}-${String(Math.floor(Math.random() * 9999) + 1).padStart(4, '0')}`,
        status: 'PENDING',
        uploadTime: new Date().toISOString(),
        ...data,
      } as Receipt

      setReceipts([newReceipt, ...receipts])
    } catch (error) {
      console.error('上传回单失败:', error)
      throw error
    } finally {
      setLoading(false)
    }
  }

  const handleReceiptUpdate = async (id: string, data: Partial<Receipt>) => {
    setLoading(true)
    try {
      await new Promise(resolve => setTimeout(resolve, 500))

      setReceipts(receipts.map(receipt =>
        receipt.id === id
          ? { ...receipt, ...data, updatedAt: new Date().toISOString() }
          : receipt
      ))
    } catch (error) {
      console.error('更新回单失败:', error)
      throw error
    } finally {
      setLoading(false)
    }
  }

  const handleReceiptDelete = async (id: string) => {
    if (window.confirm('确定要删除这个回单吗？')) {
      setLoading(true)
      try {
        await new Promise(resolve => setTimeout(resolve, 500))
        setReceipts(receipts.filter(receipt => receipt.id !== id))
      } catch (error) {
        console.error('删除回单失败:', error)
        throw error
      } finally {
        setLoading(false)
      }
    }
  }

  const handleReceiptApprove = async (id: string, comments?: string) => {
    setLoading(true)
    try {
      await new Promise(resolve => setTimeout(resolve, 500))

      setReceipts(receipts.map(receipt =>
        receipt.id === id
          ? {
              ...receipt,
              status: 'APPROVED',
              reviewerName: '当前用户',
              reviewerId: 'current_user',
              reviewTime: new Date().toISOString(),
              reviewComments: comments,
            }
          : receipt
      ))
    } catch (error) {
      console.error('审核通过失败:', error)
      throw error
    } finally {
      setLoading(false)
    }
  }

  const handleReceiptReject = async (id: string, reason: string) => {
    setLoading(true)
    try {
      await new Promise(resolve => setTimeout(resolve, 500))

      setReceipts(receipts.map(receipt =>
        receipt.id === id
          ? {
              ...receipt,
              status: 'REJECTED',
              reviewerName: '当前用户',
              reviewerId: 'current_user',
              reviewTime: new Date().toISOString(),
              rejectReason: reason,
            }
          : receipt
      ))
    } catch (error) {
      console.error('审核拒绝失败:', error)
      throw error
    } finally {
      setLoading(false)
    }
  }

  return (
    <div className="container mx-auto py-8">
      <ReceiptManagement
        receipts={receipts}
        onReceiptUpload={handleReceiptUpload}
        onReceiptUpdate={handleReceiptUpdate}
        onReceiptDelete={handleReceiptDelete}
        onReceiptApprove={handleReceiptApprove}
        onReceiptReject={handleReceiptReject}
      />
    </div>
  )
}
```

## 验证清单

- [ ] 回单列表显示正确
- [ ] 文件上传功能正常
- [ ] 审核流程完整
- [ ] 状态管理正确
- [ ] 搜索筛选功能正常
- [ ] 批量操作可用
- [ ] 统计分析数据准确
- [ ] 响应式设计良好

## 测试命令

```bash
# 启动开发服务器
npm run dev

# 运行类型检查
npm run type-check

# 运行测试
npm test

# 检查构建
npm run build
```

## 注意事项

- 确保文件上传安全性
- 优化大文件上传性能
- 实现图片压缩和预览
- 添加文件类型和大小验证
- 实现批量导出功能
- 确保移动端文件上传体验