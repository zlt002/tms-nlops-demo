---
title: ä¸»èŠå¤©ç•Œé¢å®ç° (ä¼ ç»ŸUIä¸NL-Opså¯¹æ¯”)
epic: tms-nlops-demo
task_id: 037
type: task
status: todo
priority: high
tags: ["ui", "chat", "react", "comparison", "frontend"]
assignee: ""
created: 2025-09-20T04:20:45Z
updated: 2025-09-20T04:20:45Z
parallel: false
depends_on: ["016", "017", "018", "019", "020", "021", "022", "023", "024", "025", "030", "031", "032", "033", "034", "035", "036"]
effort: 5
description: å®ç°ä¸»èŠå¤©ç•Œé¢ï¼Œæ”¯æŒä¼ ç»ŸUIä¸NL-Opsæ¨¡å¼çš„å¯¹æ¯”æ¼”ç¤º
---

## ä»»åŠ¡æè¿°

å®ç°TMS NL-Opsæ¼”ç¤ºç³»ç»Ÿçš„ä¸»èŠå¤©ç•Œé¢ï¼Œé›†æˆä¼ ç»ŸUIå¯¼èˆªå’ŒAIäº¤äº’æ¨¡å¼ï¼Œæä¾›ç›´è§‚çš„ç”¨æˆ·ä½“éªŒå¯¹æ¯”ï¼Œæ”¯æŒåŠ¨æ€UIç»„ä»¶æ¸²æŸ“ã€æ¶ˆæ¯æµç®¡ç†ã€æ¨¡å¼åˆ‡æ¢ç­‰åŠŸèƒ½ã€‚

## è¯¦ç»†éœ€æ±‚

### 1. ç•Œé¢å¸ƒå±€è®¾è®¡
- **åŒæ å¸ƒå±€**: å·¦ä¾§å¯¼èˆªæ ï¼Œå³ä¾§ä¸»å†…å®¹åŒº
- **æ¨¡å¼åˆ‡æ¢**: ä¼ ç»ŸUIæ¨¡å¼ä¸NL-Opsæ¨¡å¼åˆ‡æ¢
- **å“åº”å¼è®¾è®¡**: é€‚é…ä¸åŒå±å¹•å°ºå¯¸
- **ä¸»é¢˜ä¸€è‡´**: ç»Ÿä¸€çš„è§†è§‰é£æ ¼å’Œäº¤äº’ä½“éªŒ

### 2. èŠå¤©ç•Œé¢åŠŸèƒ½
- **æ¶ˆæ¯æµ**: å®æ—¶æ¶ˆæ¯æ˜¾ç¤ºå’Œæ»šåŠ¨
- **è¾“å…¥äº¤äº’**: æ™ºèƒ½è¾“å…¥å»ºè®®å’Œå¿«æ·æ“ä½œ
- **å·¥å…·è°ƒç”¨**: åŠ¨æ€UIç»„ä»¶æ¸²æŸ“
- **çŠ¶æ€ç®¡ç†**: å¯¹è¯çŠ¶æ€å’Œä¸Šä¸‹æ–‡ç»´æŠ¤

### 3. ä¼ ç»ŸUIé›†æˆ
- **å¯¼èˆªèœå•**: ä¼ ç»ŸUIåŠŸèƒ½æ¨¡å—å…¥å£
- **é¡µé¢è·¯ç”±**: è·³è½¬åˆ°ä¼ ç»ŸUIé¡µé¢
- **æ•°æ®åŒæ­¥**: ä¸AIæ¨¡å¼æ•°æ®åŒæ­¥
- **çŠ¶æ€ä¿æŒ**: ç”¨æˆ·çŠ¶æ€ä¸€è‡´æ€§

### 4. äº¤äº’ä½“éªŒä¼˜åŒ–
- **åŠ è½½çŠ¶æ€**: å¼‚æ­¥æ“ä½œçš„åŠ è½½åé¦ˆ
- **é”™è¯¯å¤„ç†**: å‹å¥½çš„é”™è¯¯æç¤ºå’Œæ¢å¤
- **å¿«æ·æ“ä½œ**: å¸¸ç”¨åŠŸèƒ½çš„å¿«æ·å…¥å£
- **å¸®åŠ©å¼•å¯¼**: æ–°ç”¨æˆ·å¼•å¯¼å’Œå¸®åŠ©

## æŠ€æœ¯å®ç°

### ä¸»ç•Œé¢ç»„ä»¶
```typescript
// app/page.tsx
'use client';
import { useState, useEffect } from 'react';
import { useChat } from '@ai-sdk/react';
import { useRouter } from 'next/navigation';
import { Sidebar } from '@/components/layout/Sidebar';
import { ChatContainer } from '@/components/chat/ChatContainer';
import { TraditionalUI } from '@/components/traditional-ui/TraditionalUI';
import { ModeToggle } from '@/components/ui/ModeToggle';
import { LoadingSpinner } from '@/components/ui/LoadingSpinner';
import { ErrorBoundary } from '@/components/error/ErrorBoundary';

interface ChatMode {
  type: 'ai' | 'traditional';
  session?: string;
}

export default function HomePage() {
  const [mode, setMode] = useState<ChatMode>({ type: 'ai' });
  const [isLoading, setIsLoading] = useState(false);
  const router = useRouter();

  const {
    messages,
    input,
    handleInputChange,
    handleSubmit,
    setMessages,
    error,
    reload
  } = useChat({
    api: '/api/chat',
    id: mode.session,
    onFinish: () => {
      setIsLoading(false);
    },
    onError: (error) => {
      console.error('Chat error:', error);
      setIsLoading(false);
    }
  });

  // æ¨¡å¼åˆ‡æ¢å¤„ç†
  const handleModeChange = (newMode: ChatMode) => {
    if (newMode.type === 'traditional') {
      router.push('/tms-dashboard');
    } else {
      setMode(newMode);
    }
  };

  // æ¸²æŸ“åŠ¨æ€UIç»„ä»¶
  const renderDynamicComponent = (toolCall: any) => {
    const { toolName, args } = toolCall;

    switch (toolName) {
      case 'showOrders':
        return (
          <OrderTable
            key={toolCall.id}
            orders={args.orders}
            onOrderClick={(orderId) => handleOrderClick(orderId)}
          />
        );

      case 'showDispatchPlan':
        return (
          <DispatchPlan
            key={toolCall.id}
            orders={args.orders}
            vehicle={args.vehicle}
            route={args.route}
            onConfirm={() => handleDispatchConfirm(args.dispatchId)}
          />
        );

      case 'showVehicleTracking':
        return (
          <VehicleTracker
            key={toolCall.id}
            vehicle={args.vehicle}
            currentLocation={args.currentLocation}
            estimatedArrival={new Date(args.estimatedArrival)}
            route={args.route}
          />
        );

      case 'showPODViewer':
        return (
          <PODViewer
            key={toolCall.id}
            orderId={args.orderId}
            podData={args.podData}
            onVerify={(verified) => handlePODVerify(args.orderId, verified)}
          />
        );

      default:
        return null;
    }
  };

  return (
    <ErrorBoundary>
      <div className="flex h-screen bg-gray-50">
        {/* ä¾§è¾¹æ  */}
        <Sidebar mode={mode} onModeChange={handleModeChange} />

        {/* ä¸»å†…å®¹åŒº */}
        <main className="flex-1 flex flex-col overflow-hidden">
          {/* é¡¶éƒ¨å·¥å…·æ  */}
          <header className="bg-white border-b border-gray-200 px-6 py-4">
            <div className="flex items-center justify-between">
              <h1 className="text-2xl font-bold text-gray-900">
                TMS NL-Ops æ¼”ç¤ºç³»ç»Ÿ
              </h1>
              <div className="flex items-center space-x-4">
                <ModeToggle mode={mode} onModeChange={handleModeChange} />
                <QuickActions />
              </div>
            </div>
          </header>

          {/* å†…å®¹åŒºåŸŸ */}
          <div className="flex-1 overflow-hidden">
            {mode.type === 'ai' ? (
              <ChatContainer
                messages={messages}
                input={input}
                handleInputChange={handleInputChange}
                handleSubmit={handleSubmit}
                isLoading={isLoading}
                error={error}
                renderDynamicComponent={renderDynamicComponent}
                onRetry={reload}
              />
            ) : (
              <TraditionalUI />
            )}
          </div>

          {/* åŠ è½½çŠ¶æ€ */}
          {isLoading && (
            <div className="absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center">
              <LoadingSpinner size="lg" />
            </div>
          )}
        </main>
      </div>
    </ErrorBoundary>
  );
}
```

### èŠå¤©å®¹å™¨ç»„ä»¶
```typescript
// components/chat/ChatContainer.tsx
'use client';
import { useRef, useEffect } from 'react';
import { Message, useChat } from '@ai-sdk/react';
import { ChatInput } from './ChatInput';
import { MessageList } from './MessageList';
import { Suggestions } from './Suggestions';
import { TypingIndicator } from './TypingIndicator';

interface ChatContainerProps {
  messages: Message[];
  input: string;
  handleInputChange: (e: React.ChangeEvent<HTMLInputElement>) => void;
  handleSubmit: (e: React.FormEvent) => void;
  isLoading: boolean;
  error?: Error;
  renderDynamicComponent: (toolCall: any) => React.ReactNode;
  onRetry: () => void;
}

export function ChatContainer({
  messages,
  input,
  handleInputChange,
  handleSubmit,
  isLoading,
  error,
  renderDynamicComponent,
  onRetry
}: ChatContainerProps) {
  const messagesEndRef = useRef<HTMLDivElement>(null);
  const containerRef = useRef<HTMLDivElement>(null);

  // è‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨
  useEffect(() => {
    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
  }, [messages]);

  // å¤„ç†é”®ç›˜å¿«æ·é”®
  useEffect(() => {
    const handleKeyDown = (e: KeyboardEvent) => {
      if (e.key === 'Enter' && !e.shiftKey && input.trim()) {
        e.preventDefault();
        handleSubmit(e as any);
      }
    };

    window.addEventListener('keydown', handleKeyDown);
    return () => window.removeEventListener('keydown', handleKeyDown);
  }, [input, handleSubmit]);

  return (
    <div className="flex flex-col h-full">
      {/* æ¶ˆæ¯åˆ—è¡¨ */}
      <div
        ref={containerRef}
        className="flex-1 overflow-y-auto px-6 py-4 space-y-4"
      >
        <MessageList
          messages={messages}
          renderDynamicComponent={renderDynamicComponent}
        />

        {/* è¾“å…¥æŒ‡ç¤ºå™¨ */}
        {isLoading && (
          <TypingIndicator />
        )}

        {/* é”™è¯¯æç¤º */}
        {error && (
          <div className="bg-red-50 border border-red-200 rounded-lg p-4">
            <div className="flex items-center justify-between">
              <div className="text-red-800">
                <strong>é”™è¯¯:</strong> {error.message}
              </div>
              <button
                onClick={onRetry}
                className="text-red-600 hover:text-red-800 underline"
              >
                é‡è¯•
              </button>
            </div>
          </div>
        )}

        <div ref={messagesEndRef} />
      </div>

      {/* è¾“å…¥åŒºåŸŸ */}
      <div className="border-t border-gray-200 bg-white">
        <div className="px-6 py-4">
          {/* å¿«æ·å»ºè®® */}
          {messages.length === 0 && !isLoading && (
            <Suggestions onSelect={(suggestion) => {
              // æ¨¡æ‹Ÿè¾“å…¥å»ºè®®
              const input = document.querySelector('input[type="text"]') as HTMLInputElement;
              if (input) {
                input.value = suggestion;
                handleInputChange({ target: { value: suggestion } } as any);
              }
            }} />
          )}

          {/* è¾“å…¥æ¡† */}
          <ChatInput
            value={input}
            onChange={handleInputChange}
            onSubmit={handleSubmit}
            disabled={isLoading}
            placeholder="è¯·è¾“å…¥æ‚¨çš„éœ€æ±‚ï¼Œä¾‹å¦‚ï¼šæŸ¥è¯¢ä»Šå¤©çš„è®¢å•ã€åˆ›å»ºæ–°è®¢å•ã€æŸ¥çœ‹è½¦è¾†ä½ç½®ç­‰..."
          />
        </div>
      </div>
    </div>
  );
}
```

### æ¶ˆæ¯åˆ—è¡¨ç»„ä»¶
```typescript
// components/chat/MessageList.tsx
'use client';
import { Message } from '@ai-sdk/react';
import { UserMessage } from './UserMessage';
import { AssistantMessage } from './AssistantMessage';

interface MessageListProps {
  messages: Message[];
  renderDynamicComponent: (toolCall: any) => React.ReactNode;
}

export function MessageList({ messages, renderDynamicComponent }: MessageListProps) {
  return (
    <div className="space-y-4">
      {messages.map((message, index) => (
        <div key={message.id} className="flex flex-col space-y-2">
          {message.role === 'user' ? (
            <UserMessage content={message.content} />
          ) : (
            <AssistantMessage
              content={message.content}
              toolCalls={message.tool_calls}
              renderDynamicComponent={renderDynamicComponent}
            />
          )}
        </div>
      ))}

      {/* æ¬¢è¿æ¶ˆæ¯ */}
      {messages.length === 0 && (
        <div className="text-center py-8">
          <h2 className="text-2xl font-bold text-gray-900 mb-4">
            æ¬¢è¿ä½¿ç”¨ TMS NL-Ops æ¼”ç¤ºç³»ç»Ÿ
          </h2>
          <p className="text-gray-600 mb-6">
            æˆ‘æ˜¯æ‚¨çš„æ™ºèƒ½è¿è¾“ç®¡ç†åŠ©æ‰‹ï¼Œå¯ä»¥å¸®åŠ©æ‚¨ï¼š
          </p>
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 max-w-4xl mx-auto">
            <div className="bg-white p-4 rounded-lg border border-gray-200">
              <h3 className="font-semibold text-blue-600 mb-2">ğŸ“¦ è®¢å•ç®¡ç†</h3>
              <p className="text-sm text-gray-600">æŸ¥è¯¢ã€åˆ›å»ºå’Œç®¡ç†è¿è¾“è®¢å•</p>
            </div>
            <div className="bg-white p-4 rounded-lg border border-gray-200">
              <h3 className="font-semibold text-green-600 mb-2">ğŸšš æ’è½¦è°ƒåº¦</h3>
              <p className="text-sm text-gray-600">æ™ºèƒ½æ’è½¦å’Œè·¯çº¿è§„åˆ’</p>
            </div>
            <div className="bg-white p-4 rounded-lg border border-gray-200">
              <h3 className="font-semibold text-purple-600 mb-2">ğŸ“ è½¦è¾†è·Ÿè¸ª</h3>
              <p className="text-sm text-gray-600">å®æ—¶è½¦è¾†ä½ç½®å’Œè½¨è¿¹æŸ¥è¯¢</p>
            </div>
          </div>
        </div>
      )}
    </div>
  );
}
```

### åŠ©æ‰‹æ¶ˆæ¯ç»„ä»¶
```typescript
// components/chat/AssistantMessage.tsx
'use client';
import { useState } from 'react';
import { ToolCall } from '@ai-sdk/react';
import { Markdown } from './Markdown';
import { ToolCallComponent } from './ToolCallComponent';

interface AssistantMessageProps {
  content: string;
  toolCalls?: ToolCall[];
  renderDynamicComponent: (toolCall: any) => React.ReactNode;
}

export function AssistantMessage({
  content,
  toolCalls,
  renderDynamicComponent
}: AssistantMessageProps) {
  const [expandedToolCalls, setExpandedToolCalls] = useState<Set<string>>(new Set());

  const toggleToolCall = (toolCallId: string) => {
    const newExpanded = new Set(expandedToolCalls);
    if (newExpanded.has(toolCallId)) {
      newExpanded.delete(toolCallId);
    } else {
      newExpanded.add(toolCallId);
    }
    setExpandedToolCalls(newExpanded);
  };

  return (
    <div className="flex items-start space-x-3">
      {/* AIå¤´åƒ */}
      <div className="flex-shrink-0">
        <div className="w-8 h-8 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center">
          <span className="text-white text-sm font-bold">AI</span>
        </div>
      </div>

      {/* æ¶ˆæ¯å†…å®¹ */}
      <div className="flex-1 space-y-3">
        {/* æ–‡æœ¬å†…å®¹ */}
        {content && (
          <div className="bg-white rounded-lg p-4 shadow-sm">
            <Markdown content={content} />
          </div>
        )}

        {/* å·¥å…·è°ƒç”¨ */}
        {toolCalls && toolCalls.length > 0 && (
          <div className="space-y-2">
            {toolCalls.map((toolCall) => (
              <div key={toolCall.id}>
                {/* å·¥å…·è°ƒç”¨å¤´éƒ¨ */}
                <button
                  onClick={() => toggleToolCall(toolCall.id)}
                  className="flex items-center space-x-2 w-full text-left bg-gray-50 hover:bg-gray-100 rounded-lg p-3 transition-colors"
                >
                  <span className="font-mono text-sm bg-blue-100 text-blue-800 px-2 py-1 rounded">
                    {toolCall.toolName}
                  </span>
                  <span className="text-gray-600 text-sm">
                    {expandedToolCalls.has(toolCall.id) ? 'æ”¶èµ·' : 'å±•å¼€'}
                  </span>
                </button>

                {/* å·¥å…·è°ƒç”¨è¯¦æƒ… */}
                {expandedToolCalls.has(toolCall.id) && (
                  <div className="mt-2 space-y-3">
                    {/* å‚æ•°æ˜¾ç¤º */}
                    <div className="bg-gray-50 rounded-lg p-3">
                      <h4 className="text-sm font-medium text-gray-700 mb-2">å‚æ•°:</h4>
                      <pre className="text-xs bg-gray-100 rounded p-2 overflow-x-auto">
                        {JSON.stringify(toolCall.args, null, 2)}
                      </pre>
                    </div>

                    {/* åŠ¨æ€UIç»„ä»¶ */}
                    {renderDynamicComponent(toolCall)}
                  </div>
                )}
              </div>
            ))}
          </div>
        )}
      </div>
    </div>
  );
}
```

## äº¤ä»˜æˆæœ

1. **ä¸»ç•Œé¢ç»„ä»¶**: å®Œæ•´çš„ä¸»èŠå¤©ç•Œé¢å®ç°
2. **èŠå¤©å®¹å™¨**: æ¶ˆæ¯æµç®¡ç†å’Œç”¨æˆ·äº¤äº’
3. **æ¶ˆæ¯ç»„ä»¶**: ç”¨æˆ·å’ŒåŠ©æ‰‹æ¶ˆæ¯å±•ç¤º
4. **è¾“å…¥ç»„ä»¶**: æ™ºèƒ½è¾“å…¥å’Œå¿«æ·æ“ä½œ
5. **ä¾§è¾¹æ **: å¯¼èˆªå’Œæ¨¡å¼åˆ‡æ¢
6. **å¿«æ·å»ºè®®**: å¸¸ç”¨æ“ä½œå¿«æ·å…¥å£
7. **é”™è¯¯å¤„ç†**: å‹å¥½çš„é”™è¯¯æç¤ºå’Œæ¢å¤

## éªŒæ”¶æ ‡å‡†

- [ ] ç•Œé¢å“åº”æ—¶é—´ < 100ms
- [ ] æ¶ˆæ¯æ¸²æŸ“æµç•…ï¼Œæ— å¡é¡¿
- [ ] åŠ¨æ€UIç»„ä»¶æ­£ç¡®æ˜¾ç¤º
- [ ] æ¨¡å¼åˆ‡æ¢æ­£å¸¸å·¥ä½œ
- [ ] å¿«æ·å»ºè®®åŠŸèƒ½æ­£å¸¸
- [ ] é”™è¯¯å¤„ç†å‹å¥½ä¸”æœ‰æ•ˆ
- [ ] é”®ç›˜å¿«æ·é”®æ”¯æŒ
- [ ] è‡ªåŠ¨æ»šåŠ¨åŠŸèƒ½æ­£å¸¸
- [ ] å“åº”å¼è®¾è®¡é€‚é…å„ç§è®¾å¤‡
- [ ] åŠ è½½çŠ¶æ€åé¦ˆåŠæ—¶
- [ ] æ— éšœç¢è®¿é—®æ”¯æŒ
- [ ] ä»£ç ç¬¦åˆé¡¹ç›®ç¼–ç è§„èŒƒ

## ç›¸å…³æ–‡ä»¶

- `/app/page.tsx` - ä¸»é¡µé¢ç»„ä»¶
- `/components/chat/ChatContainer.tsx` - èŠå¤©å®¹å™¨
- `/components/chat/MessageList.tsx` - æ¶ˆæ¯åˆ—è¡¨
- `/components/chat/UserMessage.tsx` - ç”¨æˆ·æ¶ˆæ¯
- `/components/chat/AssistantMessage.tsx` - åŠ©æ‰‹æ¶ˆæ¯
- `/components/chat/ChatInput.tsx` - èŠå¤©è¾“å…¥
- `/components/layout/Sidebar.tsx` - ä¾§è¾¹æ 
- `/components/ui/ModeToggle.tsx` - æ¨¡å¼åˆ‡æ¢
- `/components/ui/QuickActions.tsx` - å¿«æ·æ“ä½œ

## æ³¨æ„äº‹é¡¹

1. ç”¨æˆ·ä½“éªŒï¼šç•Œé¢äº¤äº’è¦ç›´è§‚å‹å¥½
2. æ€§èƒ½ä¼˜åŒ–ï¼šå‡å°‘ä¸å¿…è¦çš„é‡æ¸²æŸ“
3. é”™è¯¯å¤„ç†ï¼šæä¾›æ¸…æ™°çš„é”™è¯¯åé¦ˆ
4. å¯è®¿é—®æ€§ï¼šæ”¯æŒé”®ç›˜æ“ä½œå’Œå±å¹•é˜…è¯»å™¨
5. å“åº”å¼è®¾è®¡ï¼šé€‚é…ä¸åŒè®¾å¤‡å±å¹•
6. åŠ¨ç”»æ•ˆæœï¼šä½¿ç”¨é€‚å½“çš„è¿‡æ¸¡åŠ¨ç”»
7. æµ‹è¯•è¦†ç›–ï¼šç¡®ä¿å„ç»„ä»¶åŠŸèƒ½æ­£å¸¸
8. ä»£ç å¤ç”¨ï¼šæœ€å¤§åŒ–ç»„ä»¶å¤ç”¨ç‡