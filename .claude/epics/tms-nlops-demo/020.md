---
title: "TMS NL-Ops演示系统任务020: 仪表板和统计页面实现"
epic: "tms-nlops-demo"
task: "020"
phase: "3"
status: "pending"
priority: "medium"
estimated_hours: 14
parallel: false
depends_on: ["008", "009", "010", "011", "015"]
tags: ["ui", "dashboard", "analytics", "charts"]
created: "2025-09-20T04:20:45Z"
updated: "2025-09-20T04:20:45Z"
---

## 概述

实现TMS NL-Ops演示系统的仪表板和统计页面，提供系统整体运行状态的概览、关键指标监控、数据可视化展示和业务分析功能。

## 目标

- 创建系统概览仪表板，显示关键业务指标
- 实现实时数据监控和更新
- 开发多维度的数据可视化图表
- 提供业务分析和趋势预测功能
- 实现可定制的仪表板布局
- 支持数据导出和报表生成

## 技术栈

- **框架**: Next.js 15+ App Router
- **语言**: TypeScript
- **样式**: Tailwind CSS + shadcn/ui v2
- **图表库**: Recharts / Chart.js
- **实时数据**: WebSocket / Server-Sent Events
- **日期处理**: date-fns
- **状态管理**: Zustand

## 实施步骤

### 1. 创建仪表板主组件

创建`src/components/dashboard/dashboard-main.tsx`:

```typescript
'use client'

import { useState, useMemo, useEffect } from 'react'
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'
import { Button } from '@/components/ui/button'
import { Badge } from '@/components/ui/badge'
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs'
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select'
import { DateRangePicker } from '@/components/ui/date-range-picker'
import { RefreshCw, Download, Settings, TrendingUp, TrendingDown, Minus } from 'lucide-react'
import { DashboardMetrics } from './dashboard-metrics'
import { OrderTrendsChart } from './order-trends-chart'
import { VehicleUtilizationChart } from './vehicle-utilization-chart'
import { RevenueChart } from './revenue-chart'
import { PerformanceMetrics } from './performance-metrics'
import { AlertsPanel } from './alerts-panel'
import { QuickActions } from './quick-actions'
import { DashboardData, TimeRange } from '@/types/dashboard'

interface DashboardMainProps {
  data: DashboardData
  onRefresh: () => Promise<void>
  onExportData: (type: string, format: string) => Promise<void>
}

export function DashboardMain({ data, onRefresh, onExportData }: DashboardMainProps) {
  const [refreshing, setRefreshing] = useState(false)
  const [timeRange, setTimeRange] = useState<TimeRange>('today')
  const [customDateRange, setCustomDateRange] = useState<{ from: Date; to: Date } | null>(null)

  // 根据时间范围筛选数据
  const filteredData = useMemo(() => {
    // 这里应该根据时间范围过滤数据
    return data
  }, [data, timeRange, customDateRange])

  // 关键指标计算
  const metrics = useMemo(() => {
    const {
      orders,
      vehicles,
      revenue,
      performance
    } = filteredData

    // 订单指标
    const totalOrders = orders.total
    const completedOrders = orders.completed
    const pendingOrders = orders.pending
    const completionRate = totalOrders > 0 ? (completedOrders / totalOrders) * 100 : 0

    // 车辆指标
    const totalVehicles = vehicles.total
    const activeVehicles = vehicles.active
    const utilizationRate = totalVehicles > 0 ? (activeVehicles / totalVehicles) * 100 : 0

    // 收入指标
    const totalRevenue = revenue.total
    const growthRate = revenue.growthRate

    // 性能指标
    const onTimeRate = performance.onTimeRate
    const customerSatisfaction = performance.customerSatisfaction

    return {
      orders: {
        total: totalOrders,
        completed: completedOrders,
        pending: pendingOrders,
        completionRate,
        trend: calculateTrend(orders.trendData),
      },
      vehicles: {
        total: totalVehicles,
        active: activeVehicles,
        utilizationRate,
        trend: calculateTrend(vehicles.utilizationTrend),
      },
      revenue: {
        total: totalRevenue,
        growthRate,
        trend: growthRate > 0 ? 'up' : growthRate < 0 ? 'down' : 'stable',
      },
      performance: {
        onTimeRate,
        customerSatisfaction,
        trend: calculateTrend(performance.trendData),
      },
    }
  }, [filteredData])

  // 计算趋势
  const calculateTrend = (data: number[]) => {
    if (data.length < 2) return 'stable'
    const current = data[data.length - 1]
    const previous = data[data.length - 2]
    const change = ((current - previous) / previous) * 100

    if (change > 5) return 'up'
    if (change < -5) return 'down'
    return 'stable'
  }

  // 刷新数据
  const handleRefresh = async () => {
    setRefreshing(true)
    try {
      await onRefresh()
    } catch (error) {
      console.error('刷新数据失败:', error)
    } finally {
      setRefreshing(false)
    }
  }

  // 处理时间范围变更
  const handleTimeRangeChange = (range: TimeRange) => {
    setTimeRange(range)
    if (range !== 'custom') {
      setCustomDateRange(null)
    }
  }

  // 处理导出
  const handleExport = async (type: string) => {
    try {
      await onExportData(type, 'excel')
    } catch (error) {
      console.error('导出失败:', error)
    }
  }

  // 获取趋势图标
  const getTrendIcon = (trend: 'up' | 'down' | 'stable') => {
    switch (trend) {
      case 'up': return <TrendingUp className="w-4 h-4 text-green-600" />
      case 'down': return <TrendingDown className="w-4 h-4 text-red-600" />
      case 'stable': return <Minus className="w-4 h-4 text-gray-600" />
    }
  }

  return (
    <div className="space-y-6">
      {/* 页面标题和操作栏 */}
      <div className="flex justify-between items-center">
        <div>
          <h1 className="text-3xl font-bold tracking-tight">仪表板</h1>
          <p className="text-muted-foreground">系统运行状态和业务数据概览</p>
        </div>

        <div className="flex items-center space-x-4">
          <Select value={timeRange} onValueChange={handleTimeRangeChange}>
            <SelectTrigger className="w-[120px]">
              <SelectValue />
            </SelectTrigger>
            <SelectContent>
              <SelectItem value="today">今天</SelectItem>
              <SelectItem value="week">本周</SelectItem>
              <SelectItem value="month">本月</SelectItem>
              <SelectItem value="quarter">本季度</SelectItem>
              <SelectItem value="custom">自定义</SelectItem>
            </SelectContent>
          </Select>

          {timeRange === 'custom' && (
            <DateRangePicker
              value={customDateRange}
              onChange={setCustomDateRange}
            />
          )}

          <Button
            variant="outline"
            onClick={handleRefresh}
            disabled={refreshing}
          >
            <RefreshCw className={`w-4 h-4 mr-2 ${refreshing ? 'animate-spin' : ''}`} />
            刷新
          </Button>

          <Button variant="outline" onClick={() => handleExport('dashboard')}>
            <Download className="w-4 h-4 mr-2" />
            导出
          </Button>
        </div>
      </div>

      {/* 关键指标卡片 */}
      <DashboardMetrics metrics={metrics} />

      {/* 主要图表区域 */}
      <Tabs defaultValue="overview" className="w-full">
        <TabsList className="grid w-full grid-cols-4">
          <TabsTrigger value="overview">概览</TabsTrigger>
          <TabsTrigger value="orders">订单分析</TabsTrigger>
          <TabsTrigger value="operations">运营分析</TabsTrigger>
          <TabsTrigger value="performance">绩效分析</TabsTrigger>
        </TabsList>

        <TabsContent value="overview" className="space-y-6">
          <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <OrderTrendsChart data={filteredData.orders.trendData} />
            <VehicleUtilizationChart data={filteredData.vehicles.utilizationData} />
          </div>

          <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <RevenueChart data={filteredData.revenue.monthlyData} />
            <PerformanceMetrics data={filteredData.performance} />
          </div>
        </TabsContent>

        <TabsContent value="orders" className="space-y-6">
          {/* 订单分析相关图表 */}
          <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <OrderStatusChart data={filteredData.orders.byStatus} />
            <OrderTypeChart data={filteredData.orders.byType} />
          </div>

          <OrderGeographicChart data={filteredData.orders.byRegion} />
        </TabsContent>

        <TabsContent value="operations" className="space-y-6">
          {/* 运营分析相关图表 */}
          <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <VehicleEfficiencyChart data={filteredData.vehicles.efficiencyData} />
            <DeliveryPerformanceChart data={filteredData.performance.deliveryData} />
          </div>

          <RouteOptimizationChart data={filteredData.operations.routeData} />
        </TabsContent>

        <TabsContent value="performance" className="space-y-6">
          {/* 绩效分析相关图表 */}
          <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <DriverPerformanceChart data={filteredData.performance.driverData} />
            <CustomerSatisfactionChart data={filteredData.performance.satisfactionData} />
          </div>

          <CostAnalysisChart data={filteredData.finance.costData} />
        </TabsContent>
      </Tabs>

      {/* 底部面板 */}
      <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <div className="lg:col-span-2">
          <AlertsPanel alerts={filteredData.alerts} />
        </div>
        <div>
          <QuickActions />
        </div>
      </div>
    </div>
  )
}
```

### 2. 创建关键指标组件

创建`src/components/dashboard/dashboard-metrics.tsx`:

```typescript
'use client'

import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'
import { Badge } from '@/components/ui/badge'
import { TrendingUp, TrendingDown, Minus, Truck, Package, DollarSign, Target } from 'lucide-react'
import { DashboardMetrics as Metrics } from '@/types/dashboard'

interface DashboardMetricsProps {
  metrics: Metrics
}

export function DashboardMetrics({ metrics }: DashboardMetricsProps) {
  const metricCards = [
    {
      title: '订单统计',
      icon: Package,
      value: metrics.orders.total,
      change: `${metrics.orders.completionRate.toFixed(1)}%`,
      changeLabel: '完成率',
      trend: metrics.orders.trend,
      description: `待处理: ${metrics.orders.pending}`,
    },
    {
      title: '车辆利用',
      icon: Truck,
      value: metrics.vehicles.active,
      change: `${metrics.vehicles.utilizationRate.toFixed(1)}%`,
      changeLabel: '利用率',
      trend: metrics.vehicles.trend,
      description: `总计: ${metrics.vehicles.total} 辆`,
    },
    {
      title: '收入统计',
      icon: DollarSign,
      value: `¥${(metrics.revenue.total / 10000).toFixed(1)}万`,
      change: `${metrics.revenue.growthRate > 0 ? '+' : ''}${metrics.revenue.growthRate.toFixed(1)}%`,
      changeLabel: '增长率',
      trend: metrics.revenue.trend,
      description: '本月累计',
    },
    {
      title: '绩效指标',
      icon: Target,
      value: `${metrics.performance.onTimeRate.toFixed(1)}%`,
      change: `${metrics.performance.customerSatisfaction.toFixed(1)}`,
      changeLabel: '满意度',
      trend: metrics.performance.trend,
      description: '准时率统计',
    },
  ]

  return (
    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
      {metricCards.map((metric, index) => {
        const Icon = metric.icon
        const TrendIcon = metric.trend === 'up' ? TrendingUp :
                        metric.trend === 'down' ? TrendingDown : Minus
        const trendColor = metric.trend === 'up' ? 'text-green-600' :
                          metric.trend === 'down' ? 'text-red-600' : 'text-gray-600'

        return (
          <Card key={index}>
            <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
              <CardTitle className="text-sm font-medium">{metric.title}</CardTitle>
              <Icon className="h-4 w-4 text-muted-foreground" />
            </CardHeader>
            <CardContent>
              <div className="text-2xl font-bold">{metric.value}</div>
              <div className="flex items-center space-x-2 text-xs text-muted-foreground">
                <TrendIcon className={`h-3 w-3 ${trendColor}`} />
                <span>{metric.change}</span>
                <span>{metric.changeLabel}</span>
              </div>
              <p className="text-xs text-muted-foreground mt-1">
                {metric.description}
              </p>
            </CardContent>
          </Card>
        )
      })}
    </div>
  )
}
```

### 3. 创建订单趋势图表组件

创建`src/components/dashboard/order-trends-chart.tsx`:

```typescript
'use client'

import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'
import { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer } from 'recharts'
import { format } from 'date-fns'
import { zhCN } from 'date-fns/locale'

interface OrderTrendsChartProps {
  data: Array<{
    date: string
    orders: number
    completed: number
    pending: number
  }>
}

export function OrderTrendsChart({ data }: OrderTrendsChartProps) {
  // 格式化数据
  const chartData = data.map(item => ({
    date: format(new Date(item.date), 'MM/dd'),
    orders: item.orders,
    completed: item.completed,
    pending: item.pending,
  }))

  const CustomTooltip = ({ active, payload, label }: any) => {
    if (active && payload && payload.length) {
      return (
        <div className="bg-white p-3 border rounded-lg shadow-lg">
          <p className="font-medium">{label}</p>
          {payload.map((entry: any, index: number) => (
            <p key={index} style={{ color: entry.color }}>
              {entry.name}: {entry.value}
            </p>
          ))}
        </div>
      )
    }
    return null
  }

  return (
    <Card>
      <CardHeader>
        <CardTitle>订单趋势</CardTitle>
        <CardDescription>
          订单数量和完成情况的趋势变化
        </CardDescription>
      </CardHeader>
      <CardContent>
        <ResponsiveContainer width="100%" height={300}>
          <LineChart data={chartData}>
            <CartesianGrid strokeDasharray="3 3" />
            <XAxis dataKey="date" />
            <YAxis />
            <Tooltip content={<CustomTooltip />} />
            <Legend />
            <Line
              type="monotone"
              dataKey="orders"
              stroke="#2563eb"
              strokeWidth={2}
              name="总订单"
            />
            <Line
              type="monotone"
              dataKey="completed"
              stroke="#16a34a"
              strokeWidth={2}
              name="已完成"
            />
            <Line
              type="monotone"
              dataKey="pending"
              stroke="#ea580c"
              strokeWidth={2}
              name="待处理"
            />
          </LineChart>
        </ResponsiveContainer>
      </CardContent>
    </Card>
  )
}
```

### 4. 创建车辆利用率图表组件

创建`src/components/dashboard/vehicle-utilization-chart.tsx`:

```typescript
'use client'

import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'
import { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer } from 'recharts'

interface VehicleUtilizationChartProps {
  data: Array<{
    date: string
    utilization: number
    active: number
    total: number
  }>
}

export function VehicleUtilizationChart({ data }: VehicleUtilizationChartProps) {
  // 格式化数据
  const chartData = data.map(item => ({
    date: new Date(item.date).toLocaleDateString('zh-CN', { month: 'short', day: 'numeric' }),
    utilization: item.utilization,
    active: item.active,
    total: item.total,
  }))

  const CustomTooltip = ({ active, payload, label }: any) => {
    if (active && payload && payload.length) {
      return (
        <div className="bg-white p-3 border rounded-lg shadow-lg">
          <p className="font-medium">{label}</p>
          {payload.map((entry: any, index: number) => (
            <p key={index} style={{ color: entry.color }}>
              {entry.name}: {entry.value}{entry.name === '利用率' ? '%' : ''}
            </p>
          ))}
        </div>
      )
    }
    return null
  }

  return (
    <Card>
      <CardHeader>
        <CardTitle>车辆利用率</CardTitle>
        <CardDescription>
          车辆利用率的每日变化情况
        </CardDescription>
      </CardHeader>
      <CardContent>
        <ResponsiveContainer width="100%" height={300}>
          <BarChart data={chartData}>
            <CartesianGrid strokeDasharray="3 3" />
            <XAxis dataKey="date" />
            <YAxis />
            <Tooltip content={<CustomTooltip />} />
            <Legend />
            <Bar
              dataKey="utilization"
              fill="#3b82f6"
              name="利用率 (%)"
            />
          </BarChart>
        </ResponsiveContainer>
      </CardContent>
    </Card>
  )
}
```

### 5. 创建收入图表组件

创建`src/components/dashboard/revenue-chart.tsx`:

```typescript
'use client'

import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'
import { AreaChart, Area, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer } from 'recharts'
import { format } from 'date-fns'
import { zhCN } from 'date-fns/locale'

interface RevenueChartProps {
  data: Array<{
    month: string
    revenue: number
    target: number
    growth: number
  }>
}

export function RevenueChart({ data }: RevenueChartProps) {
  // 格式化数据
  const chartData = data.map(item => ({
    month: format(new Date(item.month + '-01'), 'yyyy/MM'),
    revenue: item.revenue / 10000, // 转换为万元
    target: item.target / 10000,
    growth: item.growth,
  }))

  const CustomTooltip = ({ active, payload, label }: any) => {
    if (active && payload && payload.length) {
      return (
        <div className="bg-white p-3 border rounded-lg shadow-lg">
          <p className="font-medium">{label}</p>
          {payload.map((entry: any, index: number) => (
            <p key={index} style={{ color: entry.color }}>
              {entry.name}: ¥{entry.value.toFixed(1)}万
            </p>
          ))}
        </div>
      )
    }
    return null
  }

  return (
    <Card>
      <CardHeader>
        <CardTitle>收入趋势</CardTitle>
        <CardDescription>
          月度收入与目标对比
        </CardDescription>
      </CardHeader>
      <CardContent>
        <ResponsiveContainer width="100%" height={300}>
          <AreaChart data={chartData}>
            <CartesianGrid strokeDasharray="3 3" />
            <XAxis dataKey="month" />
            <YAxis />
            <Tooltip content={<CustomTooltip />} />
            <Legend />
            <Area
              type="monotone"
              dataKey="revenue"
              stackId="1"
              stroke="#3b82f6"
              fill="#3b82f6"
              fillOpacity={0.6}
              name="实际收入"
            />
            <Area
              type="monotone"
              dataKey="target"
              stackId="2"
              stroke="#64748b"
              fill="#64748b"
              fillOpacity={0.3}
              strokeDasharray="5 5"
              name="目标收入"
            />
          </AreaChart>
        </ResponsiveContainer>
      </CardContent>
    </Card>
  )
}
```

### 6. 创建绩效指标组件

创建`src/components/dashboard/performance-metrics.tsx`:

```typescript
'use client'

import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'
import { Badge } from '@/components/ui/badge'
import { Progress } from '@/components/ui/progress'
import { TrendingUp, TrendingDown, Clock, Star, MapPin, DollarSign } from 'lucide-react'
import { PerformanceData } from '@/types/dashboard'

interface PerformanceMetricsProps {
  data: PerformanceData
}

export function PerformanceMetrics({ data }: PerformanceMetricsProps) {
  const metrics = [
    {
      title: '准时率',
      icon: Clock,
      value: `${data.onTimeRate.toFixed(1)}%`,
      target: 95,
      trend: data.onTimeTrend,
      description: '订单准时送达率',
    },
    {
      title: '客户满意度',
      icon: Star,
      value: `${data.customerSatisfaction.toFixed(1)}`,
      target: 4.5,
      trend: data.satisfactionTrend,
      description: '平均评分 (5分制)',
    },
    {
      title: '路线优化',
      icon: MapPin,
      value: `${data.routeOptimizationRate.toFixed(1)}%`,
      target: 85,
      trend: data.optimizationTrend,
      description: '路线优化成功率',
    },
    {
      title: '成本控制',
      icon: DollarSign,
      value: `${data.costEfficiency.toFixed(1)}%`,
      target: 90,
      trend: data.costTrend,
      description: '成本控制效率',
    },
  ]

  return (
    <Card>
      <CardHeader>
        <CardTitle>绩效指标</CardTitle>
        <CardDescription>
          关键业务绩效指标监控
        </CardDescription>
      </CardHeader>
      <CardContent>
        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
          {metrics.map((metric, index) => {
            const Icon = metric.icon
            const TrendIcon = metric.trend === 'up' ? TrendingUp :
                            metric.trend === 'down' ? TrendingDown : null
            const trendColor = metric.trend === 'up' ? 'text-green-600' :
                              metric.trend === 'down' ? 'text-red-600' : ''

            const progress = typeof metric.value === 'string'
              ? parseFloat(metric.value)
              : metric.value
            const targetProgress = (progress / metric.target) * 100

            return (
              <div key={index} className="space-y-3">
                <div className="flex items-center justify-between">
                  <div className="flex items-center space-x-2">
                    <Icon className="w-4 h-4 text-muted-foreground" />
                    <span className="font-medium">{metric.title}</span>
                  </div>
                  <div className="flex items-center space-x-2">
                    <span className="text-lg font-bold">{metric.value}</span>
                    {TrendIcon && (
                      <TrendIcon className={`w-4 h-4 ${trendColor}`} />
                    )}
                  </div>
                </div>

                <div className="space-y-2">
                  <div className="flex justify-between text-sm text-muted-foreground">
                    <span>目标: {metric.target}</span>
                    <span>{targetProgress.toFixed(0)}%</span>
                  </div>
                  <Progress
                    value={Math.min(targetProgress, 100)}
                    className="h-2"
                  />
                  <div className="text-xs text-muted-foreground">
                    {metric.description}
                  </div>
                </div>
              </div>
            )
          })}
        </div>
      </CardContent>
    </Card>
  )
}
```

### 7. 创建告警面板组件

创建`src/components/dashboard/alerts-panel.tsx`:

```typescript
'use client'

import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'
import { Button } from '@/components/ui/button'
import { Badge } from '@/components/ui/badge'
import { Alert, AlertDescription } from '@/components/ui/alert'
import { Bell, AlertTriangle, CheckCircle, XCircle, Clock } from 'lucide-react'
import { DashboardAlert } from '@/types/dashboard'
import { format } from 'date-fns'
import { zhCN } from 'date-fns/locale'

interface AlertsPanelProps {
  alerts: DashboardAlert[]
}

export function AlertsPanel({ alerts }: AlertsPanelProps) {
  // 按严重程度排序
  const sortedAlerts = [...alerts].sort((a, b) => {
    const severityOrder = { critical: 0, high: 1, medium: 2, low: 3 }
    return severityOrder[a.severity] - severityOrder[b.severity]
  })

  // 只显示最近的告警
  const recentAlerts = sortedAlerts.slice(0, 5)

  const getSeverityIcon = (severity: string) => {
    switch (severity) {
      case 'critical': return <XCircle className="w-4 h-4 text-red-600" />
      case 'high': return <AlertTriangle className="w-4 h-4 text-orange-600" />
      case 'medium': return <Clock className="w-4 h-4 text-yellow-600" />
      case 'low': return <Bell className="w-4 h-4 text-blue-600" />
      default: return <Bell className="w-4 h-4 text-gray-600" />
    }
  }

  const getSeverityStyle = (severity: string) => {
    switch (severity) {
      case 'critical': return 'destructive'
      case 'high': return 'destructive'
      case 'medium': return 'secondary'
      case 'low': return 'outline'
      default: return 'outline'
    }
  }

  const getSeverityText = (severity: string) => {
    switch (severity) {
      case 'critical': return '严重'
      case 'high': return '高'
      case 'medium': return '中'
      case 'low': return '低'
      default: return severity
    }
  }

  return (
    <Card>
      <CardHeader>
        <CardTitle className="flex items-center justify-between">
          <div className="flex items-center space-x-2">
            <Bell className="w-5 h-5" />
            <span>系统告警</span>
          </div>
          <Badge variant={alerts.length > 0 ? 'destructive' : 'secondary'}>
            {alerts.length} 个告警
          </Badge>
        </CardTitle>
        <CardDescription>
          实时系统监控和业务告警
        </CardDescription>
      </CardHeader>
      <CardContent>
        {recentAlerts.length === 0 ? (
          <div className="text-center py-8">
            <CheckCircle className="w-12 h-12 mx-auto mb-4 text-green-600" />
            <div className="text-lg font-medium text-green-600">系统正常</div>
            <div className="text-sm text-muted-foreground">暂无告警信息</div>
          </div>
        ) : (
          <div className="space-y-3">
            {recentAlerts.map((alert) => (
              <Alert key={alert.id} className="border-l-4 border-l-red-500">
                <div className="flex items-start justify-between">
                  <div className="flex items-start space-x-3 flex-1">
                    {getSeverityIcon(alert.severity)}
                    <div className="flex-1 min-w-0">
                      <div className="flex items-center space-x-2 mb-1">
                        <h4 className="font-medium text-sm">{alert.title}</h4>
                        <Badge variant={getSeverityStyle(alert.severity) as any}>
                          {getSeverityText(alert.severity)}
                        </Badge>
                      </div>
                      <AlertDescription className="text-sm">
                        {alert.message}
                      </AlertDescription>
                      <div className="text-xs text-muted-foreground mt-1">
                        {format(new Date(alert.timestamp), 'yyyy-MM-dd HH:mm:ss', { locale: zhCN })}
                      </div>
                    </div>
                  </div>
                  {!alert.acknowledged && (
                    <Button variant="outline" size="sm">
                      处理
                    </Button>
                  )}
                </div>
              </Alert>
            ))}

            {alerts.length > recentAlerts.length && (
              <div className="text-center pt-2">
                <Button variant="outline" size="sm">
                  查看全部 {alerts.length} 个告警
                </Button>
              </div>
            )}
          </div>
        )}
      </CardContent>
    </Card>
  )
}
```

### 8. 创建快捷操作组件

创建`src/components/dashboard/quick-actions.tsx`:

```typescript
'use client'

import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'
import { Button } from '@/components/ui/button'
import { Plus, Truck, Package, FileText, Settings, BarChart3 } from 'lucide-react'

export function QuickActions() {
  const actions = [
    {
      title: '创建订单',
      icon: Plus,
      description: '快速创建新订单',
      action: () => {
        // 跳转到订单创建页面
        window.location.href = '/orders/create'
      },
    },
    {
      title: '车辆调度',
      icon: Truck,
      description: '管理车辆调度',
      action: () => {
        window.location.href = '/dispatch'
      },
    },
    {
      title: '上传回单',
      icon: FileText,
      description: '上传运输回单',
      action: () => {
        window.location.href = '/receipts'
      },
    },
    {
      title: '查看报表',
      icon: BarChart3,
      description: '查看详细报表',
      action: () => {
        window.location.href = '/reports'
      },
    },
  ]

  return (
    <Card>
      <CardHeader>
        <CardTitle>快捷操作</CardTitle>
        <CardDescription>
          常用功能快速入口
        </CardDescription>
      </CardHeader>
      <CardContent>
        <div className="grid grid-cols-2 gap-3">
          {actions.map((action, index) => {
            const Icon = action.icon
            return (
              <Button
                key={index}
                variant="outline"
                className="h-auto p-4 flex flex-col items-center space-y-2"
                onClick={action.action}
              >
                <Icon className="w-6 h-6" />
                <span className="text-sm font-medium">{action.title}</span>
                <span className="text-xs text-muted-foreground text-center">
                  {action.description}
                </span>
              </Button>
            )
          })}
        </div>

        <div className="mt-4 pt-4 border-t">
          <Button variant="ghost" className="w-full" onClick={() => {
            window.location.href = '/settings'
          }}>
            <Settings className="w-4 h-4 mr-2" />
            系统设置
          </Button>
        </div>
      </CardContent>
    </Card>
  )
}
```

### 9. 创建类型定义

创建`src/types/dashboard.ts`:

```typescript
export interface DashboardData {
  orders: {
    total: number
    completed: number
    pending: number
    completionRate: number
    trendData: number[]
    byStatus: Array<{ status: string; count: number }>
    byType: Array<{ type: string; count: number }>
    byRegion: Array<{ region: string; count: number }>
  }
  vehicles: {
    total: number
    active: number
    utilizationRate: number
    utilizationTrend: 'up' | 'down' | 'stable'
    utilizationData: Array<{
      date: string
      utilization: number
      active: number
      total: number
    }>
    efficiencyData: Array<{
      driver: string
      efficiency: number
      trips: number
    }>
  }
  revenue: {
    total: number
    growthRate: number
    trend: 'up' | 'down' | 'stable'
    monthlyData: Array<{
      month: string
      revenue: number
      target: number
      growth: number
    }>
  }
  performance: {
    onTimeRate: number
    onTimeTrend: 'up' | 'down' | 'stable'
    customerSatisfaction: number
    satisfactionTrend: 'up' | 'down' | 'stable'
    routeOptimizationRate: number
    optimizationTrend: 'up' | 'down' | 'stable'
    costEfficiency: number
    costTrend: 'up' | 'down' | 'stable'
    trendData: number[]
    deliveryData: Array<{
      date: string
      onTime: number
      delayed: number
    }>
    driverData: Array<{
      driver: string
      score: number
      trips: number
    }>
    satisfactionData: Array<{
      month: string
      score: number
      responses: number
    }>
  }
  operations: {
    routeData: Array<{
      date: string
      optimized: number
      total: number
    }>
  }
  finance: {
    costData: Array<{
      category: string
      actual: number
      budget: number
    }>
  }
  alerts: DashboardAlert[]
}

export interface DashboardAlert {
  id: string
  title: string
  message: string
  severity: 'critical' | 'high' | 'medium' | 'low'
  category: string
  timestamp: string
  acknowledged: boolean
  acknowledgedBy?: string
  acknowledgedAt?: string
  metadata?: Record<string, any>
}

export interface DashboardMetrics {
  orders: {
    total: number
    completed: number
    pending: number
    completionRate: number
    trend: 'up' | 'down' | 'stable'
  }
  vehicles: {
    total: number
    active: number
    utilizationRate: number
    trend: 'up' | 'down' | 'stable'
  }
  revenue: {
    total: number
    growthRate: number
    trend: 'up' | 'down' | 'stable'
  }
  performance: {
    onTimeRate: number
    customerSatisfaction: number
    trend: 'up' | 'down' | 'stable'
  }
}

export interface PerformanceData {
  onTimeRate: number
  onTimeTrend: 'up' | 'down' | 'stable'
  customerSatisfaction: number
  satisfactionTrend: 'up' | 'down' | 'stable'
  routeOptimizationRate: number
  optimizationTrend: 'up' | 'down' | 'stable'
  costEfficiency: number
  costTrend: 'up' | 'down' | 'stable'
  trendData: number[]
  deliveryData: Array<{
    date: string
    onTime: number
    delayed: number
  }>
  driverData: Array<{
    driver: string
    score: number
    trips: number
  }>
  satisfactionData: Array<{
    month: string
    score: number
    responses: number
  }>
}

export type TimeRange = 'today' | 'week' | 'month' | 'quarter' | 'custom'
```

### 10. 创建仪表板页面

创建`src/app/dashboard/page.tsx`:

```typescript
'use client'

import { useState, useEffect } from 'react'
import { DashboardMain } from '@/components/dashboard/dashboard-main'
import { DashboardData } from '@/types/dashboard'

// 模拟数据
const mockData: DashboardData = {
  orders: {
    total: 1234,
    completed: 1156,
    pending: 78,
    completionRate: 93.7,
    trendData: [120, 135, 125, 140, 130, 145, 1234],
    byStatus: [
      { status: 'COMPLETED', count: 1156 },
      { status: 'IN_TRANSIT', count: 45 },
      { status: 'PENDING', count: 33 },
    ],
    byType: [
      { type: 'STANDARD', count: 678 },
      { type: 'EXPRESS', count: 342 },
      { type: 'HEAVY', count: 214 },
    ],
    byRegion: [
      { region: '华北', count: 423 },
      { region: '华东', count: 356 },
      { region: '华南', count: 289 },
      { region: '华西', count: 166 },
    ],
  },
  vehicles: {
    total: 85,
    active: 68,
    utilizationRate: 80.0,
    utilizationTrend: 'up',
    utilizationData: [
      { date: '2024-01-15', utilization: 75, active: 64, total: 85 },
      { date: '2024-01-16', utilization: 78, active: 66, total: 85 },
      { date: '2024-01-17', utilization: 82, active: 70, total: 85 },
      { date: '2024-01-18', utilization: 80, active: 68, total: 85 },
    ],
    efficiencyData: [
      { driver: '张司机', efficiency: 92, trips: 15 },
      { driver: '李司机', efficiency: 88, trips: 12 },
      { driver: '王司机', efficiency: 95, trips: 18 },
    ],
  },
  revenue: {
    total: 2340000,
    growthRate: 12.5,
    trend: 'up',
    monthlyData: [
      { month: '2024-01', revenue: 1850000, target: 1800000, growth: 8.5 },
      { month: '2024-02', revenue: 1950000, target: 1900000, growth: 10.2 },
      { month: '2024-03', revenue: 2100000, target: 2000000, growth: 12.5 },
    ],
  },
  performance: {
    onTimeRate: 94.2,
    onTimeTrend: 'up',
    customerSatisfaction: 4.6,
    satisfactionTrend: 'up',
    routeOptimizationRate: 87.5,
    optimizationTrend: 'up',
    costEfficiency: 91.2,
    costTrend: 'stable',
    trendData: [92.1, 93.5, 94.0, 94.2],
    deliveryData: [
      { date: '2024-01-15', onTime: 45, delayed: 3 },
      { date: '2024-01-16', onTime: 52, delayed: 2 },
      { date: '2024-01-17', onTime: 48, delayed: 1 },
    ],
    driverData: [
      { driver: '张司机', score: 4.7, trips: 15 },
      { driver: '李司机', score: 4.5, trips: 12 },
      { driver: '王司机', score: 4.8, trips: 18 },
    ],
    satisfactionData: [
      { month: '2024-01', score: 4.5, responses: 234 },
      { month: '2024-02', score: 4.6, responses: 256 },
      { month: '2024-03', score: 4.6, responses: 278 },
    ],
  },
  operations: {
    routeData: [
      { date: '2024-01-15', optimized: 42, total: 48 },
      { date: '2024-01-16', optimized: 45, total: 54 },
      { date: '2024-01-17', optimized: 38, total: 49 },
    ],
  },
  finance: {
    costData: [
      { category: '燃油', actual: 450000, budget: 480000 },
      { category: '人工', actual: 680000, budget: 700000 },
      { category: '维护', actual: 120000, budget: 150000 },
      { category: '其他', actual: 89000, budget: 100000 },
    ],
  },
  alerts: [
    {
      id: '1',
      title: '车辆燃油不足',
      message: '车辆 沪B12345 燃油水平低于20%',
      severity: 'high',
      category: 'vehicle',
      timestamp: '2024-01-18T10:30:00Z',
      acknowledged: false,
    },
    {
      id: '2',
      title: '订单延迟风险',
      message: '订单 ORD-2024-0005 可能延迟送达',
      severity: 'medium',
      category: 'order',
      timestamp: '2024-01-18T09:15:00Z',
      acknowledged: false,
    },
    {
      id: '3',
      title: '系统性能告警',
      message: '数据库响应时间超过阈值',
      severity: 'low',
      category: 'system',
      timestamp: '2024-01-18T08:45:00Z',
      acknowledged: true,
      acknowledgedAt: '2024-01-18T09:00:00Z',
      acknowledgedBy: 'admin',
    },
  ],
}

export default function DashboardPage() {
  const [data, setData] = useState<DashboardData>(mockData)
  const [loading, setLoading] = useState(false)

  // 模拟实时数据更新
  useEffect(() => {
    const interval = setInterval(() => {
      setData(prevData => {
        // 模拟数据变化
        const newData = { ...prevData }

        // 更新订单数量
        newData.orders.total += Math.floor(Math.random() * 3)
        newData.orders.completed += Math.floor(Math.random() * 2)

        // 更新车辆利用数据
        newData.vehicles.utilizationRate = Math.min(100, Math.max(60,
          newData.vehicles.utilizationRate + (Math.random() - 0.5) * 2
        ))

        return newData
      })
    }, 30000) // 每30秒更新一次

    return () => clearInterval(interval)
  }, [])

  // 刷新数据
  const handleRefresh = async () => {
    setLoading(true)
    try {
      // 模拟API调用
      await new Promise(resolve => setTimeout(resolve, 1000))

      // 更新时间戳等
      setData(prevData => ({
        ...prevData,
        // 可以在这里添加新的数据
      }))
    } catch (error) {
      console.error('刷新数据失败:', error)
    } finally {
      setLoading(false)
    }
  }

  // 导出数据
  const handleExportData = async (type: string, format: string) => {
    try {
      // 模拟导出过程
      await new Promise(resolve => setTimeout(resolve, 1000))

      // 这里应该实现实际的导出逻辑
      console.log(`导出 ${type} 数据为 ${format} 格式`)

      // 显示成功消息
      alert('数据导出成功')
    } catch (error) {
      console.error('导出失败:', error)
      alert('导出失败，请重试')
    }
  }

  return (
    <div className="container mx-auto py-8">
      <DashboardMain
        data={data}
        onRefresh={handleRefresh}
        onExportData={handleExportData}
      />
    </div>
  )
}
```

## 验证清单

- [ ] 仪表板布局正确
- [ ] 关键指标显示准确
- [ ] 图表渲染正常
- [ ] 数据实时更新
- [ ] 告警面板功能正常
- [ ] 快捷操作可用
- [ ] 响应式设计良好
- [ ] 导出功能正常

## 测试命令

```bash
# 启动开发服务器
npm run dev

# 运行类型检查
npm run type-check

# 运行测试
npm test

# 检查构建
npm run build
```

## 注意事项

- 确保图表性能优化
- 实现数据缓存策略
- 添加数据加载状态
- 优化移动端显示效果
- 实现自定义仪表板功能
- 添加更多数据可视化选项